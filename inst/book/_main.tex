% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Building Web Apps with R Shiny},
  pdfauthor={Lisa DeBruine},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}

\newenvironment{danger}
    {
    \hline\\
    }
    { 
    \\\\\hline
    }
    
\newenvironment{warning}
    {
    \hline\\
    }
    { 
    \\\\\hline
    }
    
\newenvironment{info}
    {
    \hline\\
    }
    { 
    \\\\\hline
    }
    
\newenvironment{try}
    {
    \hline\\
    }
    { 
    \\\\\hline
    }
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[]{natbib}
\bibliographystyle{apalike}

\title{Building Web Apps with R Shiny}
\author{Lisa DeBruine}
\date{2021-07-20}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{overview}{%
\chapter*{Overview}\label{overview}}
\addcontentsline{toc}{chapter}{Overview}

\includegraphics{images/shinyintro.png}

Shiny lets you make web applications that do anything you can code in R. For example, you can share your data analysis in a dynamic way with people who don't use R, collect and visualize data, or even make \href{https://towardsdatascience.com/getting-started-with-generative-art-in-r-3bc50067d34b}{data aRt}.

While there is a wealth of material available on the internet to help you get started with Shiny, it can be difficult to see how everything fits together. This class will take a predominantly live coding approach, rather than a lecture-only approach, so you can code along with the instructor and deal with the inevitable bugs and roadblocks together.

This class will teach you the basics of Shiny app programming, giving you skills that will form the basis of almost any app you want to build. By the end of the class, you will have created a custom app that collects and saves data, allows users to dynamically visualize the data, and produces downloadable reports.

\hypertarget{installing-shinyintro}{%
\section{Installing shinyintro}\label{installing-shinyintro}}

To install the class package, which will provide you with a copy of all of the shiny apps we'll use for demos and the basic template, paste the following code into the console in RStudio. See \protect\hyperlink{installing-r}{Appendix A} for help installing R and RStudio.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# you may have to install devtools first with }
\CommentTok{\# install.packages("devtools")}

\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"debruine/shinyintro"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The class package lets you access the book or run the demo apps offline.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{shinyintro}\SpecialCharTok{::}\FunctionTok{book}\NormalTok{()}
\NormalTok{shinyintro}\SpecialCharTok{::}\FunctionTok{app}\NormalTok{(}\StringTok{"first\_demo"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You can also clone the demo apps.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{shinyintro}\SpecialCharTok{::}\FunctionTok{clone}\NormalTok{(}\StringTok{"basic\_template"}\NormalTok{, }\StringTok{"myapps/newapp"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{example-apps}{%
\section{Example Apps}\label{example-apps}}

The following are some diverse examples of Shiny apps that the instructor has made.

\begin{itemize}
\tightlist
\item
  \href{https://shiny.psy.gla.ac.uk/debruine/plotdemo/}{Plot Demo} Simulate data from a 2Ã—2 factorial design and visualize it with 6 different plot styles.
\item
  \href{https://shiny.psy.gla.ac.uk/lmem_sim/}{Simulating for LMEM} companion to Understanding mixed effects models through data simulation (DeBruine \& Barr, AMPPS 2021)
\item
  \href{http://shiny.ieis.tue.nl/scienceverse/}{Scienceverse} is an ambitious (but in-progress) app for creating machine-readable descriptions of studies and human-readable summaries.
\item
  \href{https://shiny.psy.gla.ac.uk/debruine/wordcloud/}{Word Cloud} Create a word cloud from text and customize its appearance. Created during the live-coding event at \href{https://psyteachr.github.io/hack-your-data/}{Hack Your Data Beautiful}.
\end{itemize}

\hypertarget{code-horizons-course-27-30-july-2021}{%
\section{Code Horizons Course (27-30 July 2021)}\label{code-horizons-course-27-30-july-2021}}

Starting July 27, we are offering this seminar as a 4-day synchronous \footnote{We understand that scheduling is difficult during this unpredictable time. If you prefer, you may take all or part of the course asynchronously. The video recordings will be made available within 24 hours of each session and will be accessible for two weeks after the seminar, meaning that you will get all of the class content and discussions even if you cannot participate synchronously.}, remote workshop for the first time. Each day will consist of a 3-hour live lecture held via the free video-conferencing software Zoom. You are encouraged to join the lecture live, but will have the opportunity to view the recorded session later if you are unable to attend at the scheduled time. Closed captioning is available for all live and recorded sessions.

Each lecture session will conclude with a hands-on exercise reviewing the content covered, to be completed on your own. An additional lab session will be held Tuesday and Thursday afternoons, where you can review the exercise results with the instructor and ask any questions.

\hypertarget{schedule}{%
\subsection{Schedule}\label{schedule}}

\hypertarget{day-1}{%
\subsubsection{Day 1}\label{day-1}}

\begin{itemize}
\tightlist
\item
  \protect\hyperlink{first-app}{Your First Shiny App}
\item
  \protect\hyperlink{shinydashboard}{ShinyDashboard}
\end{itemize}

\hypertarget{day-2}{%
\subsubsection{Day 2}\label{day-2}}

\begin{itemize}
\tightlist
\item
  \protect\hyperlink{inputs}{Different input types}
\item
  \protect\hyperlink{outputs}{Different output types}
\item
  \protect\hyperlink{reactives}{Reactive functions}
\item
  \protect\hyperlink{data}{Reading and saving data}
\end{itemize}

\hypertarget{day-3}{%
\subsubsection{Day 3}\label{day-3}}

\begin{itemize}
\tightlist
\item
  \protect\hyperlink{web}{CSS, HTML, and Javascript}
\item
  \protect\hyperlink{structure}{Structuring a complex app}
\item
  \protect\hyperlink{debugging}{Debugging and error handling}
\item
  \protect\hyperlink{contingency}{Contingent Display}
\end{itemize}

\hypertarget{day-4}{%
\subsubsection{Day 4}\label{day-4}}

\begin{itemize}
\tightlist
\item
  \protect\hyperlink{sharing}{Sharing Your Apps}
\item
  \protect\hyperlink{reports}{Creating and downloading a customized report}
\item
  \protect\hyperlink{modules}{Shiny modules for repeated structures}
\end{itemize}

\hypertarget{computing}{%
\section{Computing}\label{computing}}

To participate in the hands-on exercises, you are strongly encouraged to use a computer with the most recent version of \href{https://www.r-project.org/}{R installed}. Participants are also encouraged to download and install \href{https://www.rstudio.com/products/rstudio/download/}{RStudio}, a front-end for R that makes it easier to work with. This software is free and available for Windows, Mac, and Linux platforms.

\hypertarget{who-should-register}{%
\section{Who Should Register?}\label{who-should-register}}

You need to have basic familiarity with R, including data import, data processing, visualization, and functions and control structures (e.g., if/else). Instruction will be done using RStudio. Some familiarity with ggplot2 and dplyr would be useful. You definitely do not need to be an expert coder, but the following code should not be challenging to understand.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}

\NormalTok{pets }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"pets.csv"}\NormalTok{)}

\NormalTok{dv }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"score"}\NormalTok{, }\StringTok{"weight"}\NormalTok{), }\DecValTok{1}\NormalTok{)}

\ControlFlowTok{if}\NormalTok{ (dv }\SpecialCharTok{==} \StringTok{"score"}\NormalTok{) \{}
\NormalTok{  g }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(pet, score, }\AttributeTok{fill =}\NormalTok{ country))}
\NormalTok{\} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (dv }\SpecialCharTok{==} \StringTok{"weight"}\NormalTok{) \{}
\NormalTok{  g }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(pets, }\FunctionTok{aes}\NormalTok{(pet, weight, }\AttributeTok{fill =}\NormalTok{ country))}
\NormalTok{\}}

\NormalTok{g }\SpecialCharTok{+} \FunctionTok{geom\_violin}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If you want to brush up on your R (especially tidyverse), and also gain familiarity with the instructor's teaching style, the first seven chapters of \href{https://psyteachr.github.io/msc-data-skills/}{Data Skills for Reproducible Science} provide a good overview.

\hypertarget{conventions}{%
\section{Conventions}\label{conventions}}

This book will use the following conventions:

\begin{itemize}
\tightlist
\item
  File paths: www/style.css
\item
  R Packages: shinydashboard
\item
  Functions: {observeEvent}()
\item
  Arguments: {width}
\item
  Strings: {"Lisa"}
\item
  Numbers: {100}
\item
  Logical values: {TRUE}
\item
  Other code: \texttt{x\ \textless{}-\ list(a\ =\ "Aligator",\ b\ =\ "Buffalo")}
\item
  Glossary items: shiny
\item
  Internal links: Section~\ref{first-app}
\item
  External links: \href{https://mastering-shiny.org/}{Mastering Shiny}
\item
  Menu/interface options: \textbf{\texttt{New\ File...}}
\end{itemize}

\hypertarget{further-resources}{%
\section{Further Resources}\label{further-resources}}

There are a lot of great resources online to reinforce or continue your learning about Shiny.

\begin{itemize}
\tightlist
\item
  \href{https://mastering-shiny.org/}{Mastering Shiny}
\item
  \href{https://shiny.rstudio.com/tutorial/}{RStudio Shiny Tutorials}
\item
  \href{https://github.com/nanxstats/awesome-shiny-extensions}{Awesome Shiny Extensions}
\end{itemize}

\hypertarget{first-app}{%
\chapter{Your First Shiny App}\label{first-app}}

\hypertarget{the-demo-app}{%
\section{The Demo App}\label{the-demo-app}}

To start, let's walk through the basics of setting up a shiny app, starting with the example built into RStudio I won't explain yet how shiny apps are structured; the goal is to just get something up and running, and give you some familiarity with the layout of a fairly simple app.

\hypertarget{set-up-the-demo-app}{%
\subsection{Set Up the Demo App}\label{set-up-the-demo-app}}

\begin{figure}

{\centering \includegraphics[width=0.3\linewidth]{images/demo_app/01-create-project} \includegraphics[width=0.3\linewidth]{images/demo_app/02-project-type} \includegraphics[width=0.3\linewidth]{images/demo_app/03-project-directory} 

}

\caption{Creating a demo app.}\label{fig:first-demo}
\end{figure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Under the \textbf{\texttt{File}} menu, choose \textbf{\texttt{New\ Project...}}. You will see a popup window like the one above. Choose \textbf{\texttt{New\ Directory}}.
\item
  Choose \textbf{\texttt{Shiny\ Web\ Application}} as the project type.
\item
  I like to put all of my apps in the same directory, but it doesn't matter where you save it.
\end{enumerate}

Your RStudio interface should look like this now.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/demo_app/04-rstudio-interface} 

}

\caption{RStudio interface with the built-in demo app loaded.}\label{fig:first-rstudio-interface}
\end{figure}

If you are not using RStudio or your source code doesn't look like this, replace it with the code below:

View Code

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#}
\CommentTok{\# This is a Shiny web application. You can run the application by clicking}
\CommentTok{\# the \textquotesingle{}Run App\textquotesingle{} button above.}
\CommentTok{\#}
\CommentTok{\# Find out more about building applications with Shiny here:}
\CommentTok{\#}
\CommentTok{\#    http://shiny.rstudio.com/}
\CommentTok{\#}

\FunctionTok{library}\NormalTok{(shiny)}

\CommentTok{\# Define UI for application that draws a histogram}
\NormalTok{ui }\OtherTok{\textless{}{-}} \FunctionTok{fluidPage}\NormalTok{(}
   
   \CommentTok{\# Application title}
   \FunctionTok{titlePanel}\NormalTok{(}\StringTok{"Old Faithful Geyser Data"}\NormalTok{),}
   
   \CommentTok{\# Sidebar with a slider input for number of bins }
   \FunctionTok{sidebarLayout}\NormalTok{(}
      \FunctionTok{sidebarPanel}\NormalTok{(}
         \FunctionTok{sliderInput}\NormalTok{(}\StringTok{"bins"}\NormalTok{,}
                     \StringTok{"Number of bins:"}\NormalTok{,}
                     \AttributeTok{min =} \DecValTok{1}\NormalTok{,}
                     \AttributeTok{max =} \DecValTok{50}\NormalTok{,}
                     \AttributeTok{value =} \DecValTok{30}\NormalTok{)}
\NormalTok{      ),}
      
      \CommentTok{\# Show a plot of the generated distribution}
      \FunctionTok{mainPanel}\NormalTok{(}
         \FunctionTok{plotOutput}\NormalTok{(}\StringTok{"distPlot"}\NormalTok{)}
\NormalTok{      )}
\NormalTok{   )}
\NormalTok{)}

\CommentTok{\# Define server logic required to draw a histogram}
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output) \{}
   
\NormalTok{   output}\SpecialCharTok{$}\NormalTok{distPlot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
      \CommentTok{\# generate bins based on input$bins from ui.R}
\NormalTok{      x    }\OtherTok{\textless{}{-}}\NormalTok{ faithful[, }\DecValTok{2}\NormalTok{] }
\NormalTok{      bins }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\FunctionTok{min}\NormalTok{(x), }\FunctionTok{max}\NormalTok{(x), }\AttributeTok{length.out =}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{bins }\SpecialCharTok{+} \DecValTok{1}\NormalTok{)}
      
      \CommentTok{\# draw the histogram with the specified number of bins}
      \FunctionTok{hist}\NormalTok{(x, }\AttributeTok{breaks =}\NormalTok{ bins, }\AttributeTok{col =} \StringTok{\textquotesingle{}darkgray\textquotesingle{}}\NormalTok{, }\AttributeTok{border =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{)}
\NormalTok{   \})}
\NormalTok{\}}

\CommentTok{\# Run the application }
\FunctionTok{shinyApp}\NormalTok{(}\AttributeTok{ui =}\NormalTok{ ui, }\AttributeTok{server =}\NormalTok{ server)}
\end{Highlighting}
\end{Shaded}

Click on \textbf{\texttt{Run\ App}} in the top right corner of the source pane. The app will open up in a new window. Play with the slider and watch the histogram change.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/demo_app/05-app-interface} 

}

\caption{Demo application interface}\label{fig:first-app-interface}
\end{figure}

You can also open up the app in a web browser by clicking on \texttt{Open\ in\ Browser}.

\hypertarget{modify-the-demo-app}{%
\subsection{Modify the Demo App}\label{modify-the-demo-app}}

Now we're going to make a series of changes to the demo app until it's all your own.

You can close the app by closing the window or browser tab it's running in and clicking the red stop sign in the console tab, or leave it running while you edit the code. If you have multiple screens, it can be useful to have the app open on one screen and the code on another.

Find the application title. It is the first \href{defs.html\#argument}{argument} to the \href{defs.html\#function}{function} \texttt{titlePanel}. Change the title to \texttt{"My\ First\ App"}. Make sure the title is inside quotes and the whole quoted string is inside the parentheses. Save the file (\texttt{cmd-S} or \texttt{File\ \textgreater{}\ Save}).

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/demo_app/06-change-title} 

}

\caption{App with changed title.}\label{fig:first-change-title}
\end{figure}

Click \textbf{\texttt{Run\ App}} (or \textbf{\texttt{Reload\ App}} if you haven't closed the app window) in the source pane. If you haven't saved your changes, it will prompt you to do so. Check that the app title has changed.

Now let's change the input. Find the function {sliderInput}() (line 21). The first argument is the name you can use in the code to find the value of this input, so don't change it just yet. The second argument is the text that displays before the slider. Change this to something else and re-run the app.

\begin{Shaded}
\begin{Highlighting}[]
         \FunctionTok{sliderInput}\NormalTok{(}\StringTok{"bins"}\NormalTok{,}
                     \StringTok{"Number of bins:"}\NormalTok{,}
                     \AttributeTok{min =} \DecValTok{0}\NormalTok{,}
                     \AttributeTok{max =} \DecValTok{50}\NormalTok{,}
                     \AttributeTok{value =} \DecValTok{30}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

See if you can figure out what the next three arguments to {sliderInput}() do. Change them to different integers, then re-run the app to see what's changed.

The arguments to the function {sidebarPanel}() are just a list of things you want to display in the sidebar. To add some explanatory text in a paragraph before {sliderInput}(), just use the paragraph function {p}().

\begin{Shaded}
\begin{Highlighting}[]
      \FunctionTok{sidebarPanel}\NormalTok{(}
         \FunctionTok{p}\NormalTok{(}\StringTok{"I am explaining this perfectly"}\NormalTok{),}
         \FunctionTok{sliderInput}\NormalTok{(}\StringTok{"bins"}\NormalTok{,}
                     \StringTok{"Choose the best bin number:"}\NormalTok{,}
                     \AttributeTok{min =} \DecValTok{10}\NormalTok{,}
                     \AttributeTok{max =} \DecValTok{40}\NormalTok{,}
                     \AttributeTok{value =} \DecValTok{25}\NormalTok{)}
\NormalTok{      )}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/demo_app/07-app-sidebar-p} 

}

\caption{Sidebar with an added paragraph.}\label{fig:first-app-sidebar-p}
\end{figure}

The sidebar shows up on the left if your window is wide enough, but moves to the top of the screen if it's too narrow.

I don't like it there, so we can move this text out of the sidebar and to the top of the page, just under the title. Try this and re-run the app.

\begin{Shaded}
\begin{Highlighting}[]
   \CommentTok{\# Application title}
   \FunctionTok{titlePanel}\NormalTok{(}\StringTok{"My First App"}\NormalTok{),}

   \FunctionTok{p}\NormalTok{(}\StringTok{"I am explaining this perfectly"}\NormalTok{),}

   \CommentTok{\# Sidebar with a slider input for number of bins}
   \FunctionTok{sidebarLayout}\NormalTok{(...)}
\end{Highlighting}
\end{Shaded}

See where you can move the text in the layout of the page and where causes errors.

I'm also not keen on the grey plot. We can change the plot colour inside \texttt{hist()}

\begin{Shaded}
\begin{Highlighting}[]
      \CommentTok{\# draw the histogram with the specified number of bins}
      \FunctionTok{hist}\NormalTok{(x, }\AttributeTok{breaks =}\NormalTok{ bins, }\AttributeTok{col =} \StringTok{\textquotesingle{}steelblue3\textquotesingle{}}\NormalTok{, }\AttributeTok{border =} \StringTok{\textquotesingle{}grey30\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

There are a lot of ways to represent colour in R. The easiest three are:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  hexadecimal colours (e.g., {"\#0066CC"})
\item
  the \texttt{rgb} or \texttt{hsl} functions (e.g., \texttt{rgb(0,\ .4,\ .8)})
\item
  colour names (type {colours}() in the console)
\end{enumerate}

The color ``steelblue3'' is pretty close to the shiny interface default colour, but feel free to choose whatever you like.

I prefer ggplots, so let's make the plot with {geom\_histogram}() instead of {hist}() (which is a great function for really quick plots). Since we need several functions from the ggplot2 package, we'll need to load that package at the top of the script, just under where the shiny package is loaded:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(shiny)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\end{Highlighting}
\end{Shaded}

You can replace all of the code in {renderPlot}() with the code below.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{distPlot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
    \CommentTok{\# create plot}
    \FunctionTok{ggplot}\NormalTok{(faithful, }\FunctionTok{aes}\NormalTok{(waiting)) }\SpecialCharTok{+}
      \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{bins =}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{bins,}
                     \AttributeTok{fill =} \StringTok{"steelblue3"}\NormalTok{,}
                     \AttributeTok{colour =} \StringTok{"grey30"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{xlab}\NormalTok{(}\StringTok{"What are we even plotting here?"}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{theme\_minimal}\NormalTok{()}
\NormalTok{  \})}
\end{Highlighting}
\end{Shaded}

You can set {fill} and {colour} to whatever colours you like, and change {theme\_minimal}() to one of the other \href{https://ggplot2.tidyverse.org/reference/ggtheme.html\#examples}{built-in ggplot themes}.

What \emph{are} we even plotting here? Type \texttt{?faithful} into the console pane to see what the \texttt{waiting} column represents (\texttt{faithful} is a built-in demo dataset). Change the label on the x-axis to something more sensible.

\hypertarget{add-new-things}{%
\subsection{Add New Things}\label{add-new-things}}

The \texttt{faithful} dataset includes two columns:\texttt{eruptions} and \texttt{waiting}. We've been plotting the \texttt{waiting} variable, but what if you wanted to plot the \texttt{eruptions} variable instead?

Try plotting the eruption time (\texttt{eruptions}) instead of the waiting time. You just have to change one word in {ggplot}() and update the x-axis label.

We can add another input widget to let the user switch between plotting eruption time and wait time. We'll learn more about the different input options in Section~\ref{inputs}. We need to toggle between two options, so we can use either radio buttons or a select box. Radio buttons are probably best if you have only a few options and the user will want to see them all at the same time to decide.

Add the following code as the first argument to {sidebarPanel}(), which just takes a list of different widgets. {radioButtons}() is the widget we're using. We'll set four arguments:

\begin{itemize}
\tightlist
\item
  {inputId}: a unique identifier that we will use later in the code to find the value of this widget
\item
  {label}: the text to display to the user
\item
  {choices}: a list of choices in the format \texttt{c("label1"\ =\ "value1",\ "label2\ =\ "value2",\ ...)}
\item
  {selected}: the value of the default choice
\end{itemize}

For {choices}, the label is what gets shown to the user and the value is what gets used by the code (these can be the same, but you often want the user label to be more descriptive).

\begin{Shaded}
\begin{Highlighting}[]
         \FunctionTok{radioButtons}\NormalTok{(}\AttributeTok{inputId =} \StringTok{"display\_var"}\NormalTok{,}
                      \AttributeTok{label =} \StringTok{"Which variable to display"}\NormalTok{,}
                      \AttributeTok{choices =} \FunctionTok{c}\NormalTok{(}\StringTok{"Waiting time to next eruption"} \OtherTok{=} \StringTok{"waiting"}\NormalTok{,}
                                  \StringTok{"Eruption time"} \OtherTok{=} \StringTok{"eruptions"}\NormalTok{),}
                      \AttributeTok{selected =} \StringTok{"waiting"}
\NormalTok{         ),}
\end{Highlighting}
\end{Shaded}

Save this and re-run the app.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/demo_app/08-radiobutton-widget} 

}

\caption{A radioButton widget above a sliderInput widget.}\label{fig:first-radiobutton-widget}
\end{figure}

You should have a radio button interface now. You can click on the options to switch the button, but it won't do anything to your plot yet. We need to edit the plot-generating code to make that happen.

First, we need to change the x-axis label depending on what we're graphing. We use an if/else statement to set the variable \texttt{xlabel} to one thing if \texttt{input\$display\_var} is equivalent to {"eruptions"}, and to something else if it's equivalent to {"waiting"}. Put this code at the very beginning of the code block for {renderPlot}() (after the line \texttt{output\$distPlot\ \textless{}-\ renderPlot(\{}).

\begin{Shaded}
\begin{Highlighting}[]
      \CommentTok{\# set x{-}axis label depending on the value of display\_var}
      \ControlFlowTok{if}\NormalTok{ (input}\SpecialCharTok{$}\NormalTok{display\_var }\SpecialCharTok{==} \StringTok{"eruptions"}\NormalTok{) \{}
\NormalTok{        xlabel }\OtherTok{\textless{}{-}} \StringTok{"Eruption Time (in minutes)"}
\NormalTok{      \} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (input}\SpecialCharTok{$}\NormalTok{display\_var }\SpecialCharTok{==} \StringTok{"waiting"}\NormalTok{) \{}
\NormalTok{        xlabel }\OtherTok{\textless{}{-}} \StringTok{"Waiting Time to Next Eruption (in minutes)"}
\NormalTok{      \}}
\end{Highlighting}
\end{Shaded}

The double-equal-signs \texttt{==} means "equivalent to and is how you check if two things are the same; if you only use one equal sign, you set the variable on the left to the value on the right.

Then we have to edit {ggplot} to use the new label and to plot the correct column. The variable \texttt{input\$display\_var} gives you the user-input value of the widget called \texttt{"display\_var"}.

\begin{Shaded}
\begin{Highlighting}[]
      \CommentTok{\# create plot}
      \FunctionTok{ggplot}\NormalTok{(faithful, }\FunctionTok{aes}\NormalTok{(.data[[input}\SpecialCharTok{$}\NormalTok{display\_var]])) }\SpecialCharTok{+}
        \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{bins =}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{bins,}
                       \AttributeTok{fill =} \StringTok{"steelblue3"}\NormalTok{,}
                       \AttributeTok{colour =} \StringTok{"grey30"}\NormalTok{) }\SpecialCharTok{+}
        \FunctionTok{xlab}\NormalTok{(xlabel) }\SpecialCharTok{+}
        \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Notice that the code \texttt{aes(waiting)} from before has changed to \texttt{aes(.data{[}{[}input\$display\_var{]}{]})}. Because \texttt{input\$display\_var} is a string, we have to select it from the \texttt{.data} placeholder (which refers to the \texttt{faithful} data table) using double brackets.

Re-run your app and see if you can change the data and x-axis label with your new widget.

\hypertarget{app-structure}{%
\section{App Structure}\label{app-structure}}

Now that we've made and modified our first working app, it's time to learn a bit about how a shiny app is structured.

A shiny app is made of two main parts, a UI, which defines what the user interface looks like, and a server function, which defines how the interface behaves. The function {shinyApp}() puts the two together to run the application in a web browser.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Setup {-}{-}{-}{-}}
\FunctionTok{library}\NormalTok{(shiny)}

\CommentTok{\# Define UI {-}{-}{-}{-}}
\NormalTok{ui }\OtherTok{\textless{}{-}} \FunctionTok{fluidPage}\NormalTok{()}

\CommentTok{\# Define server logic {-}{-}{-}{-}}
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output) \{}
\NormalTok{\}}

\CommentTok{\# Run the application {-}{-}{-}{-}}
\FunctionTok{shinyApp}\NormalTok{(}\AttributeTok{ui =}\NormalTok{ ui, }\AttributeTok{server =}\NormalTok{ server)}
\end{Highlighting}
\end{Shaded}

Create a new app called ``basic\_demo'' and replace all the text in app.R with the code above. You should be able to run the app and see just a blank page.

\hypertarget{ui}{%
\subsection{UI}\label{ui}}

The UI is created by one of the ui-building \texttt{\textbackslash{}*Page()} functions, such as {fluidPage}(), {fixedPage}(), {fillPage}() or {dashboardPage}() (which we'll learn more about in Section~\ref{shinydashboard}). The ui-building functions set up the parts of the webpage, which are created by more shiny functions that you list inside of the page function, separated by commas.

\hypertarget{tags}{%
\subsection{Tags}\label{tags}}

For example, the code below displays:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  a title panel with the text ``Basic Demo''
\item
  a level-two header with the text ``My favourite things''
\item
  an unordered list ({tags\(ul</span>()</code>) containing several list items (<code><span class='fu'>tags\)li}())
\item
  a paragraph with the text ``This is a very basic demo.''
\item
  an image of the shinyintro logo with a width and height of 100 pixels
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ui }\OtherTok{\textless{}{-}} \FunctionTok{fluidPage}\NormalTok{(}
  \FunctionTok{titlePanel}\NormalTok{(}\StringTok{"Basic Demo"}\NormalTok{),}
  \FunctionTok{h2}\NormalTok{(}\StringTok{"My favourite things"}\NormalTok{),}
\NormalTok{  tags}\SpecialCharTok{$}\FunctionTok{ul}\NormalTok{(tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Coding"}\NormalTok{),}
\NormalTok{          tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Cycling"}\NormalTok{),}
\NormalTok{          tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Cooking"}\NormalTok{)),}
  \FunctionTok{p}\NormalTok{(}\StringTok{"This is a very basic demo."}\NormalTok{),}
\NormalTok{  tags}\SpecialCharTok{$}\FunctionTok{img}\NormalTok{(}
    \AttributeTok{src =} \StringTok{"https://debruine.github.io/shinyintro/images/shinyintro.png"}\NormalTok{,}
    \AttributeTok{width =} \StringTok{"100px"}\NormalTok{,}
    \AttributeTok{height =} \StringTok{"100px"}
\NormalTok{  )}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Many of the functions used to create parts of the website are the same as HTML tags, which are ways to mark the beginning and end of different types of text. Most HTML tags are available in shiny by using one of the {tags}() sub-functions, but some of the more common tags, like {p}() or {h1}()-{h6}()also have a version where you can omit the\texttt{tags\textbackslash{}\$} part. You can see a list of all of the tags available in Shiny at the \href{https://shiny.rstudio.com/articles/tag-glossary.html}{tag glossary}

Add the code above to your basic\_demo app and replace my favourite things with yours. Make the list an ordered list (instead of unordered) and change the image size.

\hypertarget{page-layout}{%
\subsection{Page Layout}\label{page-layout}}

You usually want your apps to have a more complex layout than just each element stacked below the previous one. The code below wraps the elements after the title panel inside {flowLayout}().

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ui }\OtherTok{\textless{}{-}} \FunctionTok{fluidPage}\NormalTok{(}\FunctionTok{titlePanel}\NormalTok{(}\StringTok{"Basic Demo"}\NormalTok{),}
                \FunctionTok{flowLayout}\NormalTok{(}
                  \FunctionTok{h2}\NormalTok{(}\StringTok{"My favourite things"}\NormalTok{),}
\NormalTok{                  tags}\SpecialCharTok{$}\FunctionTok{ul}\NormalTok{(tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Coding"}\NormalTok{),}
\NormalTok{                          tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Cycling"}\NormalTok{),}
\NormalTok{                          tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Cooking"}\NormalTok{)),}
                  \FunctionTok{p}\NormalTok{(}\StringTok{"This is a very basic demo."}\NormalTok{),}
\NormalTok{                  tags}\SpecialCharTok{$}\FunctionTok{img}\NormalTok{(}
                    \AttributeTok{src =} \StringTok{"https://debruine.github.io/shinyintro/images/shinyintro.png"}\NormalTok{,}
                    \AttributeTok{width =} \StringTok{"100px"}\NormalTok{,}
                    \AttributeTok{height =} \StringTok{"100px"}
\NormalTok{                  )}
\NormalTok{                ))}
\end{Highlighting}
\end{Shaded}

Replace the ui code in your basic\_demo app with the code above and run it in a web browser. What happens when you change the width of the web browser? Change {flowLayout}() to {verticalLayout}() or {splitLayout}() and see what changes.

You can use a {sidebarLayout}() to arrange your elements into a {sidebarPanel}() and a {mainPanel}(). If the browser width is too narrow, the sidebar will display on top of the main panel.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ui }\OtherTok{\textless{}{-}} \FunctionTok{fluidPage}\NormalTok{(}\FunctionTok{titlePanel}\NormalTok{(}\StringTok{"Basic Demo"}\NormalTok{),}
                \FunctionTok{sidebarLayout}\NormalTok{(}\FunctionTok{sidebarPanel}\NormalTok{(}
                  \FunctionTok{h2}\NormalTok{(}\StringTok{"My favourite things"}\NormalTok{),}
\NormalTok{                  tags}\SpecialCharTok{$}\FunctionTok{ul}\NormalTok{(tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Coding"}\NormalTok{),}
\NormalTok{                          tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Cycling"}\NormalTok{),}
\NormalTok{                          tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Cooking"}\NormalTok{))}
\NormalTok{                ),}
                \FunctionTok{mainPanel}\NormalTok{(}
                  \FunctionTok{p}\NormalTok{(}\StringTok{"This is a very basic demo."}\NormalTok{),}
\NormalTok{                  tags}\SpecialCharTok{$}\FunctionTok{img}\NormalTok{(}
                    \AttributeTok{src =} \StringTok{"https://debruine.github.io/shinyintro/images/shinyintro.png"}\NormalTok{,}
                    \AttributeTok{width =} \StringTok{"100px"}\NormalTok{,}
                    \AttributeTok{height =} \StringTok{"100px"}
\NormalTok{                  )}
\NormalTok{                )))}
\end{Highlighting}
\end{Shaded}

\hypertarget{dynamic-elements}{%
\section{Dynamic Elements}\label{dynamic-elements}}

So far, we've just put static elements into our UI. What makes Shiny apps work is dynamic elements like inputs, outputs, and action buttons.

\hypertarget{inputs-intro}{%
\subsection{Inputs}\label{inputs-intro}}

Inputs are ways for the users of your app to communicate with the app, like drop-down menus or checkboxes. We'll go into the different types of inputs in Section~\ref{inputs}. Below we'll turn the list of favourite things into a group of checkboxes

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{checkboxGroupInput}\NormalTok{(}
  \AttributeTok{inputId =} \StringTok{"fav\_things"}\NormalTok{,}
  \AttributeTok{label =} \StringTok{"What are your favourite things?"}\NormalTok{,}
  \AttributeTok{choices =} \FunctionTok{c}\NormalTok{(}\StringTok{"Coding"}\NormalTok{, }\StringTok{"Cycling"}\NormalTok{, }\StringTok{"Cooking"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Most inputs are structured like this, with an inputId, which needs to be a unique string not used as the ID for any other input or output in your app, a label that contains the question, and a list of choices or other parameters that determine what type of values the input will record.

You might have noticed that the {sliderInput}() in the demo app didn't use the argument names for the {inputId} or the {label}(). All inputs need these first two arguments, so almost everyone omits their names.

\hypertarget{outputs-intro}{%
\subsection{Outputs}\label{outputs-intro}}

Outputs are placeholders for things that {server}() will create. There are different output functions for different types of outputs, like text, plots, and tables. We'll go into the different types of outputs in detail in Section~\ref{outputs}. Below, we'll make a placeholder for some text that we'll display after counting the number of favourite things.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{textOutput}\NormalTok{(}\AttributeTok{outputId =} \StringTok{"n\_fav\_things"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Most outputs are structured like this, with just a unique {outputId} (the argument name is also usually omitted).

\hypertarget{action-buttons}{%
\subsection{Action buttons}\label{action-buttons}}

Action buttons are a special type of input that register button clicks. Below we'll make an action button that users can click once they've selected all of their favourite things.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{actionButton}\NormalTok{(}\AttributeTok{inputId =} \StringTok{"count\_fav\_things"}\NormalTok{,}
             \AttributeTok{label =} \StringTok{"Count"}\NormalTok{,}
             \AttributeTok{icon =} \FunctionTok{icon}\NormalTok{(}\StringTok{"calculator"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Action buttons require a unique {inputId} and a {label} for the button text. You can also add an {icon}. Choose a free icon from \href{https://fontawesome.com/icons?d=gallery\&m=free}{fontawesome}.

Put the input, output, and action button into the ui and run it. You will see that the input checkboxes are selectable and the button is clickable, but nothing is displayed in the text output. We need some code in {server}() to handle that.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ui }\OtherTok{\textless{}{-}} \FunctionTok{fluidPage}\NormalTok{(}\FunctionTok{titlePanel}\NormalTok{(}\StringTok{"Basic Demo"}\NormalTok{),}
                \FunctionTok{sidebarLayout}\NormalTok{(}
                  \FunctionTok{sidebarPanel}\NormalTok{(}
                    \FunctionTok{checkboxGroupInput}\NormalTok{(}
                      \AttributeTok{inputId =} \StringTok{"fav\_things"}\NormalTok{,}
                      \AttributeTok{label =} \StringTok{"What are your favourite things?"}\NormalTok{,}
                      \AttributeTok{choices =} \FunctionTok{c}\NormalTok{(}\StringTok{"Coding"}\NormalTok{, }\StringTok{"Cycling"}\NormalTok{, }\StringTok{"Cooking"}\NormalTok{)}
\NormalTok{                    ),}
                    \FunctionTok{actionButton}\NormalTok{(}
                      \AttributeTok{inputId =} \StringTok{"count\_fav\_things"}\NormalTok{,}
                      \AttributeTok{label =} \StringTok{"Count"}\NormalTok{,}
                      \AttributeTok{icon =} \FunctionTok{icon}\NormalTok{(}\StringTok{"calculator"}\NormalTok{)}
\NormalTok{                    )}
\NormalTok{                  ),}
                  \FunctionTok{mainPanel}\NormalTok{(}\FunctionTok{textOutput}\NormalTok{(}\AttributeTok{outputId =} \StringTok{"n\_fav\_things"}\NormalTok{))}
\NormalTok{                ))}
\end{Highlighting}
\end{Shaded}

\hypertarget{first-reactive}{%
\section{Reactive functions}\label{first-reactive}}

Reactive functions are functions that only run when certain types of inputs change. Inside {server}(), the object \texttt{input} is a named list of the values of all of the inputs. For example, if you want to know which items in the select input named {"fav\_things"} were selected, you would use \texttt{input\$fav\_things}.

Here, we just want to count how many items are checked. We want to do this whenever the button {"count\_fav\_things"} is clicked, so we can use the reactive function {observeEvent}() to do this. Every time the value of \texttt{input\$count\_fav\_things} changes (which happens when it is clicked), it will run the code inside of the curly brackets \texttt{\{\}}. The code will only run when \texttt{input\$count\_fav\_things} changes, not when any inputs inside the function change.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output) \{}
  \CommentTok{\# count favourite things}
  \FunctionTok{observeEvent}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{count\_fav\_things, \{}
\NormalTok{    n }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{fav\_things)}
\NormalTok{    count\_text }\OtherTok{\textless{}{-}} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"You have \%d favourite things"}\NormalTok{, n)}
\NormalTok{  \})}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Now we want to display this text in the output {"n\_fav\_things"}. We need to use a render function that is paired with our output function. Since ``n\_fav\_things'' was made with {textOutput}(), we fill it with {renderText}().

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output) \{}
  \CommentTok{\# count favourite things}
  \FunctionTok{observeEvent}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{count\_fav\_things, \{}
\NormalTok{    n }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{fav\_things)}
\NormalTok{    count\_text }\OtherTok{\textless{}{-}} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"You have \%d favourite things"}\NormalTok{, n)}
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{n\_fav\_things }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(count\_text)}
\NormalTok{  \})}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

As always in coding, there are many ways to accomplish the same thing. These methods have different pros and cons that we'll learn more about in Section~\ref{reactives}. Here is another pattern that does that same as above.

This pattern uses {reactive}() to create a new function called {count\_text}(), which updates the value it returns whenever any inputs inside the reactive function change. We use {isolate}() to prevent {count\_text}() from changing when users click the checkboxes.

Whenever the returned value of {count\_text}() changes, this triggers an update of the {"n\_fav\_things"} output.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output) \{}
  \CommentTok{\# update count\_text on fav\_things}
\NormalTok{  count\_text }\OtherTok{\textless{}{-}} \FunctionTok{reactive}\NormalTok{(\{}
\NormalTok{    input}\SpecialCharTok{$}\NormalTok{count\_fav\_things }\CommentTok{\# just here to trigger the reactive}
\NormalTok{    fav\_things }\OtherTok{\textless{}{-}}
      \FunctionTok{isolate}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{fav\_things) }\CommentTok{\# don\textquotesingle{}t trigger on checks}
\NormalTok{    n }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(fav\_things)}
    \FunctionTok{sprintf}\NormalTok{(}\StringTok{"You have \%d favourite things"}\NormalTok{, n)}
\NormalTok{  \})}
  
  \CommentTok{\# display count\_text when it updates}
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{n\_fav\_things }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(}\FunctionTok{count\_text}\NormalTok{())}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Compare the app behaviour with the first pattern versus the second. How are they different? What happens if you remove {isolate}() from around \texttt{input\$fav\_things}?

\hypertarget{resources-first-app}{%
\section{Further Resources}\label{resources-first-app}}

\begin{itemize}
\tightlist
\item
  \href{https://mastering-shiny.org/}{Mastering Shiny: Chapters 1-3}
\item
  \href{https://shiny.rstudio.com/tutorial/}{RStudio Shiny Tutorials: Videos 1-6}
\item
  \href{https://shiny.rstudio.com/articles/layout-guide.html}{Application layout guide}
\end{itemize}

\hypertarget{exercises-first-app}{%
\section{Exercises}\label{exercises-first-app}}

\hypertarget{addition-app---ui}{%
\subsection{Addition App - UI}\label{addition-app---ui}}

Create the UI for following \href{https://shiny.psy.gla.ac.uk/debruine/add_demo/}{addition app}. Use {numericInput}() to create the inputs.

Solution

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ui }\OtherTok{\textless{}{-}} \FunctionTok{fluidPage}\NormalTok{(}\FunctionTok{titlePanel}\NormalTok{(}\StringTok{"Addition Demo"}\NormalTok{),}
                \FunctionTok{sidebarLayout}\NormalTok{(}
                  \FunctionTok{sidebarPanel}\NormalTok{(}
                    \FunctionTok{numericInput}\NormalTok{(}\StringTok{"n1"}\NormalTok{, }\StringTok{"First number"}\NormalTok{, }\DecValTok{0}\NormalTok{),}
                    \FunctionTok{numericInput}\NormalTok{(}\StringTok{"n2"}\NormalTok{, }\StringTok{"Second number"}\NormalTok{, }\DecValTok{0}\NormalTok{),}
                    \FunctionTok{actionButton}\NormalTok{(}\StringTok{"add"}\NormalTok{, }\StringTok{"Add Numbers"}\NormalTok{)}
\NormalTok{                  ),}
                  \FunctionTok{mainPanel}\NormalTok{(}\FunctionTok{textOutput}\NormalTok{(}\AttributeTok{outputId =} \StringTok{"n1\_plus\_n2"}\NormalTok{))}
\NormalTok{                ))}
\end{Highlighting}
\end{Shaded}

\hypertarget{observeevent}{%
\subsection{observeEvent}\label{observeevent}}

Use {observeEvent}() to write a server function that displays ``n1 + n2 = sum'' when you click the action button.

Solution

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output) \{}
  \CommentTok{\# add numbers}
  \FunctionTok{observeEvent}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{add, \{}
\NormalTok{    sum }\OtherTok{\textless{}{-}}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{n1 }\SpecialCharTok{+}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{n2}
\NormalTok{    add\_text }\OtherTok{\textless{}{-}} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%d + \%d = \%d"}\NormalTok{, input}\SpecialCharTok{$}\NormalTok{n1, input}\SpecialCharTok{$}\NormalTok{n2, sum)}
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{n1\_plus\_n2 }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(add\_text)}
\NormalTok{  \})}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{reactive}{%
\subsection{reactive}\label{reactive}}

Use {reactive}() to accomplish the same behaviour.

Solution

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output) \{}
\NormalTok{  add\_text }\OtherTok{\textless{}{-}} \FunctionTok{reactive}\NormalTok{(\{}
\NormalTok{    input}\SpecialCharTok{$}\NormalTok{add }\CommentTok{\# triggers reactive}
\NormalTok{    n1 }\OtherTok{\textless{}{-}} \FunctionTok{isolate}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{n1)}
\NormalTok{    n2 }\OtherTok{\textless{}{-}} \FunctionTok{isolate}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{n2)}
    \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%d + \%d = \%d"}\NormalTok{, n1, n2, n1 }\SpecialCharTok{+}\NormalTok{ n2)}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{n1\_plus\_n2 }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(}\FunctionTok{add\_text}\NormalTok{())}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{shinydashboard}{%
\chapter{ShinyDashboard}\label{shinydashboard}}

\href{https://rstudio.github.io/shinydashboard/}{Shinydashboard} is an R package that provides functions to upgrade the appearance and function of your Shiny apps.

\hypertarget{basic-template-for-shinydashboard-projects}{%
\section{Basic template for shinydashboard projects}\label{basic-template-for-shinydashboard-projects}}

The shinyintro package provides a basic template for a shinydashboard project.

You can start a new app using the template with the code \texttt{shinyintro::clone("basic\_template",\ "myapp")}. This will create a new directory called myapp in your working directory and open the app.R file in RStudio.

This directory contains:

\begin{itemize}
\tightlist
\item
  app.R: the file where you define the ui and server
\item
  DESCRIPTION: A file that contains some structured info about the app
\item
  README.md: A file that can contain any information you want
\item
  scripts: a directory that can contain external R code that you can source into the app.R file
\item
  www: a directory that contains helper files like images, CSS, and JavaScript
\end{itemize}

\hypertarget{dashboard-structure}{%
\section{Dashboard Structure}\label{dashboard-structure}}

Notice that the ui is created with {dashboardPage}() now. This needs to be set up a little differently than {fluidPage}(). The main parts of a dashboard page are the header, sidebar, and body.

You can also change the default {skin} colour. Possible skin colours are: {"red"}, {"yellow"} (looks orange to me), {"green"}, {"blue"}, {"purple"}, and {"black"}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dashboardPage}\NormalTok{(}
    \AttributeTok{skin =} \StringTok{"purple"}\NormalTok{,}
    \FunctionTok{dashboardHeader}\NormalTok{(),}
    \FunctionTok{dashboardSidebar}\NormalTok{(),}
    \FunctionTok{dashboardBody}\NormalTok{()}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{dashboardheader}{%
\subsection{dashboardHeader}\label{dashboardheader}}

You can add a title to the header, and change the title width.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dashboardHeader}\NormalTok{(}
  \AttributeTok{title =} \StringTok{"Basic Template"}\NormalTok{, }
  \AttributeTok{titleWidth =} \StringTok{"calc(100\% {-} 44px)"} \CommentTok{\# puts sidebar toggle on right}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You can also include message, notification, and task menus in the header. We won't be using those in this class, but you can learn more at \href{https://rstudio.github.io/shinydashboard/structure.html\#message-menus}{the shinydashboard site}.

If you don't want to use a header, include \texttt{dashboardHeader(disable\ =\ TRUE)} inside {dashboardPage}().

\hypertarget{dashboardsidebar}{%
\subsection{dashboardSidebar}\label{dashboardsidebar}}

The sidebar usually contains a {sidebarMenu}(), which needs a unique ID and a list of menu items. Each {menuItem}() consists of the {title}, a {tabName} that will be used to refer to the tab later, and an {icon}. You can find a list of the available free icons at \href{https://fontawesome.com/icons?d=gallery\&m=free}{fontawesome}.

You can also add in any other elements to the sidebar. The code below adds a link using {tags\$a}() Text inside of the sidebar usually looks too close to the edges, so we use \protect\hyperlink{CSS}{css} to style the link and add padding.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dashboardSidebar}\NormalTok{(}
    \FunctionTok{sidebarMenu}\NormalTok{(}
        \AttributeTok{id =} \StringTok{"tabs"}\NormalTok{,}
        \FunctionTok{menuItem}\NormalTok{(}\StringTok{"Tab Title"}\NormalTok{, }\AttributeTok{tabName =} \StringTok{"x\_tab"}\NormalTok{, }\AttributeTok{icon =} \FunctionTok{icon}\NormalTok{(}\StringTok{"dragon"}\NormalTok{))}
\NormalTok{    ),}
\NormalTok{    tags}\SpecialCharTok{$}\FunctionTok{a}\NormalTok{(}\AttributeTok{href =} \StringTok{"https://debruine.github.io/shinyintro/"}\NormalTok{, }
           \StringTok{"ShinyIntro book"}\NormalTok{, }\AttributeTok{style=}\StringTok{"padding: 1em;"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If you don't want to use a sidebar, include \texttt{dashboardSidebar(disable\ =\ TRUE)} inside {dashboardPage}().

\hypertarget{dashboardbody}{%
\subsection{dashboardBody}\label{dashboardbody}}

The main part of the app goes inside {dashboardBody}() If you're going to use javascript functions (which the basic template does and we'll learn more about in Section~\ref{shinyjs}), you need to put {useShinyjs}() first. Then you include the header, linking to any custom CSS or JavaScript files.

The contents of the body go after that. The most common pattern is a multi-page tabbed pattern, which is set up with {tabItems}(), which contains a {tabItem}() for each tab. The {tabName} has to match the name you used in the sidebar {menuItem}(), so that tab shows when the user clicks on the corresponding menu item.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dashboardBody}\NormalTok{(}
\NormalTok{    shinyjs}\SpecialCharTok{::}\FunctionTok{useShinyjs}\NormalTok{(),}
\NormalTok{    tags}\SpecialCharTok{$}\FunctionTok{head}\NormalTok{(}
        \CommentTok{\# links to files in www/}
\NormalTok{        tags}\SpecialCharTok{$}\FunctionTok{link}\NormalTok{(}\AttributeTok{rel =} \StringTok{"stylesheet"}\NormalTok{, }\AttributeTok{type =} \StringTok{"text/css"}\NormalTok{, }\AttributeTok{href =} \StringTok{"custom.css"}\NormalTok{), }
\NormalTok{        tags}\SpecialCharTok{$}\FunctionTok{script}\NormalTok{(}\AttributeTok{src =} \StringTok{"custom.js"}\NormalTok{)}
\NormalTok{    ),}
    \FunctionTok{tabItems}\NormalTok{(}
        \FunctionTok{tabItem}\NormalTok{(}\AttributeTok{tabName =} \StringTok{"x\_tab"}\NormalTok{, }\FunctionTok{imageOutput}\NormalTok{(}\StringTok{"logo"}\NormalTok{))}
\NormalTok{    )}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Since each tab is usually a quite complex list of elements, I like to define each tab outside {dashboardPage}() and then just put a list of the tab objects inside {tabItems}(). This way, it's easy to move the whole tab definition to an external file if it gets too complex (see Section~\ref{structure}).

\hypertarget{body-structure}{%
\section{Body Structure}\label{body-structure}}

Tab items can be structured in several ways. At the simplest, you can just list each element after the {tabName}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tabItem}\NormalTok{(}
    \AttributeTok{tabName =} \StringTok{"demo\_tab"}\NormalTok{,}
    \FunctionTok{textInput}\NormalTok{(}\StringTok{"given"}\NormalTok{, }\StringTok{"Given Name"}\NormalTok{),}
    \FunctionTok{textInput}\NormalTok{(}\StringTok{"surname"}\NormalTok{, }\StringTok{"Surname"}\NormalTok{),}
    \FunctionTok{selectInput}\NormalTok{(}\StringTok{"pet"}\NormalTok{, }\StringTok{"What is your favourite pet?"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"cats"}\NormalTok{, }\StringTok{"dogs"}\NormalTok{, }\StringTok{"ferrets"}\NormalTok{)),}
    \FunctionTok{textAreaInput}\NormalTok{(}\StringTok{"bio"}\NormalTok{, }\ConstantTok{NULL}\NormalTok{, }\AttributeTok{height =} \StringTok{"100px"}\NormalTok{, }\AttributeTok{placeholder =} \StringTok{"brief bio"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{boxes}{%
\subsection{Boxes}\label{boxes}}

Most shinydashboard apps organise the parts inside boxes.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{() }
\FunctionTok{tabItem}\NormalTok{(}
    \AttributeTok{tabName =} \StringTok{"demo\_tab"}\NormalTok{,}
    \FunctionTok{box}\NormalTok{(}
      \FunctionTok{textInput}\NormalTok{(}\StringTok{"given"}\NormalTok{, }\StringTok{"Given Name"}\NormalTok{),}
      \FunctionTok{textInput}\NormalTok{(}\StringTok{"surname"}\NormalTok{, }\StringTok{"Surname"}\NormalTok{),}
      \FunctionTok{selectInput}\NormalTok{(}\StringTok{"pet"}\NormalTok{, }\StringTok{"What is your favourite pet?"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"cats"}\NormalTok{, }\StringTok{"dogs"}\NormalTok{, }\StringTok{"ferrets"}\NormalTok{))}
\NormalTok{    ),}
    \FunctionTok{box}\NormalTok{(}
       \FunctionTok{textAreaInput}\NormalTok{(}\StringTok{"bio"}\NormalTok{, }\ConstantTok{NULL}\NormalTok{, }\AttributeTok{height =} \StringTok{"100px"}\NormalTok{, }\AttributeTok{placeholder =} \StringTok{"brief bio"}\NormalTok{)}
\NormalTok{    )}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{images/sdb_layout2.png}

You can add titles to the boxes, make them collapsible and/or give them solid headers.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tabItem}\NormalTok{(}
    \AttributeTok{tabName =} \StringTok{"demo\_tab"}\NormalTok{,}
    \FunctionTok{box}\NormalTok{(}\AttributeTok{title =} \StringTok{"Personal Info"}\NormalTok{,}
        \AttributeTok{collapsible =} \ConstantTok{TRUE}\NormalTok{, }
        \FunctionTok{textInput}\NormalTok{(}\StringTok{"given"}\NormalTok{, }\StringTok{"Given Name"}\NormalTok{),}
        \FunctionTok{textInput}\NormalTok{(}\StringTok{"surname"}\NormalTok{, }\StringTok{"Surname"}\NormalTok{),}
        \FunctionTok{selectInput}\NormalTok{(}\StringTok{"pet"}\NormalTok{, }\StringTok{"What is your favourite pet?"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"cats"}\NormalTok{, }\StringTok{"dogs"}\NormalTok{, }\StringTok{"ferrets"}\NormalTok{))}
\NormalTok{    ),}
    \FunctionTok{box}\NormalTok{(}\AttributeTok{title =} \StringTok{"Biography"}\NormalTok{,}
        \AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{, }
        \FunctionTok{textAreaInput}\NormalTok{(}\StringTok{"bio"}\NormalTok{, }\ConstantTok{NULL}\NormalTok{, }\AttributeTok{height =} \StringTok{"100px"}\NormalTok{, }\AttributeTok{placeholder =} \StringTok{"brief bio"}\NormalTok{)}
\NormalTok{    )}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

In the normal shinydashboard style, solid headers only have a colour if the box also has the status argument set. In the basic template provided in this class, there is custom CSS to make solid headers the same colour as the theme skin, but you can also set the {status}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tabItem}\NormalTok{(}
    \AttributeTok{tabName =} \StringTok{"x\_tab"}\NormalTok{,}
    \FunctionTok{box}\NormalTok{(}\AttributeTok{title =} \StringTok{"No Status"}\NormalTok{, }\AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{),}
    \FunctionTok{box}\NormalTok{(}\AttributeTok{title =} \StringTok{"Primary"}\NormalTok{,   }\AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{status =} \StringTok{"primary"}\NormalTok{),}
    \FunctionTok{box}\NormalTok{(}\AttributeTok{title =} \StringTok{"Success"}\NormalTok{,   }\AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{status =} \StringTok{"success"}\NormalTok{),}
    \FunctionTok{box}\NormalTok{(}\AttributeTok{title =} \StringTok{"Info"}\NormalTok{,      }\AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{status =} \StringTok{"info"}\NormalTok{),}
    \FunctionTok{box}\NormalTok{(}\AttributeTok{title =} \StringTok{"Warning"}\NormalTok{,   }\AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{status =} \StringTok{"warning"}\NormalTok{),}
    \FunctionTok{box}\NormalTok{(}\AttributeTok{title =} \StringTok{"Danger"}\NormalTok{,    }\AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{status =} \StringTok{"danger"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/sdb_box_status} 

}

\caption{Shinydashboard Box Statuses.}\label{fig:sdb-box-status}
\end{figure}

\hypertarget{info-and-value-boxes}{%
\subsection{Info and Value Boxes}\label{info-and-value-boxes}}

You can use an {infoBox}() or a {valueBox}() to highlight a small amount of information. The default background is aqua, but the basic template changes this to the skin colour. However, you can customise this by setting the {color} argument.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tabItem}\NormalTok{(}
    \AttributeTok{tabName =} \StringTok{"x\_tab"}\NormalTok{,}
    \FunctionTok{infoBox}\NormalTok{(}\StringTok{"Default InfoBox"}\NormalTok{, }\StringTok{"Value"}\NormalTok{, }\StringTok{"Subtitle"}\NormalTok{),}
    \FunctionTok{valueBox}\NormalTok{(}\StringTok{"Default ValueBox"}\NormalTok{, }\StringTok{"With subtitle"}\NormalTok{),}
    \FunctionTok{valueBox}\NormalTok{(}\StringTok{"No subtitle"}\NormalTok{, }\StringTok{""}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/sdb_value_info} 

}

\caption{Examples of value and info boxes you can make.}\label{fig:sdb-value-info}
\end{figure}

Shinydashboard uses a grid system that is {12} units across. The default width of boxes is {6}, and info and value boxes are {4}.

Try to write the code to create the second row of info boxes show above and the third row of value boxes.

\hypertarget{tab-boxes}{%
\subsection{Tab Boxes}\label{tab-boxes}}

Create a box with multiple tabs using {tabBox}(), which contains {tabPanel}().

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tabItem}\NormalTok{(}
    \AttributeTok{tabName =} \StringTok{"demo\_tab"}\NormalTok{,}
    \FunctionTok{tabBox}\NormalTok{(}
        \AttributeTok{title =} \StringTok{"Test Yourself 1"}\NormalTok{,}
        \FunctionTok{tabPanel}\NormalTok{(}\StringTok{"Question"}\NormalTok{, }\StringTok{"What function creates tabBox contents?"}\NormalTok{),}
        \FunctionTok{tabPanel}\NormalTok{(}\StringTok{"Answer"}\NormalTok{, }\StringTok{"tabPanel()"}\NormalTok{)}
\NormalTok{    ),}
    \FunctionTok{tabBox}\NormalTok{(}
        \AttributeTok{title =} \StringTok{"Test Yourself 2"}\NormalTok{,}
        \AttributeTok{side =} \StringTok{"right"}\NormalTok{,}
        \AttributeTok{selected =} \StringTok{"Question"}\NormalTok{,}
        \FunctionTok{tabPanel}\NormalTok{(}\StringTok{"Answer"}\NormalTok{, }\StringTok{"selected"}\NormalTok{),}
        \FunctionTok{tabPanel}\NormalTok{(}\StringTok{"Question"}\NormalTok{, }\StringTok{"What attribute changes the default tab?"}\NormalTok{)}
\NormalTok{    )}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{images/sdb_tab_box.png}

\hypertarget{row-layout}{%
\subsection{Row Layout}\label{row-layout}}

You can arrange the boxes inside a {fluidRow}(). Set the box height in pixels. If the window gets too narrow, the boxes will move to stack instead of be in rows.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tabItem}\NormalTok{(}
    \AttributeTok{tabName =} \StringTok{"demo\_tab"}\NormalTok{,}
    \FunctionTok{fluidRow}\NormalTok{(}
      \FunctionTok{box}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\AttributeTok{title =} \StringTok{"2x100"}\NormalTok{, }\AttributeTok{width =} \DecValTok{2}\NormalTok{, }\AttributeTok{height =} \DecValTok{100}\NormalTok{),}
      \FunctionTok{box}\NormalTok{(}\StringTok{"B"}\NormalTok{, }\AttributeTok{title =} \StringTok{"1x100"}\NormalTok{, }\AttributeTok{width =} \DecValTok{1}\NormalTok{, }\AttributeTok{height =} \DecValTok{100}\NormalTok{),}
      \FunctionTok{box}\NormalTok{(}\StringTok{"C"}\NormalTok{, }\AttributeTok{title =} \StringTok{"2x200"}\NormalTok{, }\AttributeTok{width =} \DecValTok{2}\NormalTok{, }\AttributeTok{height =} \DecValTok{200}\NormalTok{),}
      \FunctionTok{box}\NormalTok{(}\StringTok{"D"}\NormalTok{, }\AttributeTok{title =} \StringTok{"3x300"}\NormalTok{, }\AttributeTok{width =} \DecValTok{3}\NormalTok{, }\AttributeTok{height =} \DecValTok{300}\NormalTok{),}
      \FunctionTok{box}\NormalTok{(}\StringTok{"E"}\NormalTok{, }\AttributeTok{title =} \StringTok{"4x100"}\NormalTok{, }\AttributeTok{width =} \DecValTok{4}\NormalTok{, }\AttributeTok{height =} \DecValTok{100}\NormalTok{),}
      \FunctionTok{box}\NormalTok{(}\StringTok{"F"}\NormalTok{, }\AttributeTok{title =} \StringTok{"5x100"}\NormalTok{, }\AttributeTok{width =} \DecValTok{5}\NormalTok{, }\AttributeTok{height =} \DecValTok{100}\NormalTok{),}
      \FunctionTok{box}\NormalTok{(}\StringTok{"G"}\NormalTok{, }\AttributeTok{title =} \StringTok{"7x100"}\NormalTok{, }\AttributeTok{width =} \DecValTok{7}\NormalTok{, }\AttributeTok{height =} \DecValTok{100}\NormalTok{)}
\NormalTok{    )}
\end{Highlighting}
\end{Shaded}

\includegraphics{images/sdb_row_layout.png}

\hypertarget{column-layout}{%
\subsection{Column Layout}\label{column-layout}}

Alternatively, you can arrange boxes or other elements inside a {column}() with a specific {width}. Elements inside this column have a width relative to the column width, so no matter what value you set the column {width} to, an element inside with a {width} of {6} will be half the column width.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tabItem}\NormalTok{(}
    \AttributeTok{tabName =} \StringTok{"demo\_tab"}\NormalTok{,}
    \FunctionTok{column}\NormalTok{(}\AttributeTok{width =} \DecValTok{6}\NormalTok{,}
        \FunctionTok{box}\NormalTok{(}\StringTok{"A"}\NormalTok{, }\AttributeTok{title =} \StringTok{"12x100"}\NormalTok{, }\AttributeTok{width =} \DecValTok{12}\NormalTok{, }\AttributeTok{height =} \DecValTok{100}\NormalTok{),}
        \FunctionTok{box}\NormalTok{(}\StringTok{"B"}\NormalTok{, }\AttributeTok{title =} \StringTok{"6x100"}\NormalTok{, }\AttributeTok{width =} \DecValTok{6}\NormalTok{, }\AttributeTok{height =} \DecValTok{100}\NormalTok{),}
        \FunctionTok{box}\NormalTok{(}\StringTok{"C"}\NormalTok{, }\AttributeTok{title =} \StringTok{"6x200"}\NormalTok{, }\AttributeTok{width =} \DecValTok{6}\NormalTok{, }\AttributeTok{height =} \DecValTok{200}\NormalTok{)}
\NormalTok{    ), }
    \FunctionTok{column}\NormalTok{(}\AttributeTok{width =} \DecValTok{4}\NormalTok{,}
        \FunctionTok{box}\NormalTok{(}\StringTok{"D"}\NormalTok{, }\AttributeTok{title =} \StringTok{"12x300"}\NormalTok{, }\AttributeTok{width =} \DecValTok{12}\NormalTok{, }\AttributeTok{height =} \DecValTok{300}\NormalTok{),}
        \FunctionTok{box}\NormalTok{(}\StringTok{"E"}\NormalTok{, }\AttributeTok{title =} \StringTok{"12x100"}\NormalTok{, }\AttributeTok{width =} \DecValTok{12}\NormalTok{, }\AttributeTok{height =} \DecValTok{100}\NormalTok{)}
\NormalTok{    ),}
    \FunctionTok{column}\NormalTok{(}\AttributeTok{width =} \DecValTok{2}\NormalTok{,}
        \FunctionTok{box}\NormalTok{(}\StringTok{"F"}\NormalTok{, }\AttributeTok{title =} \StringTok{"12x100"}\NormalTok{, }\AttributeTok{width =} \DecValTok{12}\NormalTok{, }\AttributeTok{height =} \DecValTok{100}\NormalTok{),}
        \FunctionTok{box}\NormalTok{(}\StringTok{"G"}\NormalTok{, }\AttributeTok{title =} \StringTok{"12x100"}\NormalTok{, }\AttributeTok{width =} \DecValTok{12}\NormalTok{, }\AttributeTok{height =} \DecValTok{100}\NormalTok{)}
\NormalTok{    )}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{images/sdb_column_layout.png}

\hypertarget{resources-shinydashboard}{%
\section{Further Resources}\label{resources-shinydashboard}}

\begin{itemize}
\tightlist
\item
  \href{https://rstudio.github.io/shinydashboard/}{ShinyDashboard}
\end{itemize}

\hypertarget{your-app-sdb}{%
\section{Your App}\label{your-app-sdb}}

\hypertarget{create-an-app-from-the-basic-template}{%
\subsection{Create an app from the basic template}\label{create-an-app-from-the-basic-template}}

\begin{itemize}
\tightlist
\item
  Create a demo app from the basic template and run it.
\item
  Close the app and run it again.
\item
  Look at the code to see how the theme colour and sidebar icon change.
\item
  Change the title and author in the DESCRIPTION file and set DisplayMode to ``Showcase'' instead of ``Normal'' to see what happens when you run it.
\end{itemize}

\hypertarget{customise-the-header}{%
\subsection{Customise the header}\label{customise-the-header}}

\begin{itemize}
\tightlist
\item
  Change the {title} to the title of the app you want to build.
\item
  Choose a {skin} color.
\item
  Experiment with different values for the {titleWidth} argument. Try {"50\%"} or {"200px"} and see how the title behaves when you change the width of the browser window.
\end{itemize}

\hypertarget{customise-the-sidebar}{%
\subsection{Customise the sidebar}\label{customise-the-sidebar}}

\begin{itemize}
\tightlist
\item
  Add tabs to the {sidebarMenu}() for the pages of your custom app.
\item
  Choose appropriate {icon} for each tab.
\item
  Remove the link to the ShinyIntro book and add some information about your app, like the author or a use license.
\end{itemize}

\hypertarget{customise-the-body}{%
\subsection{Customise the body}\label{customise-the-body}}

\begin{itemize}
\tightlist
\item
  Create an empty {tabItem}() for each tab you put in the {sidebarMenu}() and add them to the {dashboardBody}().
\item
  Start adding elements to each tab, such as a list of inputs with questions or a {plotOutput}() to display a feedback plot.
\item
  Experiment with different ways to display the elements by grouping them into boxes
\item
  Experiment with different layouts for your boxes and elements.
\item
  Make sure you check how the app looks on different sized screens, such as phone screens.
\end{itemize}

\hypertarget{inputs}{%
\chapter{Inputs}\label{inputs}}

\hypertarget{input-functions}{%
\section{Input functions}\label{input-functions}}

Inputs are ways that users can communicate information to the Shiny app. Explore some different input types in the embedded app below before you read about how to set up each type.

\hypertarget{textinput}{%
\subsection{textInput}\label{textinput}}

{textInput}() creates a one-line box for short text input. The first argument, {inputId} (the argument name is usually omitted), needs to be a unique string that you cannot use for another input or output in this app.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{demo\_text }\OtherTok{\textless{}{-}} 
  \FunctionTok{textInput}\NormalTok{(}\StringTok{"demo\_text"}\NormalTok{, }
            \AttributeTok{label =} \StringTok{"Name"}\NormalTok{, }
            \AttributeTok{value =} \StringTok{""}\NormalTok{, }
            \AttributeTok{width =} \StringTok{"100\%"}\NormalTok{,}
            \AttributeTok{placeholder =} \StringTok{"Your Name"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Experiment with the values of {label}, {value}, {width}, and {placeholder} to see what they do.

\hypertarget{textareainput}{%
\subsection{textAreaInput}\label{textareainput}}

{textAreaInput}() creates a multi-line box for longer text input.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{demo\_textarea }\OtherTok{\textless{}{-}} 
  \FunctionTok{textAreaInput}\NormalTok{(}\StringTok{"demo\_textarea"}\NormalTok{, }
                \AttributeTok{label =} \StringTok{"Biography"}\NormalTok{, }
                \AttributeTok{value =} \StringTok{""}\NormalTok{,}
                \AttributeTok{width =} \StringTok{"100\%"}\NormalTok{,}
                \AttributeTok{rows =} \DecValTok{5}\NormalTok{, }
                \AttributeTok{placeholder =} \StringTok{"Tell us something interesting about you."}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

What is the {inputId} of the widget above?
textAreaInput demo\_textarea Biography

\hypertarget{selectinput}{%
\subsection{selectInput}\label{selectinput}}

{selectInput}() creates a drop-down menu. Set the first {choice} to \texttt{""} to default to \texttt{NA}. If your choices are a named list or vector, the names are what is shown and the values are what is recorded. If the choices aren't named, the displayed and recorded values are the same.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{demo\_select }\OtherTok{\textless{}{-}} 
  \FunctionTok{selectInput}\NormalTok{(}\StringTok{"demo\_select"}\NormalTok{, }
              \AttributeTok{label =} \StringTok{"Do you like Shiny?"}\NormalTok{, }
              \AttributeTok{choices =} \FunctionTok{list}\NormalTok{(}\StringTok{""}\NormalTok{, }
                             \StringTok{"Yes, I do"} \OtherTok{=} \StringTok{"y"}\NormalTok{, }
                             \StringTok{"No, I don\textquotesingle{}t"} \OtherTok{=} \StringTok{"n"}\NormalTok{),}
              \AttributeTok{selected =} \ConstantTok{NULL}\NormalTok{,}
              \AttributeTok{width =} \StringTok{"100\%"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If you set {multiple} to {TRUE}, you can also make a select where users can choose multiple options.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{genders }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{( }\CommentTok{\# no blank needed}
  \StringTok{"Non{-}binary"} \OtherTok{=} \StringTok{"nb"}\NormalTok{,}
  \StringTok{"Male"} \OtherTok{=} \StringTok{"m"}\NormalTok{,}
  \StringTok{"Female"} \OtherTok{=} \StringTok{"f"}\NormalTok{,}
  \StringTok{"Agender"} \OtherTok{=} \StringTok{"a"}\NormalTok{,}
  \StringTok{"Gender Fluid"} \OtherTok{=} \StringTok{"gf"}
\NormalTok{)}

\NormalTok{demo\_select\_multi }\OtherTok{\textless{}{-}} 
  \FunctionTok{selectInput}\NormalTok{(}\StringTok{"demo\_select2"}\NormalTok{, }
              \AttributeTok{label =} \StringTok{"Gender (select all that apply)"}\NormalTok{, }
              \AttributeTok{choices =}\NormalTok{ genders,}
              \AttributeTok{selected =} \ConstantTok{NULL}\NormalTok{,}
              \AttributeTok{multiple =} \ConstantTok{TRUE}\NormalTok{, }
              \AttributeTok{selectize =} \ConstantTok{FALSE}\NormalTok{,}
              \AttributeTok{size =} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{checkboxgroupinput}{%
\subsection{checkboxGroupInput}\label{checkboxgroupinput}}

However, this interface almost always looks better with {checkboxGroupInput}().

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{demo\_cbgi }\OtherTok{\textless{}{-}}
  \FunctionTok{checkboxGroupInput}\NormalTok{(}\StringTok{"demo\_cbgi"}\NormalTok{,}
                     \AttributeTok{label =} \StringTok{"Gender (select all that apply)"}\NormalTok{,}
                     \AttributeTok{choices =}\NormalTok{ genders)}
\end{Highlighting}
\end{Shaded}

How can you get the checkboxes to display horizontally instead of vertically?\\
display = 'horizontal' class = 'horiz' inline = TRUE class = 'shiny-input-container-inline'

\hypertarget{checkboxinput}{%
\subsection{checkboxInput}\label{checkboxinput}}

You can also make a single checkbox with {checkboxInput}(). The {value} is {TRUE} when checked and {FALSE} when not.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{demo\_cb }\OtherTok{\textless{}{-}} \FunctionTok{checkboxInput}\NormalTok{(}\StringTok{"demo\_cb"}\NormalTok{,}
                         \AttributeTok{label =} \StringTok{"I love R"}\NormalTok{,}
                         \AttributeTok{value =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

{sliderInput}() allows you to choose numbers between a {min} and {max} value.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{demo\_slider }\OtherTok{\textless{}{-}} \FunctionTok{sliderInput}\NormalTok{(}\StringTok{"demo\_slider"}\NormalTok{,}
                           \AttributeTok{label =} \StringTok{"Age"}\NormalTok{,}
                           \AttributeTok{min =} \DecValTok{0}\NormalTok{,}
                           \AttributeTok{max =} \DecValTok{100}\NormalTok{,}
                           \AttributeTok{value =} \DecValTok{0}\NormalTok{,}
                           \AttributeTok{step =} \DecValTok{1}\NormalTok{,}
                           \AttributeTok{width =} \StringTok{"100\%"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

What happens if you change {value} or {step}? Try changing {value} to \texttt{c(10,\ 20)}.

\hypertarget{radiobuttons}{%
\subsection{radioButtons}\label{radiobuttons}}

If you want users to only be able to choose one options and there are a small number of short options, {radioButton}() is a good interface.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{demo\_radio }\OtherTok{\textless{}{-}} \FunctionTok{radioButtons}\NormalTok{(}\StringTok{"demo\_radio"}\NormalTok{,}
                           \AttributeTok{label =} \StringTok{"Choose one"}\NormalTok{,}
                           \AttributeTok{choices =} \FunctionTok{c}\NormalTok{(}\StringTok{"Cats"}\NormalTok{, }\StringTok{"Dogs"}\NormalTok{),}
                           \AttributeTok{selected =} \FunctionTok{character}\NormalTok{(}\DecValTok{0}\NormalTok{),}
                           \AttributeTok{inline =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Radio buttons default to selecting the first item unless you set {selected} to a choice value or \texttt{character(0)} to start with no selection.

\hypertarget{dateinput}{%
\subsection{dateInput}\label{dateinput}}

I find the date interface a little clunky, but that might just be because I have to click the back button on the year interface 44 time to find my birthdate. However, it also allows you to type in a date following the format that you can set.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{demo\_date }\OtherTok{\textless{}{-}} \FunctionTok{dateInput}\NormalTok{(}\StringTok{"demo\_date"}\NormalTok{,}
                       \AttributeTok{label =} \StringTok{"What is your birth date?"}\NormalTok{,}
                       \AttributeTok{min =} \StringTok{"1900{-}01{-}01"}\NormalTok{,}
                       \AttributeTok{max =} \FunctionTok{Sys.Date}\NormalTok{(),}
                       \AttributeTok{format =} \StringTok{"yyyy{-}mm{-}dd"}\NormalTok{,}
                       \AttributeTok{startview =} \StringTok{"year"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

IMHO, the default of {"yyyy-mm-dd"} is the best because it sorts into chronological order. Don't let me catch you storing dates like {"m/d/yyyy"}.

What would you set {format} to in order to display dates like ``Sunday July 4, 2021''?\\
D M d, Y DD MM d, yyyy DAY MONTH day, YEAR D MM dd, yyyy

\hypertarget{fileinput}{%
\subsection{fileInput}\label{fileinput}}

Users can upload one or more files with {fileInput}(). The argument {acccept} lets you limit this to certain file types, but some browsers can bypass this requirement, so it's not fool-proof.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{demo\_file }\OtherTok{\textless{}{-}} \FunctionTok{fileInput}\NormalTok{(}\StringTok{"demo\_file"}\NormalTok{,}
                       \AttributeTok{label =} \StringTok{"Upload a data table"}\NormalTok{,}
                       \AttributeTok{multiple =} \ConstantTok{FALSE}\NormalTok{,}
                       \AttributeTok{accept =} \FunctionTok{c}\NormalTok{(}\StringTok{".csv"}\NormalTok{, }\StringTok{".tsv"}\NormalTok{),}
                       \AttributeTok{buttonLabel =} \StringTok{"Upload"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

What would you set {accept} to to accept any image file?\\
image/* .jpg jpg images .img

\hypertarget{setting-inputs-programatically}{%
\section{Setting inputs programatically}\label{setting-inputs-programatically}}

Sometimes you need to change the value of an input with code, such as when resetting a questionnaire or in response to an answer on another item. The following code resets all of the inputs above.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{updateTextInput}\NormalTok{(session, }\StringTok{"demo\_text"}\NormalTok{, }\AttributeTok{value =} \StringTok{""}\NormalTok{)}
\FunctionTok{updateTextAreaInput}\NormalTok{(session, }\StringTok{"demo\_textarea"}\NormalTok{, }\AttributeTok{value =} \StringTok{""}\NormalTok{)}
\FunctionTok{updateSelectInput}\NormalTok{(session, }\StringTok{"demo\_select"}\NormalTok{, }\AttributeTok{selected =} \StringTok{""}\NormalTok{)}
\FunctionTok{updateCheckboxGroupInput}\NormalTok{(session, }\StringTok{"demo\_cbgi"}\NormalTok{, }\AttributeTok{selected =} \FunctionTok{character}\NormalTok{(}\DecValTok{0}\NormalTok{))}
\FunctionTok{updateCheckboxInput}\NormalTok{(session, }\StringTok{"demo\_cb"}\NormalTok{, }\AttributeTok{value =} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{updateRadioButtons}\NormalTok{(session, }\StringTok{"demo\_radio"}\NormalTok{, }\AttributeTok{selected =} \FunctionTok{character}\NormalTok{(}\DecValTok{0}\NormalTok{))}
\FunctionTok{updateSliderInput}\NormalTok{(session, }\StringTok{"demo\_slider"}\NormalTok{, }\AttributeTok{value =} \DecValTok{0}\NormalTok{)}
\FunctionTok{updateDateInput}\NormalTok{(session, }\StringTok{"demo\_date"}\NormalTok{, }\AttributeTok{value =} \ConstantTok{NULL}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Note that select inputs, checkbox groups, and radio buttons use the argument {selected} and not {value}(). If you want to set all the values in a checkbox group or radio button group to unchecked, set \texttt{selected\ =\ character(0)}.

\hypertarget{resources-inputs}{%
\section{Further Reources}\label{resources-inputs}}

\begin{itemize}
\tightlist
\item
  \href{https://mastering-shiny.org/basic-ui.html\#inputs}{Mastering Shiny Section 2.2}
\item
  \href{https://vimeo.com/rstudioinc/review/131218530/212d8a5a7a/\#t=10m41s}{RStudio Shiny Tutorials}
\end{itemize}

\hypertarget{exercises-inputs}{%
\section{Exercises}\label{exercises-inputs}}

\hypertarget{pets}{%
\subsection{Pets}\label{pets}}

Create an interface that gets people to rate the following pets on a 9-point scale. You can use any option labels or input type you like.

\begin{itemize}
\tightlist
\item
  Dogs ðŸ•\\
\item
  Cats ðŸˆ\\
\item
  Birds ðŸ¦œ\\
\item
  Fish ðŸ \\
\item
  Mice ðŸ\\
\item
  Hedgehogs ðŸ¦”\\
\item
  Snakes ðŸ
\end{itemize}

\hypertarget{your-app-inputs}{%
\section{Your App}\label{your-app-inputs}}

In the app you're developing, add a tab for a questionnaire that you're interested in and set up the appropriate inputs.

Add a ``reset'' button to your questionnaire tab and write the {server}() code to reset all of its inputs.

\hypertarget{outputs}{%
\chapter{Outputs}\label{outputs}}

Output are ways that the Shiny app can dynamically display information to the user. In the user interface (UI), you create outputs with IDs that you reference in an associated rendering function inside the server function.

Explore some different output types in the embedded app below before you read about how to set up each type.

\hypertarget{text}{%
\section{Text}\label{text}}

{textOutput}() defaults to text inside a generic \texttt{\textless{}span\textgreater{}} or \texttt{\textless{}div\textgreater{}}, but you can use a different element with the {container} argument.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the UI function}
\FunctionTok{textOutput}\NormalTok{(}\StringTok{"demo\_text"}\NormalTok{, }\AttributeTok{container =}\NormalTok{ tags}\SpecialCharTok{$}\NormalTok{h3)}
\end{Highlighting}
\end{Shaded}

{renderText}() replaces the text of the linked element with its returned string.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the server function}
\NormalTok{output}\SpecialCharTok{$}\NormalTok{demo\_text }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(\{}
    \FunctionTok{sprintf}\NormalTok{(}\StringTok{"Plot of \%s"}\NormalTok{, input}\SpecialCharTok{$}\NormalTok{y)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

If you use {verbatimTextOutput}() in the UI (no change to the render function), it will show the output in a fixed-width font. This can be good for code or text you want the user to copy.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the UI function}
\FunctionTok{verbatimTextOutput}\NormalTok{(}\StringTok{"demo\_verbatim"}\NormalTok{)}

\CommentTok{\# in the server function}
\NormalTok{output}\SpecialCharTok{$}\NormalTok{demo\_verbatim }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(\{}
\NormalTok{  code }\OtherTok{\textless{}{-}}
    \StringTok{"ggplot(iris, aes(x = Species, y = \%s, color = Species)) +}
\StringTok{    geom\_violin(show.legend = FALSE) +}
\StringTok{    stat\_summary(show.legend = FALSE)"}
  
  \FunctionTok{sprintf}\NormalTok{(code, input}\SpecialCharTok{$}\NormalTok{y)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\hypertarget{plots}{%
\section{Plots}\label{plots}}

{plotOutput}() displays plots made with the base R plotting functions (e.g., {plot}(), {hist}()) or ggplot2 functions.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the UI function}
\FunctionTok{plotOutput}\NormalTok{(}\StringTok{"demo\_plot"}\NormalTok{, }\AttributeTok{width =} \StringTok{"500px"}\NormalTok{, }\AttributeTok{height=}\StringTok{"300px"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

What is the default value for {width}?\\
100\% 400px 400 5in 7in\\
What is the default value for {height}?\\
100\% 400px 400 5in 7in

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the server function}
\NormalTok{output}\SpecialCharTok{$}\NormalTok{demo\_plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
  \FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Species, }\AttributeTok{y =}\NormalTok{ .data[[input}\SpecialCharTok{$}\NormalTok{y]], }\AttributeTok{color =}\NormalTok{ Species)) }\SpecialCharTok{+}
    \FunctionTok{geom\_violin}\NormalTok{(}\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{stat\_summary}\NormalTok{(}\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{ylab}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{y)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

If you want to create dynamic plots that change with input, note how you need to use \texttt{y\ =\ .data{[}{[}input\$y{]}{]}} inside {aes}(), instead of just \texttt{y\ =\ input\$y}.

\hypertarget{images}{%
\section{Images}\label{images}}

{imageOutput}() takes the same arguments as {plotOutput}(). You can leave {width} and {height} as their defaults if you are going to set those values in the render function.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the UI function}
\FunctionTok{imageOutput}\NormalTok{(}\StringTok{"demo\_image"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

{renderImage}() needs to return a named list with at least an {src} with the image path. You can also set the {width} and {height} (numeric values are in pixels), {class} and {alt} (the alt-text for screen readers).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the server function}
\NormalTok{output}\SpecialCharTok{$}\NormalTok{demo\_image }\OtherTok{\textless{}{-}} \FunctionTok{renderImage}\NormalTok{(\{}
    \FunctionTok{list}\NormalTok{(}\AttributeTok{src =} \StringTok{"images/flower.jpg"}\NormalTok{,}
         \AttributeTok{width =} \DecValTok{100}\NormalTok{,}
         \AttributeTok{height =} \DecValTok{100}\NormalTok{,}
         \AttributeTok{alt =} \StringTok{"A flower"}\NormalTok{)}
\NormalTok{\}, }\AttributeTok{deleteFile =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The {deleteFile} argument is currently optional, but triggers periodic warnings that it won't be optional in the future. You should set it to {TRUE} if you're making a temporary file (this stops unneeded plots using memory) and {FALSE} if you're referencing a file you previously saved.

You can dynamically display images of any type, but one of the most useful ways to use image outputs is to control the aspect ratio and relative size of plots.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the UI function}
\FunctionTok{imageOutput}\NormalTok{(}\StringTok{"demo\_image"}\NormalTok{)}

\CommentTok{\# in the server function}
\NormalTok{output}\SpecialCharTok{$}\NormalTok{demo\_image }\OtherTok{\textless{}{-}} \FunctionTok{renderImage}\NormalTok{(\{}
  \CommentTok{\# make the plot}
\NormalTok{  g }\OtherTok{\textless{}{-}} \FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Species, }\AttributeTok{y =}\NormalTok{ .data[[input}\SpecialCharTok{$}\NormalTok{y]], }\AttributeTok{color =}\NormalTok{ Species)) }\SpecialCharTok{+}
    \FunctionTok{geom\_violin}\NormalTok{(}\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{stat\_summary}\NormalTok{(}\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{ylab}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{y)}
  
  \CommentTok{\# save to a temporary file}
\NormalTok{  plot\_file }\OtherTok{\textless{}{-}} \FunctionTok{tempfile}\NormalTok{(}\AttributeTok{fileext =} \StringTok{".png"}\NormalTok{)}

  \FunctionTok{ggsave}\NormalTok{(plot\_file, }\FunctionTok{demo\_plot}\NormalTok{(), }\AttributeTok{units =} \StringTok{"in"}\NormalTok{,}
         \AttributeTok{dpi =} \DecValTok{72}\NormalTok{, }\AttributeTok{width =} \DecValTok{7}\NormalTok{, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}
    
  \CommentTok{\# Return a list containing the filename}
  \FunctionTok{list}\NormalTok{(}\AttributeTok{src =}\NormalTok{ plot\_file,}
       \AttributeTok{width =} \StringTok{"100\%"}\NormalTok{,}
       \AttributeTok{height =} \StringTok{"auto"}\NormalTok{,}
       \AttributeTok{alt =} \StringTok{"The plot"}\NormalTok{)}
\NormalTok{\}, }\AttributeTok{deleteFile =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{tables}{%
\section{Tables}\label{tables}}

Display a table using {tableOutput}().

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the UI function}
\FunctionTok{tableOutput}\NormalTok{(}\StringTok{"demo\_table"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

This is paired with {renderTable}(), which makes a table out of any data frame it returns.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the server function}
\NormalTok{output}\SpecialCharTok{$}\NormalTok{demo\_table }\OtherTok{\textless{}{-}} \FunctionTok{renderTable}\NormalTok{(\{}
\NormalTok{  iris }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{group\_by}\NormalTok{(Species) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{summarise}\NormalTok{(}\AttributeTok{mean =} \FunctionTok{mean}\NormalTok{(.data[[input}\SpecialCharTok{$}\NormalTok{y]]),}
              \AttributeTok{sd =} \FunctionTok{sd}\NormalTok{(.data[[input}\SpecialCharTok{$}\NormalTok{y]]))}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

Note how you need to use \texttt{.data{[}{[}input\$y{]}{]}} inside {dplyr::summarise}(), instead of just \texttt{input\$y} to dynamically choose which variable to summarise.

\hypertarget{data-tables}{%
\subsection{Data Tables}\label{data-tables}}

If you have a long table to show, or one that you want users to be able to sort or search, use {DT::dataTableOutput}() (or its synonym {DTOutput}()).

The basic shiny package has {dataTableOutput}() and {renderDataTable}() functions, but they can be buggy. The versions in the DT package are better and have \href{https://rstudio.github.io/DT/}{many additional functions}, so I use those.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the UI function}
\NormalTok{DT}\SpecialCharTok{::}\FunctionTok{dataTableOutput}\NormalTok{(}\StringTok{"demo\_datatable"}\NormalTok{,}
                    \AttributeTok{width =} \StringTok{"50\%"}\NormalTok{,}
                    \AttributeTok{height =} \StringTok{"auto"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The paired render function is {renderDataTable}() (or its synonym {renderDT}()). You can customise data tables in many ways, but we'll stick with a basic example here that limits the number of rows shown at once to {10}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the server function}
\NormalTok{output}\SpecialCharTok{$}\NormalTok{demo\_datatable }\OtherTok{\textless{}{-}}\NormalTok{ DT}\SpecialCharTok{::}\FunctionTok{renderDataTable}\NormalTok{(\{}
\NormalTok{    iris}
\NormalTok{\}, }\AttributeTok{options =} \FunctionTok{list}\NormalTok{(}\AttributeTok{pageLength =} \DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

The DT package has synonyms for {dataTableOutput}() and {renderDataTable}(): and {renderDT}(). You can use these to make sure you're not accidentally using the shiny versions, which don't have as many options.

\hypertarget{dynamic-html}{%
\section{Dynamic HTML}\label{dynamic-html}}

If you want to dynamically create parts of the UI, you can use {uiOutput}().

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the UI function}
\FunctionTok{uiOutput}\NormalTok{(}\StringTok{"demo\_ui"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

You can create the UI using {renderUI}() to return HTML created using the input functions we learned about in Section~\ref{inputs}, the \protect\hyperlink{tags}{tag functions}, or HTML that you write yourself (as an argument to {HTML}()).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the server function}
\NormalTok{output}\SpecialCharTok{$}\NormalTok{demo\_ui }\OtherTok{\textless{}{-}} \FunctionTok{renderUI}\NormalTok{(\{}
\NormalTok{  cols }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(iris)[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{]}
  \FunctionTok{selectInput}\NormalTok{(}\StringTok{"y"}\NormalTok{, }\StringTok{"Column to plot"}\NormalTok{, cols, }\StringTok{"Sepal.Length"}\NormalTok{)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

The function {htmlOutput}() is a synonym for {uiOutput}(), so you might see that in some code examples, but I use {uiOutput}() to make the connection with {renderUI}() clearer, since there is no {renderHTML}().

\hypertarget{reosurces-outputs}{%
\section{Further Resources}\label{reosurces-outputs}}

\begin{itemize}
\tightlist
\item
  \href{https://mastering-shiny.org/basic-ui.html\#outputs}{Mastering Shiny Section 2.3}
\item
  \href{https://vimeo.com/rstudioinc/review/131218530/212d8a5a7a/\#t=10m41s}{RStudio Shiny Tutorials}
\item
  \href{https://rstudio.github.io/DT/}{DT (data tables)}
\end{itemize}

\hypertarget{exercises-outputs}{%
\section{Exercises}\label{exercises-outputs}}

\hypertarget{modify-the-demo}{%
\subsection{Modify the demo}\label{modify-the-demo}}

Clone the ``output\_demo'' app and modify it to use a different dataset.

\hypertarget{pets-1}{%
\subsection{Pets}\label{pets-1}}

Add outputs and appropriate render functions to show a plot and the data from the pets questionnaire you made for the exercise in Section~\ref{inputs}.

\hypertarget{your-app-outputs}{%
\section{Your App}\label{your-app-outputs}}

In the app you're developing, add relevant outputs, such as for plots or tables, and the appropriate render function for each output. You can leave the contents blank for now or add in some code to create output.

\hypertarget{reactives}{%
\chapter{Reactive functions}\label{reactives}}

There are a lot of great tutorials that explain the principles behind reactive functions, but that never made any sense to me when I first started out, so I'm just going to give you examples that you can extrapolate principles from.

Reactivity is how Shiny determines which code in {server}() gets to run when. Some types of objects, such as the \texttt{input} object or objects made by {reactiveValues}(), can trigger some types of functions to run whenever they change.

For our example, we will use the \texttt{reactive\_demo} app. It shows three select inputs that allow the user to choose values from the cut, color, and clarity columns of the \texttt{diamonds} dataset from ggplot2, then draws a plot of the relationship between carat and price for the selected subset.

Here is the relevant code for the UI. There are four inputs: cut, color, clarity, and update. There are two outputs: title and plot.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{box}\NormalTok{(}
  \AttributeTok{title =} \StringTok{"Diamonds"}\NormalTok{,}
  \AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{,}
  \FunctionTok{selectInput}\NormalTok{(}\StringTok{"cut"}\NormalTok{, }\StringTok{"Cut"}\NormalTok{, }\FunctionTok{levels}\NormalTok{(diamonds}\SpecialCharTok{$}\NormalTok{cut)),}
  \FunctionTok{selectInput}\NormalTok{(}\StringTok{"color"}\NormalTok{, }\StringTok{"Color"}\NormalTok{, }\FunctionTok{levels}\NormalTok{(diamonds}\SpecialCharTok{$}\NormalTok{color)),}
  \FunctionTok{selectInput}\NormalTok{(}\StringTok{"clarity"}\NormalTok{, }\StringTok{"Clarity"}\NormalTok{, }\FunctionTok{levels}\NormalTok{(diamonds}\SpecialCharTok{$}\NormalTok{clarity)),}
  \FunctionTok{actionButton}\NormalTok{(}\StringTok{"update"}\NormalTok{, }\StringTok{"Update Plot"}\NormalTok{)}
\NormalTok{),}
\FunctionTok{box}\NormalTok{(}
  \AttributeTok{title =} \StringTok{"Plot"}\NormalTok{,}
  \AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{,}
  \FunctionTok{textOutput}\NormalTok{(}\StringTok{"title"}\NormalTok{),}
  \FunctionTok{plotOutput}\NormalTok{(}\StringTok{"plot"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Whenever an input changes, it will trigger some types of functions to run.

\hypertarget{observeevent-1}{%
\section{observeEvent()}\label{observeevent-1}}

We learned about {observeEvent}() in Section~\ref{first-reactive}. This function runs the code whenever the value of the first argument changes. If there are reactives inside the function, they won't trigger the code to run when they change.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
  \FunctionTok{observeEvent}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{update, \{}
\NormalTok{    data }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(diamonds,}
\NormalTok{                   cut }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{cut,}
\NormalTok{                   color }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{color,}
\NormalTok{                   clarity }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{clarity)}
    
\NormalTok{    title }\OtherTok{\textless{}{-}} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"Cut: \%s, Color: \%s, Clarity: \%s"}\NormalTok{,}
\NormalTok{                     input}\SpecialCharTok{$}\NormalTok{cut,}
\NormalTok{                     input}\SpecialCharTok{$}\NormalTok{color,}
\NormalTok{                     input}\SpecialCharTok{$}\NormalTok{clarity)}
    
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
      \FunctionTok{ggplot}\NormalTok{(data, }\FunctionTok{aes}\NormalTok{(carat, price)) }\SpecialCharTok{+}
        \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{color =} \StringTok{"\#605CA8"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
        \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =}\NormalTok{ lm, }\AttributeTok{color =} \StringTok{"\#605CA8"}\NormalTok{)}
\NormalTok{    \})}
    
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{title }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(title)}
\NormalTok{  \})}
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

In the example above, which inputs will trigger {renderPlot}() to run and produce a new plot?

cut color clarity update cut, color \& clarity all of the above

In the example above, which inputs will trigger {renderText}() to run and produce a new title?

cut color clarity update cut, color \& clarity all of the above

\hypertarget{render-functions}{%
\section{Render functions}\label{render-functions}}

Functions that render an output, like {renderText}() or {renderPlot}() will run whenever an input in their code changes. You can trigger a render function just by putting a reactive alone on a line, even if you aren't using it in the rest of the code.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
\NormalTok{    data }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(diamonds,}
\NormalTok{                   cut }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{cut,}
\NormalTok{                   color }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{color,}
\NormalTok{                   clarity }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{clarity)}
    
    \FunctionTok{ggplot}\NormalTok{(data, }\FunctionTok{aes}\NormalTok{(carat, price)) }\SpecialCharTok{+}
      \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{color =} \StringTok{"\#605CA8"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =}\NormalTok{ lm, }\AttributeTok{color =} \StringTok{"\#605CA8"}\NormalTok{)}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{title }\OtherTok{\textless{}{-}}\NormalTok{ renderText\{}
\NormalTok{    input}\SpecialCharTok{$}\NormalTok{update }\CommentTok{\# just here to trigger the function}
    
    \FunctionTok{sprintf}\NormalTok{(}\StringTok{"Cut: \%s, Color: \%s, Clarity: \%s"}\NormalTok{,}
\NormalTok{                     input}\SpecialCharTok{$}\NormalTok{cut,}
\NormalTok{                     input}\SpecialCharTok{$}\NormalTok{color,}
\NormalTok{                     input}\SpecialCharTok{$}\NormalTok{clarity)}
\NormalTok{  \}}\ErrorTok{)}
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

In the example above, which inputs will trigger {renderPlot}() to run and produce a new plot?\\
cut color clarity update cut, color \& clarity all of the above

Which inputs will trigger {renderText}() to run and produce a new title?\\
cut color clarity update cut, color \& clarity all of the above

\hypertarget{reactive-1}{%
\section{reactive()}\label{reactive-1}}

If you move the \texttt{data} filtering outside of {renderPlot}(), you'll get an error message like ``Can't access reactive value `cut' outside of reactive consumer.'' This means that the \texttt{input} values can only be read inside certain functions, like {reactive}(), {observeEvent}(), or a render function.

However, we can put the data filtering inside {reactive}(). This means that whenever an input inside that function changes, the code will run and update the value of {data}(). This can be useful if you need to recalculate the data table each time the inputs change, and then use it in more than one function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
\NormalTok{  data }\OtherTok{\textless{}{-}} \FunctionTok{reactive}\NormalTok{(\{}
    \FunctionTok{filter}\NormalTok{(diamonds,}
\NormalTok{           cut }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{cut,}
\NormalTok{           color }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{color,}
\NormalTok{           clarity }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{clarity)}
\NormalTok{  \})}
  
\NormalTok{  title }\OtherTok{\textless{}{-}} \FunctionTok{reactive}\NormalTok{(\{}
    \FunctionTok{sprintf}\NormalTok{(}\StringTok{"Cut: \%s, Color: \%s, Clarity: \%s, N: \%d"}\NormalTok{,}
\NormalTok{                     input}\SpecialCharTok{$}\NormalTok{cut,}
\NormalTok{                     input}\SpecialCharTok{$}\NormalTok{color,}
\NormalTok{                     input}\SpecialCharTok{$}\NormalTok{clarity,}
            \FunctionTok{nrow}\NormalTok{(}\FunctionTok{data}\NormalTok{()))}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
    \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{data}\NormalTok{(), }\FunctionTok{aes}\NormalTok{(carat, price)) }\SpecialCharTok{+}
      \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{color =} \StringTok{"\#605CA8"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =}\NormalTok{ lm, }\AttributeTok{color =} \StringTok{"\#605CA8"}\NormalTok{)}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{text }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(}\FunctionTok{title}\NormalTok{())}
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

In the example above, which inputs will trigger {renderPlot}() to run and produce a new plot?\\
cut color clarity update cut, color \& clarity all of the above

Which inputs will trigger {renderText}() to run and produce a new title?\\
cut color clarity update cut, color \& clarity all of the above

My most common error is trying to use \texttt{data} or \texttt{title} as an object instead of as a function. Notice how the first argument to ggplot is no longer \texttt{data}, but {data}() and you set the value of data with \texttt{data(newdata)}, not \texttt{data\ \textless{}-\ newdata}. For now, just remember this as a quirk of shiny.

\hypertarget{eventreactive}{%
\section{eventReactive()}\label{eventreactive}}

While {reactive}() is triggered whenever any input values inside it change, {eventReactive}() is only triggered when the value of the first argument changes, like {observeEvent}(), but returns a reactive function like {reactive}().

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
\NormalTok{  data }\OtherTok{\textless{}{-}} \FunctionTok{eventReactive}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{update, \{}
    \FunctionTok{filter}\NormalTok{(diamonds,}
\NormalTok{           cut }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{cut,}
\NormalTok{           color }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{color,}
\NormalTok{           clarity }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{clarity)}
\NormalTok{  \})}
  
\NormalTok{  title }\OtherTok{\textless{}{-}} \FunctionTok{eventReactive}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{update, \{}
    \FunctionTok{sprintf}\NormalTok{(}\StringTok{"Cut: \%s, Color: \%s, Clarity: \%s"}\NormalTok{,}
\NormalTok{                     input}\SpecialCharTok{$}\NormalTok{cut,}
\NormalTok{                     input}\SpecialCharTok{$}\NormalTok{color,}
\NormalTok{                     input}\SpecialCharTok{$}\NormalTok{clarity)}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
    \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{data}\NormalTok{(), }\FunctionTok{aes}\NormalTok{(carat, price)) }\SpecialCharTok{+}
      \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{color =} \StringTok{"\#605CA8"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =}\NormalTok{ lm, }\AttributeTok{color =} \StringTok{"\#605CA8"}\NormalTok{)}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{text }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(}\FunctionTok{title}\NormalTok{())}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

In the example above, which inputs will trigger {renderPlot}() to run and produce a new plot?

cut color clarity update cut, color \& clarity all of the above

Which inputs will trigger {renderText}() to run and produce a new title?

cut color clarity update cut, color \& clarity all of the above

\hypertarget{reactiveval}{%
\section{reactiveVal()}\label{reactiveval}}

Another pattern that accomplishes a similar thing to {reactive}() is to create a reactive value using {reactiveVal}(). This allows you to update the value of {data}() not just using the code inside the {reactive}() function that created it, but in any function. This is useful when you have multiple functions that need to update that value.

Here, we use {observeEvent}() to trigger the data filtering code only when the update button is pressed. This new data set is assigned to {data}() using the code \texttt{data(newdata)}.

Because {data}() returns a reactive value, it will trigger {renderPlot}() whenever it changes.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
\NormalTok{    data }\OtherTok{\textless{}{-}} \FunctionTok{reactiveVal}\NormalTok{(diamonds)}
    
    \FunctionTok{observeEvent}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{update, \{}
\NormalTok{        newdata }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(diamonds,}
\NormalTok{               cut }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{cut,}
\NormalTok{               color }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{color,}
\NormalTok{               clarity }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{clarity)}
        
        \FunctionTok{data}\NormalTok{(newdata) }\CommentTok{\# updates data()}
\NormalTok{    \})}
    
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
        \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{data}\NormalTok{(), }\FunctionTok{aes}\NormalTok{(carat, price)) }\SpecialCharTok{+}
            \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{color =} \StringTok{"\#605CA8"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
            \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =}\NormalTok{ lm, }\AttributeTok{color =} \StringTok{"\#605CA8"}\NormalTok{)}
\NormalTok{    \})}
    
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{title }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(\{}
      \FunctionTok{sprintf}\NormalTok{(}\StringTok{"Cut: \%s, Color: \%s, Clarity: \%s"}\NormalTok{,}
\NormalTok{                     input}\SpecialCharTok{$}\NormalTok{cut,}
\NormalTok{                     input}\SpecialCharTok{$}\NormalTok{color,}
\NormalTok{                     input}\SpecialCharTok{$}\NormalTok{clarity)}
\NormalTok{    \})}
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

In the example above, which inputs will trigger {renderPlot}() to run and produce a new plot?\\
cut color clarity update cut, color \& clarity all of the above

Which inputs will trigger {renderText}() to run and produce a new title?\\
cut color clarity update cut, color \& clarity all of the above

We used \texttt{data\ \textless{}-\ reactiveVal(diamonds)} in order for {data}() to have a value that didn't cause an error when {renderPlot}() runs for the first time.

\hypertarget{reactivevalue}{%
\section{reactiveValue()}\label{reactivevalue}}

You need to set up a new {reactiveVal}() for each value in an app that you want to make reactive. I prefer to use {reactiveValues}() because it can be used for any new reactive value you need and works just like \texttt{input}.

You can just set your new object to {reactiveValues}() or you can initialise it with starting values like below. The object \texttt{v} is a named list, just like \texttt{input}, and when it's values change, it triggers reactive functions exactly like \texttt{input} does.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
\NormalTok{    v }\OtherTok{\textless{}{-}} \FunctionTok{reactiveValues}\NormalTok{(}
        \AttributeTok{data =}\NormalTok{ diamonds,}
        \AttributeTok{title =} \StringTok{"All Data"}
\NormalTok{    )}
    
    \FunctionTok{observeEvent}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{update, \{}
\NormalTok{        v}\SpecialCharTok{$}\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(diamonds,}
\NormalTok{                       cut }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{cut,}
\NormalTok{                       color }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{color,}
\NormalTok{                       clarity }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{clarity)}
        
\NormalTok{        v}\SpecialCharTok{$}\NormalTok{title }\OtherTok{\textless{}{-}} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"Cut: \%s, Color: \%s, Clarity: \%s"}\NormalTok{,}
\NormalTok{                         input}\SpecialCharTok{$}\NormalTok{cut,}
\NormalTok{                         input}\SpecialCharTok{$}\NormalTok{color,}
\NormalTok{                         input}\SpecialCharTok{$}\NormalTok{clarity)}
\NormalTok{    \})}
    
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
        \FunctionTok{ggplot}\NormalTok{(v}\SpecialCharTok{$}\NormalTok{data, }\FunctionTok{aes}\NormalTok{(carat, price)) }\SpecialCharTok{+}
            \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{color =} \StringTok{"\#605CA8"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
            \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =}\NormalTok{ lm, }\AttributeTok{color =} \StringTok{"\#605CA8"}\NormalTok{)}
\NormalTok{    \})}
    
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{title }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(v}\SpecialCharTok{$}\NormalTok{title)}
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

In the example above, which inputs will trigger {renderPlot}() to run and produce a new plot?\\
cut color clarity update cut, color \& clarity all of the above

Which inputs will trigger {renderText}() to run and produce a new title?\\
cut color clarity update cut, color \& clarity all of the above

Note that you refer to reactive values set up this way as \texttt{v\$data} and \texttt{v\$title}, not {data}() and {title}().

\hypertarget{isolate}{%
\section{isolate()}\label{isolate}}

If you want to use an input or reactive value inside a reactive function, but don't want to trigger that function, you can {isolate}() it. You can also use {isolate}() to get a reactive value outside a reactive function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
\NormalTok{  data }\OtherTok{\textless{}{-}} \FunctionTok{reactive}\NormalTok{(\{}
    \FunctionTok{filter}\NormalTok{(}
\NormalTok{      diamonds,}
\NormalTok{      cut }\SpecialCharTok{==} \FunctionTok{isolate}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{cut),}
\NormalTok{      color }\SpecialCharTok{==} \FunctionTok{isolate}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{color),}
\NormalTok{      clarity }\SpecialCharTok{==}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{clarity}
\NormalTok{    )}
\NormalTok{  \})}
  
\NormalTok{  title }\OtherTok{\textless{}{-}} \FunctionTok{reactive}\NormalTok{(\{}
    \FunctionTok{sprintf}\NormalTok{(}
      \StringTok{"Cut: \%s, Color: \%s, Clarity: \%s"}\NormalTok{,}
\NormalTok{      input}\SpecialCharTok{$}\NormalTok{cut,}
      \FunctionTok{isolate}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{color),}
      \FunctionTok{isolate}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{clarity)}
\NormalTok{    )}
\NormalTok{  \})}
  
  \CommentTok{\# what is the title at initialisation?}
  \FunctionTok{debug\_msg}\NormalTok{(}\FunctionTok{isolate}\NormalTok{(}\FunctionTok{title}\NormalTok{()))}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
    \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{data}\NormalTok{(), }\FunctionTok{aes}\NormalTok{(carat, price)) }\SpecialCharTok{+}
      \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{color =} \StringTok{"\#605CA8"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =}\NormalTok{ lm, }\AttributeTok{color =} \StringTok{"\#605CA8"}\NormalTok{)}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{title }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(}\FunctionTok{title}\NormalTok{())}
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

In the example above, which inputs will trigger {renderPlot}() to run and produce a new plot?\\
cut color clarity update cut, color \& clarity all of the above

Which inputs will trigger {renderText}() to run and produce a new title?\\
cut color clarity update cut, color \& clarity all of the above

\hypertarget{further-resources-resources-reactive}{%
\section{Further Resources \{\#resources-reactive)}\label{further-resources-resources-reactive}}

\begin{itemize}
\tightlist
\item
  \href{https://mastering-shiny.org/basic-reactivity.html}{Mastering Shiny - Basic Reactivity}
\item
  \href{https://shiny.rstudio.com/articles/reactivity-overview.html}{Reactivity - An overview}
\item
  \href{https://shiny.rstudio.com/tutorial/written-tutorial/lesson6/}{Use reactive expressions}
\item
  \href{https://mastering-shiny.org/reactivity-intro.html}{Mastering Shiny - Mastering Reactivity}
\end{itemize}

\hypertarget{exercises-reactive}{%
\section{Exercises}\label{exercises-reactive}}

For the following exercises, clone ``reactive\_demo'' and replace the boxes in the ui with the code below. Delete all the code in {server}(). Make sure this runs before you go ahead.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{box}\NormalTok{(}\AttributeTok{width =} \DecValTok{4}\NormalTok{,}
    \FunctionTok{selectInput}\NormalTok{(}\StringTok{"stat"}\NormalTok{, }\StringTok{"Statistic"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"mean"}\NormalTok{, }\StringTok{"sd"}\NormalTok{)),}
    \FunctionTok{selectInput}\NormalTok{(}\StringTok{"group"}\NormalTok{, }\StringTok{"Group By"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"vore"}\NormalTok{, }\StringTok{"order"}\NormalTok{, }\StringTok{"conservation"}\NormalTok{)),}
    \FunctionTok{actionButton}\NormalTok{(}\StringTok{"update"}\NormalTok{, }\StringTok{"Update Table"}\NormalTok{)),}
\FunctionTok{box}\NormalTok{(}\AttributeTok{width =} \DecValTok{8}\NormalTok{,}
    \AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{,}
    \AttributeTok{title =} \FunctionTok{textOutput}\NormalTok{(}\StringTok{"caption"}\NormalTok{),}
    \FunctionTok{tableOutput}\NormalTok{(}\StringTok{"table"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

You will grouping and summarising the \texttt{msleep} data table from ggplot2 by calculating the mean or standard deviation for all (or some) of the numeric columns grouped by the categorical columns \texttt{vore}, \texttt{order}, or \texttt{conservation}. If you're not sure how to create such a summary table with dplyr, look at the following code for a concrete example.

Hint

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{msleep }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(vore) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise\_if}\NormalTok{(is.numeric, }\StringTok{"mean"}\NormalTok{, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 7
##   vore    sleep_total sleep_rem sleep_cycle awake brainwt  bodywt
##   <chr>         <dbl>     <dbl>       <dbl> <dbl>   <dbl>   <dbl>
## 1 carni         10.4       2.29       0.373 13.6  0.0793   90.8  
## 2 herbi          9.51      1.37       0.418 14.5  0.622   367.   
## 3 insecti       14.9       3.52       0.161  9.06 0.0216   12.9  
## 4 omni          10.9       1.96       0.592 13.1  0.146    12.7  
## 5 <NA>          10.2       1.88       0.183 13.8  0.00763   0.858
\end{verbatim}

\hypertarget{observeevent-2}{%
\subsection{observeEvent}\label{observeevent-2}}

Use {observeEvent}() to update the output table with the appropriate summary table and to update the caption with an appropriate caption only when the update button is clicked.

Solution

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
  \FunctionTok{observeEvent}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{update, \{}
\NormalTok{    data }\OtherTok{\textless{}{-}}\NormalTok{ msleep }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{group\_by}\NormalTok{(.data[[input}\SpecialCharTok{$}\NormalTok{group]]) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{summarise\_if}\NormalTok{(is.numeric, input}\SpecialCharTok{$}\NormalTok{stat, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{table }\OtherTok{\textless{}{-}} \FunctionTok{renderTable}\NormalTok{(data)}
    
\NormalTok{    caption }\OtherTok{\textless{}{-}}
      \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%ss by \%s"}\NormalTok{, }\FunctionTok{toupper}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{stat), input}\SpecialCharTok{$}\NormalTok{group)}
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{caption }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(caption)}
\NormalTok{  \})}
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

\hypertarget{render}{%
\subsection{render}\label{render}}

Use render functions to update the output table and caption whenever group or stat change.

Solution

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{table }\OtherTok{\textless{}{-}} \FunctionTok{renderTable}\NormalTok{(\{}
\NormalTok{    msleep }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{group\_by}\NormalTok{(.data[[input}\SpecialCharTok{$}\NormalTok{group]]) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{summarise\_if}\NormalTok{(is.numeric, input}\SpecialCharTok{$}\NormalTok{stat, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{caption }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(\{}
    \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%ss by \%s"}\NormalTok{, }\FunctionTok{toupper}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{stat), input}\SpecialCharTok{$}\NormalTok{group)}
\NormalTok{  \})}
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

\hypertarget{reactive-2}{%
\subsection{reactive}\label{reactive-2}}

Use {reactive}() to update the output table and caption whenever group or stat change. Ignore the update button.

Solution

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
\NormalTok{  data }\OtherTok{\textless{}{-}} \FunctionTok{reactive}\NormalTok{(\{}
\NormalTok{    msleep }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{group\_by}\NormalTok{(.data[[input}\SpecialCharTok{$}\NormalTok{group]]) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{summarise\_if}\NormalTok{(is.numeric, input}\SpecialCharTok{$}\NormalTok{stat, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  \})}
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{table }\OtherTok{\textless{}{-}} \FunctionTok{renderTable}\NormalTok{(}\FunctionTok{data}\NormalTok{())}
  
\NormalTok{  caption }\OtherTok{\textless{}{-}} \FunctionTok{reactive}\NormalTok{(\{}
    \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%ss by \%s"}\NormalTok{, }\FunctionTok{toupper}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{stat), input}\SpecialCharTok{$}\NormalTok{group)}
\NormalTok{  \})}
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{caption }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(}\FunctionTok{caption}\NormalTok{())}
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

\hypertarget{eventreactive-1}{%
\subsection{eventReactive}\label{eventreactive-1}}

Use {eventReactive}() to update the output table and caption only when the update button is clicked.

Solution

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
\NormalTok{  data }\OtherTok{\textless{}{-}} \FunctionTok{eventReactive}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{update, \{}
\NormalTok{    msleep }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{group\_by}\NormalTok{(.data[[input}\SpecialCharTok{$}\NormalTok{group]]) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{summarise\_if}\NormalTok{(is.numeric, input}\SpecialCharTok{$}\NormalTok{stat, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  \})}
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{table }\OtherTok{\textless{}{-}} \FunctionTok{renderTable}\NormalTok{(}\FunctionTok{data}\NormalTok{())}
  
\NormalTok{  caption }\OtherTok{\textless{}{-}} \FunctionTok{eventReactive}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{update, \{}
    \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%ss by \%s"}\NormalTok{, }\FunctionTok{toupper}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{stat), input}\SpecialCharTok{$}\NormalTok{group)}
\NormalTok{  \})}
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{caption }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(}\FunctionTok{caption}\NormalTok{())}
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

\hypertarget{reactiveval-1}{%
\subsection{reactiveVal}\label{reactiveval-1}}

Use {reactiveVal}() to update the output table and caption only when the update button is clicked.

Solution

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
\NormalTok{  data }\OtherTok{\textless{}{-}} \FunctionTok{reactiveVal}\NormalTok{()}
\NormalTok{  caption }\OtherTok{\textless{}{-}} \FunctionTok{reactiveVal}\NormalTok{()}
  
  \FunctionTok{observeEvent}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{update, \{}
\NormalTok{    newdata }\OtherTok{\textless{}{-}}\NormalTok{ msleep }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{group\_by}\NormalTok{(.data[[input}\SpecialCharTok{$}\NormalTok{group]]) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{summarise\_if}\NormalTok{(is.numeric, input}\SpecialCharTok{$}\NormalTok{stat, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
    \FunctionTok{data}\NormalTok{(newdata)}
    
    \CommentTok{\# this is an alternative way to set reactiveVal}
    \CommentTok{\# by piping the value into the function}
    \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%ss by \%s"}\NormalTok{, }\FunctionTok{toupper}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{stat), input}\SpecialCharTok{$}\NormalTok{group) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{caption}\NormalTok{()}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{table }\OtherTok{\textless{}{-}} \FunctionTok{renderTable}\NormalTok{(}\FunctionTok{data}\NormalTok{())}
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{caption }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(}\FunctionTok{caption}\NormalTok{())}
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

\hypertarget{reactivevalues}{%
\subsection{reactiveValues}\label{reactivevalues}}

Use {reactiveValues}() to update the output table and caption only when the update button is clicked.

Solution

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
\NormalTok{  v }\OtherTok{\textless{}{-}} \FunctionTok{reactiveValues}\NormalTok{()}
  
  \FunctionTok{observeEvent}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{update, \{}
\NormalTok{    v}\SpecialCharTok{$}\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ msleep }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{group\_by}\NormalTok{(.data[[input}\SpecialCharTok{$}\NormalTok{group]]) }\SpecialCharTok{\%\textgreater{}\%}
      \FunctionTok{summarise\_if}\NormalTok{(is.numeric, input}\SpecialCharTok{$}\NormalTok{stat, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
    
\NormalTok{    v}\SpecialCharTok{$}\NormalTok{caption }\OtherTok{\textless{}{-}}
      \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%ss by \%s"}\NormalTok{, }\FunctionTok{toupper}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{stat), input}\SpecialCharTok{$}\NormalTok{group)}
\NormalTok{  \})}
  
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{table }\OtherTok{\textless{}{-}} \FunctionTok{renderTable}\NormalTok{(v}\SpecialCharTok{$}\NormalTok{data)}
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{caption }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(v}\SpecialCharTok{$}\NormalTok{caption)}
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

\hypertarget{your-app-reactive}{%
\section{Your App}\label{your-app-reactive}}

Add reactive functions to your custom app. Think about which patterns are best for your app. For example, if you need to update a data table when inputs change, and then use it in more than one output, it's best to use {reactive}() to create a function for the data and callit in the render functions for each output, rather than creating the data table in each render function.

\hypertarget{data}{%
\chapter{Reading and saving data}\label{data}}

\hypertarget{local-data}{%
\section{Local Data}\label{local-data}}

You can read and write data from a Shiny app the same way you do from any R script. We will focus on reading data, since writing data locally can cause problems and is better done with \protect\hyperlink{google_sheets}{Google Sheets}.

The working directory for a Shiny app is the directory that app.R is in. I recommend keeping your data in a directory called data to keep things tidy.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# read local data}
\NormalTok{my\_data }\OtherTok{\textless{}{-}}\NormalTok{ readxl}\SpecialCharTok{::}\FunctionTok{read\_xls}\NormalTok{(}\StringTok{"data/my\_data.xls"}\NormalTok{)}

\CommentTok{\# read data on the web}
\NormalTok{countries }\OtherTok{\textless{}{-}}\NormalTok{ readr}\SpecialCharTok{::}\FunctionTok{read\_csv}\NormalTok{(}\StringTok{"https://datahub.io/core/country{-}list/r/data.csv"}\NormalTok{)}
\NormalTok{languages }\OtherTok{\textless{}{-}}\NormalTok{ jsonlite}\SpecialCharTok{::}\FunctionTok{read\_json}\NormalTok{(}\StringTok{"https://datahub.io/core/language{-}codes/r/language{-}codes.json"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{google_sheets}{%
\section{Google Sheets}\label{google_sheets}}

One of the best ways to start collecting data with a Shiny app is with Google Sheets. This allows you to collect data to the same place from multiple servers, which might happen if you're running the app locally on more than one computer or through a service like \href{https://shinyapps.io}{shinyapps.io}. The R package googlesheets4 makes it easy to work with Google Sheets from R.

If you just want to read data from a public Google Sheet, you don't need any authorisation. Just start your code with {gs4\_deauth}() after you load googlesheets4 (otherwise you'll be prompted to log in). Then you can read data like this:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(googlesheets4)}
\FunctionTok{gs4\_deauth}\NormalTok{()}
\NormalTok{sheet\_id }\OtherTok{\textless{}{-}} \StringTok{"https://docs.google.com/spreadsheets/d/1tQCYQrI4xITlPyxb9dQ{-}JpMDYeADovIeiZZRNHkctGA/"}
\FunctionTok{read\_sheet}\NormalTok{(sheet\_id)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 2
##   number letter
##    <dbl> <chr> 
## 1      1 A     
## 2      2 B     
## 3      3 C
\end{verbatim}

However, even if a Google Sheet is publicly editable, you can't add data to it without authorising your account. If you try, you'll get the error below.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{number =} \DecValTok{4}\NormalTok{, }\AttributeTok{letter =} \StringTok{"D"}\NormalTok{)}
\FunctionTok{sheet\_append}\NormalTok{(sheet\_id, data)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error: Client error: (401) UNAUTHENTICATED
## * Request not authenticated due to missing, invalid, or expired
##   OAuth token.
## * Request is missing required authentication credential.
##   Expected OAuth 2 access token, login cookie or other valid
##   authentication credential. See
##   https://developers.google.com/identity/sign-in/web/devconsole-project.
\end{verbatim}

You can authorise interactively using the following code (and your own email), which will prompt you to authorise ``Tidyverse API Packages'' the first time you do this.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{gs4\_auth}\NormalTok{(}\AttributeTok{email =} \StringTok{"debruine@gmail.com"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

However, this won't work if you want your Shiny apps to be able to access your Google Sheets.

\hypertarget{authorisation-for-apps}{%
\subsection{Authorisation for Apps}\label{authorisation-for-apps}}

First, you need to get a token and store it in a cache folder in your app directory. We're going to call that directory .secrets. Run the following code in your console (NOT in an Rmd file). This will open up a web browser window and prompt you to choose your Google account and authorise ``Tidyverse API Packages''.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{setwd}\NormalTok{(app\_directory)}
\FunctionTok{gs4\_auth}\NormalTok{(}\AttributeTok{email =} \StringTok{"debruine@gmail.com"}\NormalTok{, }\AttributeTok{cache =} \StringTok{".secrets"}\NormalTok{)}

\CommentTok{\# optionally, authorise google drive to search your drive}
\CommentTok{\# googledrive::drive\_auth(email = "debruine@gmail.com", cache = ".secrets")}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics[width=0.3\linewidth]{images/gs4_choose_account} \includegraphics[width=0.3\linewidth]{images/gs4_auth} \includegraphics[width=0.3\linewidth]{images/gs4_confirm_auth} 

}

\caption{Prompts to choose an account, grant permissions, and confirm.}\label{fig:gs4-auth}
\end{figure}

When you have finished, you will see a page that says something like, ``Authentication complete. Please close this page and return to R.'' In the file pane in RStudio, you should now see a directory called .secrets in the app directory.

If you are using GitHub, you don't want to save your secret info to a public repository, so run the following code to ignore any directories called .secrets (so they will only exist on your computer and not on GitHub).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{usethis}\SpecialCharTok{::}\FunctionTok{use\_git\_ignore}\NormalTok{(}\StringTok{".secrets"}\NormalTok{)}
\NormalTok{usethis}\SpecialCharTok{::}\FunctionTok{use\_git\_ignore}\NormalTok{(}\StringTok{"*/.secrets"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Now, you can include the following code at the top of your app.R script to authorise the app to read from and write to your files.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{gs4\_auth}\NormalTok{(}\AttributeTok{cache =} \StringTok{".secrets"}\NormalTok{, }\AttributeTok{email =} \StringTok{"debruine@gmail.com"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{accessing-an-existing-sheet}{%
\subsection{Accessing an existing sheet}\label{accessing-an-existing-sheet}}

If you have an existing \href{https://docs.google.com/spreadsheets/u/0/}{Google Sheet}, you can access it by URL.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sheet\_id }\OtherTok{\textless{}{-}} \StringTok{"https://docs.google.com/spreadsheets/d/1tQCYQrI4xITlPyxb9dQ{-}JpMDYeADovIeiZZRNHkctGA/"}
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{number =} \DecValTok{4}\NormalTok{, }\AttributeTok{letter =} \StringTok{"D"}\NormalTok{)}
\FunctionTok{sheet\_append}\NormalTok{(sheet\_id, data)}
\FunctionTok{read\_sheet}\NormalTok{(sheet\_id)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 2
##   number letter
##    <dbl> <chr> 
## 1      1 A     
## 2      2 B     
## 3      3 C     
## 4      4 D
\end{verbatim}

\hypertarget{make-a-new-sheet}{%
\subsection{Make a new sheet}\label{make-a-new-sheet}}

You can set up a new Google Sheet with code. You only need to do this once for a sheet that you will use with a Shiny app, and you will need to save the sheet ID. If you don't specify the tab name(s), the sheet will be created with one tab called ``Sheet1''. I recommend making only one sheet per app and saving each table in a separate tab.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{id }\OtherTok{\textless{}{-}} \FunctionTok{gs4\_create}\NormalTok{(}\StringTok{"demo2"}\NormalTok{, }\AttributeTok{sheets =} \FunctionTok{c}\NormalTok{(}\StringTok{"demographics"}\NormalTok{, }\StringTok{"questionnaire"}\NormalTok{))}
\NormalTok{id}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Spreadsheet name: demo2
##               ID: 121Yg7HQgNSdv5ofCFYAwrrSsQzmfWdJWzh2uYdn2kA8
##           Locale: en_US
##        Time zone: Europe/London
##      # of sheets: 2
## 
##  (Sheet name): (Nominal extent in rows x columns)
##  demographics: 1000 x 26
## questionnaire: 1000 x 26
\end{verbatim}

Include the ID at the top of your app like this:

\hypertarget{add-data}{%
\subsection{Add data}\label{add-data}}

You can add an empty data structure to your sheet by specifying the data types of each column like this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{name =} \FunctionTok{character}\NormalTok{(}\DecValTok{0}\NormalTok{),}
  \AttributeTok{birthyear =} \FunctionTok{integer}\NormalTok{(}\DecValTok{0}\NormalTok{),}
  \AttributeTok{parent =} \FunctionTok{logical}\NormalTok{(}\DecValTok{0}\NormalTok{),}
  \AttributeTok{score =} \FunctionTok{double}\NormalTok{(}\DecValTok{0}\NormalTok{)}
\NormalTok{)}

\FunctionTok{write\_sheet}\NormalTok{(data, SHEET\_ID, }\StringTok{"demographics"}\NormalTok{)}
\FunctionTok{read\_sheet}\NormalTok{(SHEET\_ID, }\StringTok{"demographics"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{names}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "name"      "birthyear" "parent"    "score"
\end{verbatim}

Or you can populate the table with starting data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{name =} \StringTok{"Lisa"}\NormalTok{,}
  \AttributeTok{birthyear =}\NormalTok{ 1976L,}
  \AttributeTok{R\_user =} \ConstantTok{TRUE}\NormalTok{,}
  \AttributeTok{score =} \FloatTok{10.2}
\NormalTok{)}

\FunctionTok{write\_sheet}\NormalTok{(data, SHEET\_ID, }\StringTok{"demographics"}\NormalTok{)}
\FunctionTok{read\_sheet}\NormalTok{(SHEET\_ID, }\StringTok{"demographics"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 4
##   name  birthyear R_user score
##   <chr>     <dbl> <lgl>  <dbl>
## 1 Lisa       1976 TRUE    10.2
\end{verbatim}

Notice that \texttt{birthyear} is a double, not an integer. Google Sheets only have one numeric type, so both doubles and integers are coerced to doubles.

\hypertarget{appending-data}{%
\subsection{Appending data}\label{appending-data}}

Then you can append new rows of data to the sheet.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{name =} \StringTok{"Robbie"}\NormalTok{,}
  \AttributeTok{birthyear =} \DecValTok{2007}\NormalTok{,}
  \AttributeTok{R\_user =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{score =} \FloatTok{12.1}
\NormalTok{)}

\FunctionTok{sheet\_append}\NormalTok{(SHEET\_ID, data, }\StringTok{"demographics"}\NormalTok{)}
\FunctionTok{read\_sheet}\NormalTok{(SHEET\_ID, }\StringTok{"demographics"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 4
##   name   birthyear R_user score
##   <chr>      <dbl> <lgl>  <dbl>
## 1 Lisa        1976 TRUE    10.2
## 2 Robbie      2007 FALSE   12.1
\end{verbatim}

If you try to append data of a different data type, some weird things can happen. Logical values added to a numeric column are cast as {0} ({1}) and {1} ({TRUE}), while numeric values added to a logical column change the column to numeric. If you mix character and numeric values in a column, the resulting column is a column of one-item lists so that each list can have the appropriate data type. (Data frames in R cannot mix data types in the same column.)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{name =} \DecValTok{1}\NormalTok{,}
  \AttributeTok{birthyear =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{R\_user =} \DecValTok{0}\NormalTok{,}
  \AttributeTok{score =} \StringTok{"No"}
\NormalTok{)}

\FunctionTok{sheet\_append}\NormalTok{(SHEET\_ID, data, }\StringTok{"demographics"}\NormalTok{)}
\FunctionTok{read\_sheet}\NormalTok{(SHEET\_ID, }\StringTok{"demographics"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 4
##   name      birthyear R_user score    
##   <list>        <dbl>  <dbl> <list>   
## 1 <chr [1]>      1976      1 <dbl [1]>
## 2 <chr [1]>      2007      0 <dbl [1]>
## 3 <dbl [1]>         0      0 <chr [1]>
\end{verbatim}

You must append data that has the same number and order of columns as the Google Sheet. If you send columns out of order, they will be recorded in the order you sent them, not in the order of the column names. If you send extra columns, the append will fail.

The demo app ``radiotables'' has a safer version of {sheet\_append}() that you can use when you're developing on your machine. It's defined in scripts/gs4.R. This version gracefully handles data with new columns, missing columns, columns in a different order, and columns with a different data type. However, it reads the whole data sheet before deciding whether to append or overwrite the data, which can slow down your app, so is best used only during development when you're changing things a lot. If it's not running locally, it uses the original {googlesheets4::sheet\_append}() function instead.

\hypertarget{gs4_save}{%
\section{Saving Googlesheet data}\label{gs4_save}}

If you mix data types in a column, the data frame returned by {read\_sheet}() has list columns for any mixed columns. Dates can also get written in different ways that look the same when you print to the console, but are a mix of characters and doubles, so you have to convert them to strings like this before you can save as CSV.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{string\_data }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(data, sapply, toString) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{as.data.frame}\NormalTok{()}
\NormalTok{readr}\SpecialCharTok{::}\FunctionTok{write\_csv}\NormalTok{(string\_data, }\StringTok{"data.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The demo app ``radiotables'' has a custom function {gs4\_write\_csv}() defined in scripts/gs4.R that does the above for you.

\hypertarget{exercises-data}{%
\section{Exercises}\label{exercises-data}}

\hypertarget{read-others-data}{%
\subsection{Read others' data}\label{read-others-data}}

Read in data from the public google sheet at \url{https://docs.google.com/spreadsheets/d/1QjpRZPNOOL0pfRO6IVT5WiafnyNdahsch1A03iHdv7s/}. Find the sheet ID and figure out which sheet has data on US states (assign this to the object \texttt{states}) and which has data on Eutherian mammals (assign this to \texttt{mammals}).

Solution

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(googlesheets4)}

\FunctionTok{gs4\_deauth}\NormalTok{()}

\NormalTok{sheet\_url }\OtherTok{\textless{}{-}} \StringTok{"https://docs.google.com/spreadsheets/d/1QjpRZPNOOL0pfRO6IVT5WiafnyNdahsch1A03iHdv7s/"}
\NormalTok{sheet\_id }\OtherTok{\textless{}{-}} \FunctionTok{as\_sheets\_id}\NormalTok{(sheet\_url)}

\NormalTok{states }\OtherTok{\textless{}{-}} \FunctionTok{read\_sheet}\NormalTok{(sheet\_id, }\DecValTok{1}\NormalTok{)}
\NormalTok{mammals }\OtherTok{\textless{}{-}} \FunctionTok{read\_sheet}\NormalTok{(sheet\_id, }\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{read-your-own-data}{%
\subsection{Read your own data}\label{read-your-own-data}}

Create a google sheet online and read its contents in R. You will need to either make it public first (click on the green Share icon in the upper right) or authorise googlesheets to access your account.

Solution

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{gs4\_auth}\NormalTok{()}
\NormalTok{my\_sheet\_url }\OtherTok{\textless{}{-}} \StringTok{""}
\NormalTok{mydata }\OtherTok{\textless{}{-}} \FunctionTok{read\_sheet}\NormalTok{(my\_sheet\_url)}
\end{Highlighting}
\end{Shaded}

\hypertarget{write-data}{%
\subsection{Write data}\label{write-data}}

Append some data to your google sheet.

\hypertarget{your-app-data}{%
\section{Your App}\label{your-app-data}}

In the app you're developing, determine what data need to be saved and set up a google sheet (or local data if you're having trouble with google). Write the server function to save data from your app when an action button is pressed.

\hypertarget{web}{%
\chapter{HTML, CSS, and JavaScript}\label{web}}

You don't need to know anything about HTML, CSS and JavaScript to make basic Shiny apps, but a little knowledge can really help you customise your apps. This chapter will cover some of the basics so you have enough vocabulary to get started.

\hypertarget{html}{%
\section{HTML}\label{html}}

HTML stands for Hyper-Text Markup Language, a system for semantically tagging structure and information on web pages. The term ``semantically'' is important here; HTML should tell you \textbf{what} something is, not \textbf{how} to display it (that's handled by \protect\hyperlink{CSS}{CSS}). This separation helps your apps be accessible to people who use screen readers.

\hypertarget{html-tags}{%
\subsection{HTML Tags}\label{html-tags}}

We learned about the {tags}() function in \protect\hyperlink{tags}{Chapter 1} and how it is linked to HTML tags. For example, the R code \texttt{tags\$h2("Methods")} creates the HTML \texttt{\textless{}h2\textgreater{}Methods\textless{}/h2\textgreater{}}. It surrounds the text content with a starting tag ({\textless h2\textgreater{}}) and an ending tag ({\textless/h2\textgreater{}}).

Tags create elements, which can be thought of kind of like boxes. An element can contain one or more elements. Elements can have attributes that provide more information such as the element's {id} or {class}, which can be used by CSS or JavaScript to refer to the element or a group of elements.

For example, the following code creates an unordered list ({\textless ul\textgreater{}}) with the {class} {"animals"}. It contains three list item elements ({\textless li\textgreater{}}), each with its own {id} and {class}.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}ul} \ErrorTok{class}\OtherTok{=}\StringTok{"animals"}\KeywordTok{\textgreater{}}
    \KeywordTok{\textless{}li} \ErrorTok{class}\OtherTok{=}\StringTok{"mammal"} \ErrorTok{id}\OtherTok{=}\StringTok{"aardvark"} \KeywordTok{\textgreater{}}\NormalTok{Aardvarks}\KeywordTok{\textless{}/li\textgreater{}}
    \KeywordTok{\textless{}li} \ErrorTok{class}\OtherTok{=}\StringTok{"insect"} \ErrorTok{id}\OtherTok{=}\StringTok{"bee"}\KeywordTok{\textgreater{}}\NormalTok{Bees}\KeywordTok{\textless{}/li\textgreater{}}
    \KeywordTok{\textless{}li} \ErrorTok{class}\OtherTok{=}\StringTok{"mammal"} \ErrorTok{id}\OtherTok{=}\StringTok{"capybara"}\KeywordTok{\textgreater{}}\NormalTok{Capybaras}\KeywordTok{\textless{}/li\textgreater{}}
\KeywordTok{\textless{}/ul\textgreater{}}
\end{Highlighting}
\end{Shaded}

You seldom \emph{have to} write HTML directly in Shiny, but if you have experience with HTML, it can sometimes be easier to create something in HTML than with the relevant Shiny functions. For example, the code above in Shiny would be:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tags}\SpecialCharTok{$}\FunctionTok{ul}\NormalTok{(}
  \AttributeTok{class =} \StringTok{"animals"}\NormalTok{,}
\NormalTok{  tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Aardvark"}\NormalTok{, }\AttributeTok{class =} \StringTok{"mammal"}\NormalTok{, }\AttributeTok{id =} \StringTok{"aardvark"}\NormalTok{),}
\NormalTok{  tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Bee"}\NormalTok{, }\AttributeTok{class =} \StringTok{"insect"}\NormalTok{, }\AttributeTok{id =} \StringTok{"bee"}\NormalTok{),}
\NormalTok{  tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Capybara"}\NormalTok{, }\AttributeTok{class =} \StringTok{"mammal"}\NormalTok{, }\AttributeTok{id =} \StringTok{"capybara"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Alternatively, you can use {HTML}() to include raw HTML in a ui function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{HTML}\NormalTok{(}\StringTok{\textquotesingle{}\textless{}ul class="animals"\textgreater{}}
\StringTok{    \textless{}li class="mammal" id="aardvark" \textgreater{}Aardvarks\textless{}/li\textgreater{}}
\StringTok{    \textless{}li class="insect" id="bee"\textgreater{}Bees\textless{}/li\textgreater{}}
\StringTok{    \textless{}li class="mammal" id="capybara"\textgreater{}Capybaras\textless{}/li\textgreater{}}
\StringTok{\textless{}/ul\textgreater{}\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{viewing-html}{%
\subsection{Viewing HTML}\label{viewing-html}}

But the main reason for you to learn a little about HTML is that it can help you to customise the appearance of your Shiny apps using \protect\hyperlink{CSS}{CSS} and their behaviour using \protect\hyperlink{JavaScript}{JavaScript}.

Often, you'll need to find out how to refer to a specific element or group of elements that were created by a shiny ui function. For example, it isn't obvious how you'd refer to the sidebar tab for {"x\_tab"} in the following code:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sidebarMenu}\NormalTok{(}
    \AttributeTok{id =} \StringTok{"tabs"}\NormalTok{,}
    \FunctionTok{menuItem}\NormalTok{(}\StringTok{"Tab Title"}\NormalTok{, }\AttributeTok{tabName =} \StringTok{"x\_tab"}\NormalTok{, }\AttributeTok{icon =} \FunctionTok{icon}\NormalTok{(}\StringTok{"dragon"}\NormalTok{))}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

If you open the resulting app in a web browser, right click on the page, and choose \textbf{\texttt{View\ Page\ Source}}, you'll (eventually) find that the code above created the HTML below.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}ul} \ErrorTok{class}\OtherTok{=}\StringTok{"sidebar{-}menu"}\KeywordTok{\textgreater{}}
  \KeywordTok{\textless{}li\textgreater{}}
    \KeywordTok{\textless{}a} \ErrorTok{href}\OtherTok{=}\StringTok{"\#shiny{-}tab{-}x\_tab"} \ErrorTok{data{-}toggle}\OtherTok{=}\StringTok{"tab"} \ErrorTok{data{-}value}\OtherTok{=}\StringTok{"x\_tab"}\KeywordTok{\textgreater{}}
      \KeywordTok{\textless{}i} \ErrorTok{class}\OtherTok{=}\StringTok{"fa fa{-}dragon"} \ErrorTok{role}\OtherTok{=}\StringTok{"presentation"} \ErrorTok{aria{-}label}\OtherTok{=}\StringTok{"dragon icon"}\KeywordTok{\textgreater{}\textless{}/i\textgreater{}}
      \KeywordTok{\textless{}span\textgreater{}}\NormalTok{Tab Title}\KeywordTok{\textless{}/span\textgreater{}}
    \KeywordTok{\textless{}/a\textgreater{}}
  \KeywordTok{\textless{}/li\textgreater{}}
  \KeywordTok{\textless{}div} \ErrorTok{id}\OtherTok{=}\StringTok{"tabs"} \ErrorTok{class}\OtherTok{=}\StringTok{"sidebarMenuSelectedTabItem"} \ErrorTok{data{-}value}\OtherTok{=}\StringTok{"null"}\KeywordTok{\textgreater{}\textless{}/div\textgreater{}}
\KeywordTok{\textless{}/ul\textgreater{}}
\end{Highlighting}
\end{Shaded}

Now you know that the dragon icon is made by an italics tag ({\textless i\textgreater{}}) that's inside an anchor ({\textless a\textgreater{}}) with the {id} {\#shiny-tab-x\_tab}. Therefore, you can change the colour of this icon using the following CSS:

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{\#shiny{-}tab{-}x\_tab}\NormalTok{ i \{ }\KeywordTok{color}\NormalTok{: }\ConstantTok{red}\OperatorTok{;}\NormalTok{ \}}
\end{Highlighting}
\end{Shaded}

It can be tricky to find what code you're looking for, but developer tools can help. I use \href{https://www.mozilla.org/en-US/firefox/developer/}{FireFox Developer Edition} when I'm developing web apps, but Chrome also has developer tools. In FireFox, go to \textbf{\texttt{Tools\ \textgreater{}\ Browser\ Tools\ \textgreater{}\ Web\ Developer\ Tools}} (opt-cmd-I). In Chrome, go to \textbf{\texttt{View\ \textgreater{}\ Developer\ \textgreater{}\ Developer\ Tools}} (opt-cmd-I). You can dock the tools to the bottom, right , or left of the window, or as a separate window.

Open the Inspector (FireFox) or Elements (Chrome) tab of the tools and click on the icon that looks like an arrow pointing into a box. When you hover over parts of the web page, not you will see boxes outlining each element. You can click on an element to highlight its HTML in the tools.

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/inspector} 

}

\caption{Viewing the HTML with the inspector.}\label{fig:inspector}
\end{figure}

\hypertarget{css}{%
\section{CSS}\label{css}}

CSS stands for Cascading Style Sheets and is a way to control the visual presentation of HTML on web pages. You can use CSS to change the default appearance of anything on a web page.

\hypertarget{css-basics}{%
\subsection{CSS Basics}\label{css-basics}}

CSS is structured as follows:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{selector \{ property: value}\OperatorTok{;}\NormalTok{ \}}
\end{Highlighting}
\end{Shaded}

Selectors are how you refer to the parts of the HTML you want to style. There are dozens of \href{https://www.w3schools.com/cssref/css_selectors.asp}{selectors} and they can get very complex. We'll focus on some basic examples below.

Properties are aspects of the visual style that you want to change, such as {color} (text color), {background-color}, or {border}. Values have specific formats for each property, such as {"1px"} or {"0.5em"} to describe lengths, or \texttt{red} or \texttt{\#FF0000} to describe colours.

There are hundreds of \href{https://www.w3schools.com/cssref/default.asp}{properties} and you can't memorise them all. I usually Google something like ``css font type'' or ``css underline text'' and choose the first link from \href{https://www.w3schools.com}{ww3schools}.

For example, if you have HTML that looks like this:

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}ul} \ErrorTok{class}\OtherTok{=}\StringTok{"animals"}\KeywordTok{\textgreater{}}
    \KeywordTok{\textless{}li} \ErrorTok{class}\OtherTok{=}\StringTok{"mammal"} \ErrorTok{id}\OtherTok{=}\StringTok{"aardvark"} \KeywordTok{\textgreater{}}\NormalTok{Aardvarks}\KeywordTok{\textless{}/li\textgreater{}}
    \KeywordTok{\textless{}li} \ErrorTok{class}\OtherTok{=}\StringTok{"insect"} \ErrorTok{id}\OtherTok{=}\StringTok{"bee"}\KeywordTok{\textgreater{}}\NormalTok{Bees}\KeywordTok{\textless{}/li\textgreater{}}
    \KeywordTok{\textless{}li} \ErrorTok{class}\OtherTok{=}\StringTok{"mammal"} \ErrorTok{id}\OtherTok{=}\StringTok{"capybara"}\KeywordTok{\textgreater{}}\NormalTok{Capybaras}\KeywordTok{\textless{}/li\textgreater{}}
\KeywordTok{\textless{}/ul\textgreater{}}
\end{Highlighting}
\end{Shaded}

You can refer to different parts of the list in many ways:

\begin{longtable}[]{@{}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.36}}
  >{\raggedright\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.64}}@{}}
\toprule
CSS & Meaning \\
\midrule
\endhead
\texttt{mammal\ \{\ border:\ 1px\ solid\ green;\ \}} & any element with the {class} {"mammal"} will get a 1-pixel green border \\
\texttt{ul.animals\ \{\ border:\ 1px\ solid\ green;\ \}} & any unordered list with the {class} {"animals"} will get a 1-pixel green border \\
\texttt{.animals\ li\ \{\ color:\ blue;\ \}} & any list item element inside an element with the {class} {"animals"} will have blue text \\
\texttt{\#bee\ \{\ font-style:\ italic;\ \}} & the element with the {id} {"bee"} will be in italics \\
\texttt{.animals\ li\ +\ li\ \{\ background-color:\ grey;\ \}} & inside an element with the {class} {"animals"}, any list item that follows another list item will have a grey background \\
\bottomrule
\end{longtable}

\hypertarget{styling-a-single-element}{%
\subsection{Styling a single element}\label{styling-a-single-element}}

You can add styles to most elements that you make with shiny ui functions by adding an argument called {style}. You don't need to give them a {class} or {id} this way, but this is inefficient if you're styling many related elements in the same way.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tags}\SpecialCharTok{$}\FunctionTok{ul}\NormalTok{(}
  \AttributeTok{style =} \StringTok{"width: 10em;"}\NormalTok{,}
\NormalTok{  tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Aardvark"}\NormalTok{),}
\NormalTok{  tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Bee"}\NormalTok{, }\AttributeTok{style =} \StringTok{"background{-}color: yellow;"}\NormalTok{),}
\NormalTok{  tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Capybara"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{inline-css}{%
\subsection{Inline CSS}\label{inline-css}}

You can add a small amount of CSS to an app inside the header using the style tag. The code below makes the element with the {class} {"animal"} {"10em"} in {width} (\emph{em} is a unit of size that is proportional to text size). It also makes the element with the {id} {"bee"} italic and gives it a black {background-color} with yellow text {color}. If the element is a list item, it makes the marker a bee emoji.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mystyle }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}}
\StringTok{  .animal \{ width: 10em; \}}
\StringTok{  \#bee \{}
\StringTok{    font{-}style: italic; }
\StringTok{    color: yellow;}
\StringTok{    background{-}color: black;}
\StringTok{  \}}
\StringTok{  li\#bee::marker \{ content: "ðŸ "; \}}
\StringTok{\textquotesingle{}}

\NormalTok{ui }\OtherTok{\textless{}{-}} \FunctionTok{fluidPage}\NormalTok{(tags}\SpecialCharTok{$}\FunctionTok{head}\NormalTok{(tags}\SpecialCharTok{$}\FunctionTok{style}\NormalTok{(mystyle)),}
\NormalTok{                tags}\SpecialCharTok{$}\FunctionTok{ul}\NormalTok{(}
                  \AttributeTok{class =} \StringTok{"animals"}\NormalTok{,}
\NormalTok{                  tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Aardvark"}\NormalTok{, }\AttributeTok{class =} \StringTok{"mammal"}\NormalTok{, }\AttributeTok{id =} \StringTok{"aardvark"}\NormalTok{),}
\NormalTok{                  tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Bee"}\NormalTok{, }\AttributeTok{class =} \StringTok{"insect"}\NormalTok{, }\AttributeTok{id =} \StringTok{"bee"}\NormalTok{),}
\NormalTok{                  tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}\StringTok{"Capybara"}\NormalTok{, }\AttributeTok{class =} \StringTok{"mammal"}\NormalTok{, }\AttributeTok{id =} \StringTok{"capybara"}\NormalTok{)}
\NormalTok{                ))}
\end{Highlighting}
\end{Shaded}

Aardvarks

Bees

Capybaras

\hypertarget{external-css}{%
\subsection{External CSS}\label{external-css}}

For anything longer than a few lines, you can see how this can get tedious. You can put all of your CSS in an external file and reference that in the header instead using {tags\$link}(). The CSS file needs to be inside the www directory to let Shiny know that it's meant to be included like this. The template we're using in this class comes with a CSS file called www/custom.css.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tags}\SpecialCharTok{$}\FunctionTok{head}\NormalTok{(}
\NormalTok{  tags}\SpecialCharTok{$}\FunctionTok{link}\NormalTok{(}\AttributeTok{rel =} \StringTok{"stylesheet"}\NormalTok{, }\AttributeTok{type =} \StringTok{"text/css"}\NormalTok{, }\AttributeTok{href =} \StringTok{"custom.css"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Sometimes when you change external files, they don't seem to update when you test the app. This can be because of caching. You can usually solve this by reloading the app in your web browser, reloading in the web browser with the shift key pressed, stopping the app from running in RStudio with the stop sign icon and starting it up again, and, finally, restarting R.

\hypertarget{javascript}{%
\section{JavaScript}\label{javascript}}

JavaScript is a coding language that is very useful for adding dynamic behaviour to web pages. For simple apps, you don't need to understand any JavaScript, but a little bit can be really helpful for adding advanced behaviour.

\hypertarget{shinyjs}{%
\subsection{shinyjs}\label{shinyjs}}

The R package shinyjs provides several ways to work with JavaScript in a Shiny app. In order to set it up so that your server function can use shinyjs function, you need to add {shinyjs::useShinyjs}() somewhere in your ui function.

Here is a list of the shinyjs functions that I find most useful ({id} refers to an element with the specified ID):

\begin{itemize}
\tightlist
\item
  {hide}(id): hide the element
\item
  {show}(id): show the element
\item
  {toggle}(id): change the visibility of the element (hide it if it's visible, and show it if it's not)
\item
  {alert}(text): create an alert popup; this is useful for debugging
\item
  {addClass}(id, class): adds a CSS class to the element
\item
  {removeClass}(id, class): removes a CSS class from the element
\item
  {click}(id): simulates a click on the action button
\item
  {disable}(id): disable an input
\item
  {enable}(id): enables an input
\item
  {reset}(id): resets an input (much easier than the update* functions)
\end{itemize}

\hypertarget{external-js}{%
\subsection{External JS}\label{external-js}}

To do anything more complicated, it's best to put your JavaScript in an external file in the www directory. You can include a link to this script in the header. The template we're using in this class comes with a JavaScript file called www/custom.js.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tags}\SpecialCharTok{$}\FunctionTok{head}\NormalTok{(}
\NormalTok{  tags}\SpecialCharTok{$}\FunctionTok{script}\NormalTok{(}\AttributeTok{src =} \StringTok{"custom.js"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Shiny apps use \href{https://jquery.com/}{jQuery}, a framework for making JavaScript easier to write. It lets you refer to elements using their CSS selectors.

Here is some example code from the www/custom.js file in the basic template.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{$}\NormalTok{(}\BuiltInTok{document}\NormalTok{)}\OperatorTok{.}\FunctionTok{on}\NormalTok{(}\StringTok{"shiny:connected"}\OperatorTok{,} \KeywordTok{function}\NormalTok{() \{}
  \CommentTok{// send window width to shiny}
\NormalTok{  shiny\_size }\OperatorTok{=} \KeywordTok{function}\NormalTok{() \{}
\NormalTok{    Shiny}\OperatorTok{.}\FunctionTok{setInputValue}\NormalTok{(}\StringTok{"window\_width"}\OperatorTok{,} \BuiltInTok{window}\OperatorTok{.}\AttributeTok{innerWidth}\NormalTok{)}\OperatorTok{;}
\NormalTok{    Shiny}\OperatorTok{.}\FunctionTok{setInputValue}\NormalTok{(}\StringTok{"window\_height"}\OperatorTok{,} \BuiltInTok{window}\OperatorTok{.}\AttributeTok{innerHeight}\NormalTok{)}\OperatorTok{;}
\NormalTok{  \}}
  
  \BuiltInTok{window}\OperatorTok{.}\AttributeTok{onresize} \OperatorTok{=}\NormalTok{ shiny\_size}\OperatorTok{;}
  \FunctionTok{shiny\_size}\NormalTok{()}\OperatorTok{;} \CommentTok{// trigger once at start}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

JavaScript is similar to R in some ways, and maddeningly different in others. One big difference is that lines of code \textbf{\emph{have to}} end with a semi-colon.

In the code above, the function \texttt{\$(document).on("shiny:connected",\ function()\ \{\ ...\ \})} is jQuery shorthand for making sure that the code inside doesn't run until the whole webpage has been downloaded and the extra javascript for shiny is available. Otherwise, you might try to run some code that references an element that hasn't been created yet (HTML pages don't always download all in one go) or uses a Shiny javascript function that isn't available yet.

The we create a new function called {shiny\_size}(), which creates two new Shiny input variables, {"window\_width"} and {"window\_height"}, and sets then to the values of the window dimensions (in pixels). The line \texttt{window.onresize\ =\ shiny\_size;} sets this function to run every time the window is resized and the function is run once at the start to initialise those values.

The javaScript function \texttt{Shiny.setInputValue(input\_id,\ value)} is a way for you to communicate things that happen on the web page to the Shiny app by changing or creating inputs. You can use this inside {server}() to, for example, change a plot style if \texttt{input\$window\_width\ \textless{}\ 600}.

\hypertarget{resources-web}{%
\section{Further Resources}\label{resources-web}}

\begin{itemize}
\tightlist
\item
  \href{https://www.w3schools.com/html/}{W3 Schools HTML Tutorial}
\item
  \href{https://shiny.rstudio.com/articles/css.html}{Using Custom CSS in your App}
\item
  \href{https://www.w3schools.com/cssref/css_selectors.asp}{CSS Selectors Reference}
\item
  \href{https://shiny.rstudio.com/articles/packaging-javascript.html}{Packaging JavaScript Code for Shiny}
\item
  \href{https://www.w3schools.com/jquERy/default.asp}{W3 Schools jQuery Tutorial}
\item
  \href{https://www.codecademy.com/en/tracks/htmlcss}{Codeacademy interactive tutorials}
\end{itemize}

\hypertarget{exercises-web}{%
\section{Exercises}\label{exercises-web}}

Clone the basic template for these exercises.

\hypertarget{add-html}{%
\subsection{Add HTML}\label{add-html}}

Add the following HTML before the image in \texttt{x\_tab} using `{HTML}():

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{\textless{}p} \ErrorTok{class}\OtherTok{=}\StringTok{"help"}\KeywordTok{\textgreater{}}\NormalTok{For more help, you can go to }\KeywordTok{\textless{}a} \ErrorTok{href}\OtherTok{=}\StringTok{"https://shiny.rstudio.com/articles/html{-}tags.html"}\KeywordTok{\textgreater{}}\NormalTok{Customize your UI with HTML}\KeywordTok{\textless{}/a\textgreater{}}\NormalTok{.}\KeywordTok{\textless{}/p\textgreater{}}
\end{Highlighting}
\end{Shaded}

Hint

Since the HTML has double quotes in it, you either need to escape them or surround the string in single quotes instead.

Solution

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x\_tab }\OtherTok{\textless{}{-}} \FunctionTok{tabItem}\NormalTok{(}
  \AttributeTok{tabName =} \StringTok{"x\_tab"}\NormalTok{,}
  \FunctionTok{HTML}\NormalTok{(}
    \StringTok{\textquotesingle{}\textless{}p class="help"\textgreater{}For more help, you can go to \textless{}a href="https://shiny.rstudio.com/articles/html{-}tags.html"\textgreater{}Customize your UI with HTML\textless{}/a\textgreater{}.\textless{}/p\textgreater{}\textquotesingle{}}
\NormalTok{  ),}
  \FunctionTok{imageOutput}\NormalTok{(}\StringTok{"logo"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{class-html}{%
\subsection{Class HTML}\label{class-html}}

Add an unordered list under the paragraph that contains the following text and links:

\begin{itemize}
\tightlist
\item
  \href{https://shiny.rstudio.com/articles/tag-glossary.html}{Tags Glossary}
\item
  \href{https://www.w3schools.com/html/}{HTML Tutorial}
\end{itemize}

Solution

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x\_tab }\OtherTok{\textless{}{-}} \FunctionTok{tabItem}\NormalTok{(}
  \AttributeTok{tabName =} \StringTok{"x\_tab"}\NormalTok{,}
  \FunctionTok{HTML}\NormalTok{(}
    \StringTok{\textquotesingle{}\textless{}p class="help"\textgreater{}For more help, you can go to \textless{}a href="https://shiny.rstudio.com/articles/html{-}tags.html"\textgreater{}Customize your UI with HTML\textless{}/a\textgreater{}.\textless{}/p\textgreater{}\textquotesingle{}}
\NormalTok{  ),}
\NormalTok{  tags}\SpecialCharTok{$}\FunctionTok{ul}\NormalTok{(tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}
\NormalTok{    tags}\SpecialCharTok{$}\FunctionTok{a}\NormalTok{(}\AttributeTok{href =} \StringTok{"https://shiny.rstudio.com/articles/tag{-}glossary.html"}\NormalTok{, }\StringTok{"Tags Glossary"}\NormalTok{)}
\NormalTok{  ),}
\NormalTok{  tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(}
\NormalTok{    tags}\SpecialCharTok{$}\FunctionTok{a}\NormalTok{(}\AttributeTok{href =} \StringTok{"https://www.w3schools.com/html/"}\NormalTok{, }\StringTok{"HTML Tutorial"}\NormalTok{)}
\NormalTok{  )),}
  \FunctionTok{imageOutput}\NormalTok{(}\StringTok{"logo"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{style-links}{%
\subsection{Style links}\label{style-links}}

Change the style of all the links to make them \texttt{hotpink}. Use the inline CSS method. As a bonus, change the colour of links when you hover over them, too.

Solution

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tags}\SpecialCharTok{$}\FunctionTok{head}\NormalTok{(}
\NormalTok{  tags}\SpecialCharTok{$}\FunctionTok{style}\NormalTok{(}\StringTok{"a \{ color: hotpink; \}}
\StringTok{              a:hover \{ color: red; \}"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{style-a-single-link-directly}{%
\subsection{Style a single link directly}\label{style-a-single-link-directly}}

Change the style of just the first link in the list to make it \texttt{green}.

Solution

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tags}\SpecialCharTok{$}\FunctionTok{ul}\NormalTok{(}
\NormalTok{        tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(tags}\SpecialCharTok{$}\FunctionTok{a}\NormalTok{(}\AttributeTok{href =} \StringTok{"https://shiny.rstudio.com/articles/tag{-}glossary.html"}\NormalTok{, }\StringTok{"Tags Glossary"}\NormalTok{), }\AttributeTok{style=}\StringTok{"color: green;"}\NormalTok{),}
\NormalTok{        tags}\SpecialCharTok{$}\FunctionTok{li}\NormalTok{(tags}\SpecialCharTok{$}\FunctionTok{a}\NormalTok{(}\AttributeTok{href =} \StringTok{"https://www.w3schools.com/html/"}\NormalTok{, }\StringTok{"HTML Tutorial"}\NormalTok{))}
\NormalTok{    )}
\end{Highlighting}
\end{Shaded}

\hypertarget{external-css-1}{%
\subsection{External CSS}\label{external-css-1}}

Change the style of just the links inside paragraphs with the {class} {"help"} to have an underline. Use external CSS.

Solution

Add the following to www/custom.css:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{.help}\NormalTok{ a \{ }\KeywordTok{text{-}decoration}\NormalTok{: }\DecValTok{underline}\OperatorTok{;}\NormalTok{ \}}
\end{Highlighting}
\end{Shaded}

\hypertarget{your-app-web}{%
\section{Your App}\label{your-app-web}}

Add some new styles to www/custom.css in your custom app. See if you can figure out how to change any aspects of the default interface that bug you.

\hypertarget{structure}{%
\chapter{Structuring a complex app}\label{structure}}

So far, we've been mostly structuring our app entirely in the app.R file, apart from some of the web helper files for CSS and JavaScript. However, once your apps start getting relatively complex, you might find it easier to move some of the code into external .R files and using \texttt{source()} to include them. There are a few things to watch out for when you do this.

\hypertarget{external-server-functions}{%
\section{External Server Functions}\label{external-server-functions}}

You can define functions you want to use in your app at the top of the app.R file, but that can make that file difficult to parse pretty quickly. The basic template includes external functions with the line:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{source}\NormalTok{(}\StringTok{"scripts/func.R"}\NormalTok{) }\CommentTok{\# helper functions}
\end{Highlighting}
\end{Shaded}

This file contains definitions for the functions {debug\_msg}() and {debug\_sprintf}(). You can add your own custom functions to this file or to another file that you source in separately.

All .R files inside a directory called R will run before the app starts up, even if you don't source them into the app. You can use this to set up any functions your app needs without having to use {source}(), but I prefer to explicitly include external files, so I keep external functions in a directory called \texttt{scripts}.

\hypertarget{sourcing-locally}{%
\subsection{Sourcing Locally}\label{sourcing-locally}}

It can be tricky to use shiny functions to external files. For example, you can't just move the contents of {server}() to an external file called scripts/logo.R and source the file in like this:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
    \FunctionTok{source}\NormalTok{(}\StringTok{"scripts/logo.R"}\NormalTok{)}
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

You'll get an error like: ``Error in output\$logo \textless- renderImage(\{ : object `output' not found''. This is because the input and output objects only work like you'd expect when they are inside {server}()

However, you can source in external code inside {server}() by setting the \texttt{local} argument to TRUE.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
    \FunctionTok{source}\NormalTok{(}\StringTok{"scripts/logo.R"}\NormalTok{, }\AttributeTok{local =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

You might find it useful to break up parts of the server logic for a very big app into separate files like this, but it's more common to keep any code that uses reactive functions inside {server}() in the app.R file, and move large sections of code inside those functions to externally defined functions.

For example, you could define the function {logo\_image}() in the external file scripts/logo.R like this:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{logo\_image}\NormalTok{() }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{() \{}
  \FunctionTok{list}\NormalTok{(}\AttributeTok{src =} \StringTok{"www/img/shinyintro.png"}\NormalTok{,}
       \AttributeTok{width =} \StringTok{"300px"}\NormalTok{,}
       \AttributeTok{height =} \StringTok{"300px"}\NormalTok{,}
       \AttributeTok{alt =} \StringTok{"ShinyIntro hex logo"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

The following in the app.R file keeps the reactive function {renderImage}() inside {server}(), but lets you reduce the number of lines of code.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{source}\NormalTok{(}\StringTok{"scripts/logo.R"}\NormalTok{)}

\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
    \FunctionTok{source}\NormalTok{(}\StringTok{"scripts/logo.R"}\NormalTok{, }\AttributeTok{local =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{logo }\OtherTok{\textless{}{-}} \FunctionTok{renderImage}\NormalTok{(}\FunctionTok{logo\_image}\NormalTok{(), }\AttributeTok{deleteFile =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

\hypertarget{inputs-and-outputs}{%
\subsection{Inputs and Outputs}\label{inputs-and-outputs}}

The objects \texttt{input} and \texttt{output} aren't available by default to externally defined functions. Let's add an action button to the ui for our app, \texttt{actionButton("change",\ "Change\ Image")}, and change the {logo\_image}() function so that it returns the ShinyIntro logo on odd-numbered clicks of the change button, and the psyTeachR logo on even-numbered clicks.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{logo\_image }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{() \{}
\NormalTok{  odd\_clicks }\OtherTok{\textless{}{-}}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{change}\SpecialCharTok{\%\%}\DecValTok{2} \SpecialCharTok{==} \DecValTok{1}
\NormalTok{  src }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(odd\_clicks, }
                \StringTok{"www/img/shinyintro.png"}\NormalTok{, }
                \StringTok{"www/img/psyteachr.png"}\NormalTok{)}
  
  \FunctionTok{list}\NormalTok{(}\AttributeTok{src =}\NormalTok{ src,}
       \AttributeTok{width =} \StringTok{"300px"}\NormalTok{,}
       \AttributeTok{height =} \StringTok{"300px"}\NormalTok{,}
       \AttributeTok{alt =} \StringTok{"ShinyIntro hex logo"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

If you try to run this, you'll get an error message like, ``Error in logo\_image: object `input' not found''. This is because the external function doesn't have access to reactive objects like \texttt{input}, \texttt{output}, \texttt{session}, or any {reactiveValues}().

The best solution is to pass any variables to the function that you need. In some circumstances, you can pass the whole \texttt{input} object, but that's seldom necessary.

Here, we change {logo\_image}() to take a single argument called {change} and replace \texttt{input\$change} with this argument.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{logo\_image }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(change) \{}
\NormalTok{  odd\_clicks }\OtherTok{\textless{}{-}}\NormalTok{ change}\SpecialCharTok{\%\%}\DecValTok{2} \SpecialCharTok{==} \DecValTok{1}
\NormalTok{  src }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(odd\_clicks, }
                \StringTok{"www/img/shinyintro.png"}\NormalTok{, }
                \StringTok{"www/img/psyteachr.png"}\NormalTok{)}
  
  \FunctionTok{list}\NormalTok{(}\AttributeTok{src =}\NormalTok{ src,}
       \AttributeTok{width =} \StringTok{"300px"}\NormalTok{,}
       \AttributeTok{height =} \StringTok{"300px"}\NormalTok{,}
       \AttributeTok{alt =} \StringTok{"ShinyIntro hex logo"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Then we just have to pass the value of \texttt{input\$change} to {logo\_image}() inside {renderImage}(), where the \texttt{input} object is available.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output, session) \{}
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{logo }\OtherTok{\textless{}{-}} \FunctionTok{renderImage}\NormalTok{(\{}
        \FunctionTok{logo\_image}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{change)}
\NormalTok{    \}, }\AttributeTok{deleteFile =} \ConstantTok{FALSE}\NormalTok{)}
\NormalTok{\} }
\end{Highlighting}
\end{Shaded}

Don't worry too much if this isn't making a lot of sense yet. The main thing I want you to take away from this section is that when you try to move some server code to external files, you might get errors (I frequently do). I hope that will remind you of this lesson and you'll have a better idea about where to start looking for the solution.

\hypertarget{external-ui-files}{%
\section{External UI Files}\label{external-ui-files}}

Defining a complex UI can be very challenging. The basic template uses a pattern that I find helpful with apps that have multiple tab items. I assign each tab to an object and then include the tabs of the app in {dashboardBody}() like this:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tabItems}\NormalTok{(}
\NormalTok{    intro\_tab,}
\NormalTok{    questionnaire\_tab,}
\NormalTok{    feedback\_tab,}
\NormalTok{    info\_tab}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

For a simple app, you can define the tabs in app.R just before you define the \texttt{ui}. You can do the same for any components of the \texttt{ui}, such as {dashboardHeader}() or {dashboardSidebar}(). When the sections start getting complex, you can move them into external files and source them in.

\hypertarget{ui-lists}{%
\subsection{UI Lists}\label{ui-lists}}

\includegraphics{images/structure_ui.png}

When parts of the UI repeat or can be created programmatically instead of manually, you can use {apply}() or {map}() functions to create a list of UI components. It can be a little tricky to figure out how to add a list of components into the UI, but this can be accomplished with {do.call}().

Here's an example of how you would programatically create select inputs for each categorical column of the \texttt{starwars} dataset from dplyr and add them to a {box}().

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# get the categorical columns}
\NormalTok{col\_is\_char }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(starwars, is.character)}
\NormalTok{categorical\_cols }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(starwars)[col\_is\_char]}

\CommentTok{\# set up the selectInputs}
\NormalTok{select\_inputs }\OtherTok{\textless{}{-}} \FunctionTok{lapply}\NormalTok{(categorical\_cols, }\ControlFlowTok{function}\NormalTok{(col) \{}
\NormalTok{  unique\_vals }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(starwars[[col]])}
  
  \FunctionTok{selectInput}\NormalTok{(}\AttributeTok{inputId =}\NormalTok{ col, }\AttributeTok{label =}\NormalTok{ col, }\AttributeTok{choices =}\NormalTok{ unique\_vals)}
\NormalTok{\})}

\CommentTok{\# add container arguments to select\_inputs }
\NormalTok{select\_inputs}\SpecialCharTok{$}\NormalTok{title }\OtherTok{=} \StringTok{"Select the Categories"}
\NormalTok{select\_inputs}\SpecialCharTok{$}\NormalTok{solidHeader }\OtherTok{=} \ConstantTok{TRUE}
\NormalTok{select\_inputs}\SpecialCharTok{$}\NormalTok{width }\OtherTok{=} \DecValTok{4}

\CommentTok{\# add to container}
\NormalTok{select\_box }\OtherTok{\textless{}{-}} \FunctionTok{do.call}\NormalTok{(box, select\_inputs)}
\end{Highlighting}
\end{Shaded}

\hypertarget{exercises-structure}{%
\section{Exercises}\label{exercises-structure}}

\hypertarget{ui-1}{%
\subsection{UI}\label{ui-1}}

Clone the reactive\_demo, move the boxes in the ui to an external file, and source them in.

\hypertarget{server}{%
\subsection{Server}\label{server}}

Make a custom function in scripts/func.R that creates the plot. Use that in {server}().

\hypertarget{your-app-structure}{%
\section{Your App}\label{your-app-structure}}

In the app you're developing, see if there are any long functions inside reactive functions in {server}() that can be moved to scripts/func.R or another external file. Move each tab into an external file and source it into app.R.

\hypertarget{debugging}{%
\chapter{Debugging and error handling}\label{debugging}}

Bugs are a part of coding. A great coder isn't someone who writes bug-free code on their first try (this is an unachievable goal), but rather someone who knows how to efficiently catch bugs. This section presents a few simple ways to debug your Shiny app.

\hypertarget{rstudio-console-messages}{%
\section{RStudio Console Messages}\label{rstudio-console-messages}}

Sending messages to the console is a simple way to debug your code.

I like to keep track of what functions are being called by starting every function inside the server function with a message. The template includes a custom message logging function that helps you use this with both development and deployed apps: {debug\_msg}().

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# display debugging messages in R (if local) }
\CommentTok{\# and in the console log (if running in shiny)}
\NormalTok{debug\_msg }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(...) \{}
\NormalTok{  is\_local }\OtherTok{\textless{}{-}} \FunctionTok{Sys.getenv}\NormalTok{(}\StringTok{\textquotesingle{}SHINY\_PORT\textquotesingle{}}\NormalTok{) }\SpecialCharTok{==} \StringTok{""}
\NormalTok{  in\_shiny }\OtherTok{\textless{}{-}} \SpecialCharTok{!}\FunctionTok{is.null}\NormalTok{(shiny}\SpecialCharTok{::}\FunctionTok{getDefaultReactiveDomain}\NormalTok{())}
\NormalTok{  txt }\OtherTok{\textless{}{-}} \FunctionTok{toString}\NormalTok{(}\FunctionTok{list}\NormalTok{(...))}
  \ControlFlowTok{if}\NormalTok{ (is\_local) }\FunctionTok{message}\NormalTok{(txt)}
  \ControlFlowTok{if}\NormalTok{ (in\_shiny) shinyjs}\SpecialCharTok{::}\FunctionTok{runjs}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}\StringTok{"console.debug(}\SpecialCharTok{\textbackslash{}"}\StringTok{\%s}\SpecialCharTok{\textbackslash{}"}\StringTok{)"}\NormalTok{, txt))}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

For example, the code below prints ``questionnaire submitted'' every time the action button \texttt{q\_submit} is pressed. It prints to the javascript console and also to the RStudio console when you're developing.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{observeEvent}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{q\_submit, \{}
  \FunctionTok{debug\_msg}\NormalTok{(}\StringTok{"questionnaire submitted"}\NormalTok{)}
  \CommentTok{\# rest of code ...}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\hypertarget{javascript-console}{%
\section{JavaScript Console}\label{javascript-console}}

I use \href{https://www.mozilla.org/en-US/firefox/developer/}{FireFox Developer Edition} when I'm developing web apps, but Chrome also has developer tools. In FireFox, go to \textbf{\texttt{Tools\ \textgreater{}\ Browser\ Tools\ \textgreater{}\ Web\ Developer\ Tools}} (opt-cmd-I). In Chrome, go to \textbf{\texttt{View\ \textgreater{}\ Developer\ \textgreater{}\ Developer\ Tools}} (opt-cmd-I). You can dock the tools to the bottom, right , or left of the window, or as a separate window.

\begin{figure}

{\centering \includegraphics[width=0.3\linewidth]{images/js_console_firefox} \includegraphics[width=0.3\linewidth]{images/js_console_chrome} 

}

\caption{Javascript consoles in FireFox Developer Edition and Chrome.}\label{fig:js-console}
\end{figure}

Shiny puts a lot of info you won't care about into the logs, so {debug\_msg}() writes messages to the debug console. You can filter just those messages by choosing only \textbf{\texttt{Debug}} in FireFox or \textbf{\texttt{Verbose}} in Chrome.

\hypertarget{showcase-mode}{%
\section{Showcase Mode}\label{showcase-mode}}

You can view an app in showcase mode by setting ``DisplayMode'' to ``Showcase'' (instead of ``Normal'') in the DESCRIPTION file in the app directory. When you're in this mode, you can see your app code, css files, and javascript files. The functions in {server}() will highlight in yellow each time they are run. However, this isn't much help if many of your functions are in external files or you are using modules. Also, if your script is very long, you won't be able to see the highlighting unless you've scrolled to the right section, so I find it more straightforward to use the message method described above.

\begin{verbatim}
Title: Questionnaire Template
Author: Lisa DeBruine
License: CC-BY-4.0
DisplayMode: Showcase
Type: Shiny
\end{verbatim}

\begin{figure}

{\centering \includegraphics[width=1\linewidth]{images/showcase_mode} 

}

\caption{Showcase mode.}\label{fig:showcase-mode}
\end{figure}

\hypertarget{trycatch}{%
\section{tryCatch}\label{trycatch}}

You've probably experienced the greyed out screen of a crashed app more than enough now. In development, the next step is to look at the console to see if you have a warning or error message. If you're lucky, you can figure out where in the code this is happening (this is easier if you start all your functions with a debug message) and fix it.

However, sometimes there are errors that are difficult to prevent. For example, you can try to restrict inputs so the users only enter numeric values using {numericInput}(), but many browsers will let you enter text values anyways (they cause a value of \texttt{NA}). To avoid crashing the whole app, you can wrap potentially error-triggering code in {tryCatch}().

For example, the code below will cause an error because you can't add a number and a letter.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{input }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{n1 =} \DecValTok{10}\NormalTok{, }\AttributeTok{n2 =} \StringTok{"A"}\NormalTok{)}

\NormalTok{sum }\OtherTok{\textless{}{-}}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{n1 }\SpecialCharTok{+}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{n2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in input$n1 + input$n2: non-numeric argument to binary operator
\end{verbatim}

The following code tries to run the code inside the curly brackets (\texttt{\{\}}), but if it creates an error, the error function will run. The object \texttt{e} is the error object, and you can print the message from it using {debug\_msg}() (this won't crash the app).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sum }\OtherTok{\textless{}{-}} \FunctionTok{tryCatch}\NormalTok{(\{}
\NormalTok{  input}\SpecialCharTok{$}\NormalTok{n1 }\SpecialCharTok{+}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{n2}
\NormalTok{\}, }\AttributeTok{error =} \ControlFlowTok{function}\NormalTok{(e) \{}
  \FunctionTok{debug\_msg}\NormalTok{(e}\SpecialCharTok{$}\NormalTok{message)}
  \FunctionTok{return}\NormalTok{(}\DecValTok{0}\NormalTok{)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

The return value from the error message is the value assigned to \texttt{sum} if there is an error. Sometimes it won't make sense to have a default value, or the code you're checking doesn't have a return value. In that case, you can just put all the code inside the brackets and not return anything from the error function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tryCatch}\NormalTok{(\{}
\NormalTok{  sum }\OtherTok{\textless{}{-}}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{n1 }\SpecialCharTok{+}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{n2}
\NormalTok{  output}\SpecialCharTok{$}\NormalTok{sum }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(sum)}
\NormalTok{\}, }\AttributeTok{error =} \ControlFlowTok{function}\NormalTok{(e) \{}
  \FunctionTok{debug\_msg}\NormalTok{(e}\SpecialCharTok{$}\NormalTok{message)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\hypertarget{input-checking}{%
\section{Input Checking}\label{input-checking}}

The user above might be frustrated if they've made a mistake that causes an error and don't know what it was. You can help prevent errors and make the experience of using your app nicer by doing input checking and sending your users useful messages.

\hypertarget{modal-dialogs}{%
\subsection{Modal Dialogs}\label{modal-dialogs}}

One method is to check your input values, generate an appropriate error message if anything is wrong, and show the message in a {modalDialog}().

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{observeEvent}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{submit, \{}
  \CommentTok{\# check inputs}
\NormalTok{  input\_error }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{case\_when}\NormalTok{(}
    \SpecialCharTok{!}\FunctionTok{is.numeric}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{n1) }\SpecialCharTok{\textasciitilde{}} \StringTok{"N1 needs to be a number"}\NormalTok{,}
    \SpecialCharTok{!}\FunctionTok{is.numeric}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{n2) }\SpecialCharTok{\textasciitilde{}} \StringTok{"N2 needs to be a number"}\NormalTok{,}
    \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \StringTok{""}
\NormalTok{  )}
  \ControlFlowTok{if}\NormalTok{ (input\_error }\SpecialCharTok{!=} \StringTok{""}\NormalTok{) \{}
    \FunctionTok{showModal}\NormalTok{(}\FunctionTok{modalDialog}\NormalTok{(}
      \AttributeTok{title =} \StringTok{"input\_error"}\NormalTok{,}
\NormalTok{      input\_error,}
      \AttributeTok{easyClose =} \ConstantTok{TRUE}
\NormalTok{    ))}
    \FunctionTok{return}\NormalTok{() }\CommentTok{\# exit the function here}
\NormalTok{  \}}
  
  \CommentTok{\# no input errors}
\NormalTok{    sum }\OtherTok{\textless{}{-}}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{n1 }\SpecialCharTok{+}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{n2}
\NormalTok{    add\_text }\OtherTok{\textless{}{-}} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%d + \%d = \%d"}\NormalTok{, input}\SpecialCharTok{$}\NormalTok{n1, input}\SpecialCharTok{$}\NormalTok{n2, sum)}
\NormalTok{    output}\SpecialCharTok{$}\NormalTok{n1\_plus\_n2 }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(add\_text)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\hypertarget{validate}{%
\subsection{Validate}\label{validate}}

You can also use {validate}() and {need}() to test for required inputs to an output. However, this only works from inside a render function or a reactive function called inside a render function. I prefer to make my own pop-up messages like above, because they will work from any type of function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{server }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(input, output) \{}
\NormalTok{  add\_text }\OtherTok{\textless{}{-}} \FunctionTok{reactive}\NormalTok{(\{}
\NormalTok{    input}\SpecialCharTok{$}\NormalTok{add }\CommentTok{\# triggers reactive}
\NormalTok{    n1 }\OtherTok{\textless{}{-}} \FunctionTok{isolate}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{n1)}
\NormalTok{    n2 }\OtherTok{\textless{}{-}} \FunctionTok{isolate}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{n2)}
    \FunctionTok{validate}\NormalTok{(}
      \FunctionTok{need}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(n1), }\StringTok{"The first value must a number"}\NormalTok{),}
      \FunctionTok{need}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(n2), }\StringTok{"The second value must a number"}\NormalTok{)}
\NormalTok{    )}
    
    \FunctionTok{sprintf}\NormalTok{(}\StringTok{"\%d + \%d = \%d"}\NormalTok{, n1, n2, n1 }\SpecialCharTok{+}\NormalTok{ n2)}
\NormalTok{  \})}

\NormalTok{  output}\SpecialCharTok{$}\NormalTok{n1\_plus\_n2 }\OtherTok{\textless{}{-}} \FunctionTok{renderText}\NormalTok{(}\FunctionTok{add\_text}\NormalTok{())}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{resources-debugging}{%
\section{Further Resources}\label{resources-debugging}}

\begin{itemize}
\tightlist
\item
  \href{https://shiny.rstudio.com/articles/debugging.html}{Debugging Shiny applications}
\item
  \href{https://rstudio.github.io/reactlog/}{reactlog}
\item
  \href{https://shiny.rstudio.com/articles/validation.html}{Write error messages for your UI with validate}
\end{itemize}

\hypertarget{exercises-debugging}{%
\section{Exercises}\label{exercises-debugging}}

\hypertarget{required-selections}{%
\subsection{Required selections}\label{required-selections}}

Write an app that creates the plot below for any checked values of a {checkboxGroupInput}() that lists all the orders in \texttt{msleep}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# this input is just an example for testing the code below}
\NormalTok{input }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{orders =} \FunctionTok{c}\NormalTok{(}\StringTok{"Carnivora"}\NormalTok{, }\StringTok{"Chiroptera"}\NormalTok{, }\StringTok{"Primates"}\NormalTok{))}
\CommentTok{\# input \textless{}{-} list(orders = c()) \# check this to see what happens with no selections}

\NormalTok{filtered\_data }\OtherTok{\textless{}{-}}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(msleep, order }\SpecialCharTok{\%in\%}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{orders)}

\FunctionTok{ggplot}\NormalTok{(filtered\_data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ sleep\_total, }\AttributeTok{fill =}\NormalTok{ order)) }\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{binwidth =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{order)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=1\linewidth]{_main_files/figure-latex/unnamed-chunk-126-1} \end{center}

Add error checking to the app to deal with what happens when \texttt{input\$order} has no selections.

\hypertarget{your-app-debugging}{%
\section{Your App}\label{your-app-debugging}}

In the app you're developing, find anywhere that a user could enter invalid information or cause an error and add a way to handle this.

\hypertarget{contingency}{%
\chapter{Contingent Display}\label{contingency}}

\hypertarget{hide-and-show}{%
\section{Hide and Show}\label{hide-and-show}}

I frequently want to make some aspect of a shiny app contingent on the state of another aspect, such as only showing a text input of the value of a select input is ``other''. You can use the {hide}() and {show}() functions from shinyjs to accomplish this easily.

When you set up the UI, wrap any elements that should be hidden at the start in {hidden}().

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the ui}
\FunctionTok{box}\NormalTok{(}\AttributeTok{title =} \StringTok{"Questions"}\NormalTok{,}
    \AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{,}
    \FunctionTok{selectInput}\NormalTok{(}\StringTok{"first\_pet"}\NormalTok{, }\StringTok{"What was your first pet?"}\NormalTok{, }
                \FunctionTok{c}\NormalTok{(}\StringTok{""}\NormalTok{, }\StringTok{"dog"}\NormalTok{, }\StringTok{"cat"}\NormalTok{, }\StringTok{"ferret"}\NormalTok{, }\StringTok{"other"}\NormalTok{)),}
    \FunctionTok{hidden}\NormalTok{(}\FunctionTok{textInput}\NormalTok{(}\StringTok{"first\_pet\_other"}\NormalTok{, }\ConstantTok{NULL}\NormalTok{, }
                     \AttributeTok{placeholder =} \StringTok{"Specify the other pet"}\NormalTok{))}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Then set up the hide and show logic in {server}().

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# in the server}
\FunctionTok{observeEvent}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{first\_pet, \{}
    \ControlFlowTok{if}\NormalTok{ (input}\SpecialCharTok{$}\NormalTok{first\_pet }\SpecialCharTok{==} \StringTok{"other"}\NormalTok{) \{}
        \FunctionTok{show}\NormalTok{(}\StringTok{"first\_pet\_other"}\NormalTok{)}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
        \FunctionTok{hide}\NormalTok{(}\StringTok{"first\_pet\_other"}\NormalTok{)}
\NormalTok{    \}}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\hypertarget{groups}{%
\subsection{Groups}\label{groups}}

Sometimes you need to hide and show a group of elements, depending on something else. You can wrap the grouped elements in a div tag with an id and hide and show that id.

For example, it doesn't make sense to show the questions above to someone who has never had a pet. Add a {selectInput}() before the previous two questions, and then wrap those questions in {tags\$div}() with an id of {"first\_pet\_grp"}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# replace in ui}
\FunctionTok{box}\NormalTok{(}
  \AttributeTok{title =} \StringTok{"Questions"}\NormalTok{,}
  \AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{,}
  \FunctionTok{selectInput}\NormalTok{(}\StringTok{"had\_pet"}\NormalTok{, }\StringTok{"Have you ever had a pet?"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{""}\NormalTok{, }\StringTok{"Yes"}\NormalTok{, }\StringTok{"No"}\NormalTok{)),}
  \FunctionTok{hidden}\NormalTok{(tags}\SpecialCharTok{$}\FunctionTok{div}\NormalTok{(}
    \AttributeTok{id =} \StringTok{"first\_pet\_grp"}\NormalTok{,}
    \FunctionTok{selectInput}\NormalTok{(}\StringTok{"first\_pet"}\NormalTok{, }\StringTok{"What was your first pet?"}\NormalTok{,}
                \FunctionTok{c}\NormalTok{(}\StringTok{""}\NormalTok{, }\StringTok{"dog"}\NormalTok{, }\StringTok{"cat"}\NormalTok{, }\StringTok{"ferret"}\NormalTok{, }\StringTok{"other"}\NormalTok{)),}
    \FunctionTok{textInput}\NormalTok{(}\StringTok{"first\_pet\_other"}\NormalTok{, }\ConstantTok{NULL}\NormalTok{,}
              \AttributeTok{placeholder =} \StringTok{"Specify the other pet"}\NormalTok{)}
\NormalTok{  ))}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Then add the following code to the server function to hide or show \texttt{first\_pet\_grp} depending on the value of \texttt{had\_pet}. The server code above will take care of whether or not \texttt{first\_pet\_other} is visible.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# add to server}
\FunctionTok{observeEvent}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{had\_pet, \{}
  \ControlFlowTok{if}\NormalTok{ (input}\SpecialCharTok{$}\NormalTok{had\_pet }\SpecialCharTok{==} \StringTok{"Yes"}\NormalTok{) \{}
    \FunctionTok{show}\NormalTok{(}\StringTok{"first\_pet\_grp"}\NormalTok{)}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
    \FunctionTok{hide}\NormalTok{(}\StringTok{"first\_pet\_grp"}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

Try to figure out what could go wrong if you didn't wrap ``first\_pet'' and ``first\_pet\_other'' in a group, and instead just hid or showed ``first\_pet'' and ``first\_pet\_other'' depending on the value of \texttt{has\_pet}?

\hypertarget{toggle}{%
\subsection{Toggle}\label{toggle}}

Sometimes you need to change the visibility of an element when something happens, rather than specifically hide or show it. You can use {toggle}() to hide an element if it's visible and show it if it's hidden.

Add an {actionButton}() to the sidebar menu (not inside the box) and give the box an {id} of {"pet\_box"}. Any element that you might want to refer to in the code needs an {id}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# add to ui}
\FunctionTok{actionButton}\NormalTok{(}\StringTok{"toggle\_pet\_box"}\NormalTok{, }\StringTok{"Toggle Pet Questions"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Now, whenever you click the ``toggle\_pet\_box'' button, the contents of ``pet\_box'' will toggle their visibility.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# add to server}
\FunctionTok{observeEvent}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{toggle\_pet\_box, \{}
  \FunctionTok{toggle}\NormalTok{(}\StringTok{"pet\_box"}\NormalTok{)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

What would go wrong if you put the button inside the box?

\hypertarget{changing-styles}{%
\section{Changing Styles}\label{changing-styles}}

You can use {addClass}(), {removeClass}(), and {toggleClass}() to change element classes. You usually want to do this with classes you've defined yourself.

Add the following style to the www/custom.css file.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{.notice}\SpecialCharTok{{-}}\NormalTok{me \{}
\NormalTok{  color}\SpecialCharTok{:}\NormalTok{ red;}
\NormalTok{  text}\SpecialCharTok{{-}}\NormalTok{decoration}\SpecialCharTok{:}\NormalTok{ underline;}
\NormalTok{  font}\SpecialCharTok{{-}}\NormalTok{weight}\SpecialCharTok{:} \DecValTok{800}\NormalTok{;}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

And add this box to the ui:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{box}\NormalTok{(}\AttributeTok{title =} \StringTok{"Notice"}\NormalTok{, }\AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{,}
    \FunctionTok{p}\NormalTok{(}\AttributeTok{id =} \StringTok{"notice\_text"}\NormalTok{, }\StringTok{"Please pay attention to this text."}\NormalTok{),}
    \FunctionTok{actionButton}\NormalTok{(}\StringTok{"add\_notice"}\NormalTok{, }\StringTok{"Notice Me"}\NormalTok{),}
    \FunctionTok{actionButton}\NormalTok{(}\StringTok{"remove\_notice"}\NormalTok{, }\StringTok{"Ignore Me"}\NormalTok{),}
    \FunctionTok{actionButton}\NormalTok{(}\StringTok{"toggle\_notice"}\NormalTok{, }\StringTok{"Toggle Me"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

This code adds the class {"notice-me"} to the paragraph element {"notice\_text"} whenever the ``add\_notice'' button is pressed.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{observeEvent}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{add\_notice, \{}
  \FunctionTok{addClass}\NormalTok{(}\StringTok{"notice\_text"}\NormalTok{, }\StringTok{"notice{-}me"}\NormalTok{)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

Guess how you would use {removeClass}(), and {toggleClass}() with the buttons set up above.

\hypertarget{changing-non-shiny-elements}{%
\subsection{Changing non-shiny elements}\label{changing-non-shiny-elements}}

Unfortunately, not all elements on the web page have an ID that can be altered by {addClass}() or {removeClass}(). For example, the skin of a shinydashboard app is determined by the css class of the body element. However, we can use {runjs}() to run any arbitrary \protect\hyperlink{JavaScript}{JavaScript} code.

Add the following action button into the {sidebarMenu}().

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{actionButton}\NormalTok{(}\StringTok{"random\_skin"}\NormalTok{, }\StringTok{"Random Skin"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The jQuery code below changes the skin of your app on a button press by removing all possible skin-color classes and adding a random one.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{observeEvent}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{random\_skin, \{}
\NormalTok{  skins }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"red"}\NormalTok{, }\StringTok{"yellow"}\NormalTok{, }\StringTok{"green"}\NormalTok{, }\StringTok{"blue"}\NormalTok{, }\StringTok{"purple"}\NormalTok{, }\StringTok{"black"}\NormalTok{)}
\NormalTok{  skin\_color }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(skins, }\DecValTok{1}\NormalTok{)}
  
\NormalTok{  js }\OtherTok{\textless{}{-}} \FunctionTok{sprintf}\NormalTok{(}\StringTok{"$(\textquotesingle{}body\textquotesingle{}).removeClass(\textquotesingle{}\%s\textquotesingle{}).addClass(\textquotesingle{}skin{-}\%s\textquotesingle{});"}\NormalTok{,}
                \FunctionTok{paste}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"skin{-}"}\NormalTok{, skins), }\AttributeTok{collapse =} \StringTok{" "}\NormalTok{),}
\NormalTok{                skin\_color)}
  
\NormalTok{  shinyjs}\SpecialCharTok{::}\FunctionTok{runjs}\NormalTok{(js)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

Changing the skin color with a button press isn't something you'll easily find documented in online materials. I figured it out through looking at how the underlying html changed when I changed the skin color in the app code. Hacks like this require lots of trial and error, but get easier the more you understand about html, css and JavaScript.

\hypertarget{changing-input-options}{%
\section{Changing input options}\label{changing-input-options}}

The relevant options in a {selectInput}() or {radioButton}() may change depending on the values of other inputs. Sometimes you can accommodate this by creating multiple versions of a input and hiding or showing. Other times you may wish to update the input directly.

Add the following box to the ui.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{box}\NormalTok{(}\AttributeTok{title =} \StringTok{"Data"}\NormalTok{, }\AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{width =} \DecValTok{12}\NormalTok{,}
  \FunctionTok{selectInput}\NormalTok{(}\StringTok{"dataset"}\NormalTok{, }\StringTok{"Choose a dataset"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"mtcars"}\NormalTok{, }\StringTok{"sleep"}\NormalTok{)),}
  \FunctionTok{checkboxGroupInput}\NormalTok{(}\StringTok{"columns"}\NormalTok{, }\StringTok{"Select the columns to show"}\NormalTok{, }\AttributeTok{inline =} \ConstantTok{TRUE}\NormalTok{),}
  \FunctionTok{tableOutput}\NormalTok{(}\StringTok{"data\_table"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

First, set up the code to display the correct data in the table.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydata }\OtherTok{\textless{}{-}} \FunctionTok{reactive}\NormalTok{(\{}
  \FunctionTok{get}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{dataset, }\StringTok{"package:datasets"}\NormalTok{)}
\NormalTok{\})}

\NormalTok{output}\SpecialCharTok{$}\NormalTok{data\_table }\OtherTok{\textless{}{-}} \FunctionTok{renderTable}\NormalTok{(}\FunctionTok{mydata}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

Now we need to set the options for {"columns"} depending on which ``dataset'' is selected.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{observe}\NormalTok{(\{}
\NormalTok{  col\_names }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(}\FunctionTok{data}\NormalTok{())}
  \FunctionTok{debug\_msg}\NormalTok{(col\_names)}
  \FunctionTok{updateCheckboxGroupInput}\NormalTok{(}\AttributeTok{inputId =} \StringTok{"columns"}\NormalTok{,}
                           \AttributeTok{choices =}\NormalTok{ col\_names,}
                           \AttributeTok{selected =}\NormalTok{ col\_names)}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

Finally, we can add some code to select only the checked columns to display.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{observe}\NormalTok{(\{}
\NormalTok{  full\_data }\OtherTok{\textless{}{-}} \FunctionTok{get}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{dataset, }\StringTok{"package:datasets"}\NormalTok{)}
\NormalTok{  col\_names }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(full\_data)}
  \FunctionTok{updateCheckboxGroupInput}\NormalTok{(}
    \AttributeTok{inputId =} \StringTok{"columns"}\NormalTok{,}
    \AttributeTok{choices =}\NormalTok{ col\_names,}
    \AttributeTok{selected =}\NormalTok{ col\_names,}
    \AttributeTok{inline =} \ConstantTok{TRUE}
\NormalTok{  )}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

Why do we have to get the dataset again instead of using the data from {mydata}()?

Finally, alter the reactive function to only show the selected columns.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mydata }\OtherTok{\textless{}{-}} \FunctionTok{reactive}\NormalTok{(\{}
\NormalTok{  d }\OtherTok{\textless{}{-}} \FunctionTok{get}\NormalTok{(input}\SpecialCharTok{$}\NormalTok{dataset, }\StringTok{"package:datasets"}\NormalTok{)}
\NormalTok{  d[input}\SpecialCharTok{$}\NormalTok{columns]}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

What happens when you unselect all the columns? How can you fix this?

\hypertarget{exercises-contingency}{%
\section{Exercises}\label{exercises-contingency}}

\hypertarget{filtered-data}{%
\subsection{Filtered data}\label{filtered-data}}

Create an app where you use inputs to filter a dataset and display a table of the filtered dataset. For example, with the \texttt{msleep} dataset, you could have inputs that select \texttt{vore}, \texttt{order} and \texttt{conservation}. Since some values will exclude categories (e.g., there are no omnivores in the order Cetacea), update the available categories in each input when values are selected. Make sure you have a way to reset the values.

\hypertarget{your-app-contingency}{%
\section{Your App}\label{your-app-contingency}}

Check for places in your app that could use contingency.

\hypertarget{sharing}{%
\chapter{Sharing your Apps}\label{sharing}}

\hypertarget{shinyapps.io}{%
\section{shinyapps.io}\label{shinyapps.io}}

\includegraphics{images/saio_connect.png}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Open \textbf{\texttt{Tools\ \textgreater{}\ Global\ Options\ ...}}
\item
  Go to the \textbf{\texttt{Publishing}} tab
\item
  Click the \textbf{\texttt{Connect}} button and choose ShinyApps.io
\item
  Click on the link to \href{https://www.shinyapps.io/}{go to your account}
\item
  Click the \textbf{\texttt{Sign\ Up}} button and \textbf{\texttt{Sign\ up\ with\ GitHub}}
\item
  You should now be in your shinyapps.io dashboard; click on your name in the upper right and choose \textbf{\texttt{Tokens}}
\item
  Add a token
\item
  Click \textbf{\texttt{Show}} next to the token and copy the text to the clipboard
  \includegraphics{images/saio_secret.png}
\item
  Go back to RStudio and paste the text in the box and click \textbf{\texttt{Connect\ Account}}
\item
  Make sure the box next to ``Enable publishing\ldots{}'' is ticked, click \textbf{\texttt{Apply}}, and close the options window
  Ë™
  You can test this by creating a simple app. If you have the shinyintro package, use the code below.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{shinyintro}\SpecialCharTok{::}\FunctionTok{clone}\NormalTok{(}\StringTok{"input\_demo"}\NormalTok{, }\StringTok{"mytestapp"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{images/saio_publish.png}

Open the app.R file and go to \textbf{\texttt{File\ \textgreater{}\ Publish...}} in the menu (or click on the blue icon in the upper right corner of the source pane). Make sure these are the right files for your app, edit the title if you want, and click \textbf{\texttt{Publish}}. A web browser window will open after a few seconds showing your app online! You can now share it with your friends and colleagues.

If publishing fails, check the Console pane. If you already have too many apps on shinyapps.io, you'll see the message, ``You have reached the maximum number of applications allowed for your account.'' You can archive some of your apps from the shinyapps.io dashboard if this is the problem.

\hypertarget{self-hosting-a-shiny-server}{%
\section{Self-hosting a shiny server}\label{self-hosting-a-shiny-server}}

Setting up a shiny server is beyond the scope of this class, but if you have access to one, you can ask the administrator how to access the correct directories and upload your app directories there.

This solution is good if you want to save data locally and do not want to use Google Sheets. You can't save data locally on shinyapps.io.

If you save data locally on a shiny server, you may need to change the owner or permissions of the directory you save data in so that the web user can write to it. Ask the administrator of the server for help if this doesn't make any sense to you.

\hypertarget{github}{%
\section{GitHub}\label{github}}

GitHub is a great place to organise and share your code using version control. You can also use it to host Shiny app code for others to download and run on their own computer.

See \protect\hyperlink{setup-git}{Appendix B} for instructions on how to set up git and a GitHub account. Set up a github access token with {usethis::create\_github\_token}(). Your web browser will open and you'll be asked to log into your GitHub account and then asked to authorise a new token. Accept the defaults and click OK at the bottom of the page. In RStudio, run {gitcreds::gitcreds\_set}() and follow the instructions to save the token.

Then, to share an app with people who use R, make a project that contains your app.R file and any related files. If you aren't already using version control for this project, make sure all of your files are saved and type {usethis::use\_git}() into the console. Choose Yes to commit and Yes to restart R.

Make a new GitHub repository with {usethis::use\_github}(protocol=``https''); check that the suggested title and description are OK. If you choose the affirmative response (not always the same number), you'll see some messages and your web browser will open the github repository page.

Now you can share your app with others by sending them the repository link. They can access your repository in RStudio by starting a \textbf{\texttt{New\ Project...}} from version control, using the URL that is shown when you click on the green \textbf{\texttt{Code}} button on the repository page (something like ``\url{https://github.com/account/repository.git}''). They can run your app the same way you do when developing it, by opening the app.R file and clicking the Run button.

To update your files on GitHub, you need to commit any changes you make using the Git tab in the upper right pane. Click on the checkbox of any files you want to update, click \textbf{\texttt{Commit}}, and write a message to yourself explaining the changes (this will be publicly viewable on GitHub, so try to be professional, but you can use emojis ðŸ˜±ðŸ¤ªðŸ˜).

Committing just creates a snapshot of the files on your computer so you can look at previous versions. To update the files on GitHub, you need to push the updates using the green up arrow button.

Git and GitHub can be tricky. \href{https://happygitwithr.com/}{Happy Git with R} by Jenny Bryan is a fantastic in-depth book anbout how to work with git in R and RStudio.

\hypertarget{in-an-r-package}{%
\section{In an R package}\label{in-an-r-package}}

You can put your app in a custom R package to make it even easier for people to run the app. The usethis package is incredibly helpful for setting up packages.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mypackagename }\OtherTok{\textless{}{-}} \StringTok{"mypackagename"} \CommentTok{\# change this}
\NormalTok{usethis}\SpecialCharTok{::}\FunctionTok{create\_package}\NormalTok{(mypackagename)}
\NormalTok{usethis}\SpecialCharTok{::}\FunctionTok{use\_ccby\_license}\NormalTok{()}

\CommentTok{\# add packages your app uses}
\NormalTok{usethis}\SpecialCharTok{::}\FunctionTok{use\_package}\NormalTok{(}\StringTok{"shiny"}\NormalTok{)}
\NormalTok{usethis}\SpecialCharTok{::}\FunctionTok{use\_package}\NormalTok{(}\StringTok{"shinydashboard"}\NormalTok{)}

\CommentTok{\# add the directory for your apps}
\FunctionTok{dir.create}\NormalTok{(}\StringTok{"inst"}\NormalTok{)}
\FunctionTok{dir.create}\NormalTok{(}\StringTok{"inst/apps"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Copy any apps you want to include in this package into the inst/apps directory.

Now, create the app function by running \texttt{usethis::edit\_file("R/app.R")} and copy the following text into the app.R file that just opened. Replace {"default\_app"} with the directory name of the app that you want to open if a user doesn't type any name in at all.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\textquotesingle{} Launch Shiny App}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @param name The name of the app to run}
\CommentTok{\#\textquotesingle{} @param ... arguments to pass to shiny::runApp}
\CommentTok{\#\textquotesingle{}}
\CommentTok{\#\textquotesingle{} @export}
\CommentTok{\#\textquotesingle{}}
\NormalTok{app }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{name =} \StringTok{"default\_app"}\NormalTok{, ...) \{}
\NormalTok{  appDir }\OtherTok{\textless{}{-}} \FunctionTok{system.file}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"apps/"}\NormalTok{, name), }\AttributeTok{package =} \StringTok{"mypackagename"}\NormalTok{)}
  \ControlFlowTok{if}\NormalTok{ (appDir }\SpecialCharTok{==} \StringTok{""}\NormalTok{) }\FunctionTok{stop}\NormalTok{(}\StringTok{"The shiny app "}\NormalTok{, name, }\StringTok{" does not exist"}\NormalTok{)}
\NormalTok{  shiny}\SpecialCharTok{::}\FunctionTok{runApp}\NormalTok{(appDir, ...)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Next, open the DESCRIPTION file and edit the title, author and description. Now run the following code in the console.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{document}\NormalTok{()}
\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{install}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

This will create the help documentation for your package function and install the package on your computer. You should now be able to run your app with {mypackagename::app}().

Set up git and save your package to GitHub to share it with others:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{usethis}\SpecialCharTok{::}\FunctionTok{use\_git}\NormalTok{()}
\NormalTok{usethis}\SpecialCharTok{::}\FunctionTok{use\_github}\NormalTok{(}\AttributeTok{protocol=}\StringTok{"https"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Once it's uploaded to GitHub, other people can install it with the following code:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"myaccountname/mypackagename"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{exercises-sharing}{%
\section{Exercises}\label{exercises-sharing}}

\hypertarget{shinyapps.io-1}{%
\subsection{Shinyapps.io}\label{shinyapps.io-1}}

\begin{itemize}
\tightlist
\item
  Upload a cloned demo app to shinyapps.io
\item
  Check that you can access it online
\item
  Archive the app in the shinyapps.io dashboard
\end{itemize}

\hypertarget{github-1}{%
\subsection{GitHub}\label{github-1}}

\begin{itemize}
\tightlist
\item
  Set up a GitHub account
\item
  Create a New Project in RStudio from version control using \url{https://github.com/debruine/demoapp}
\item
  Create a project that contains a demo app and upload it to GitHub.
\end{itemize}

\hypertarget{r-package}{%
\subsection{R Package}\label{r-package}}

\begin{itemize}
\tightlist
\item
  Create an R package for a demo app and upload it to GitHub.
\end{itemize}

\hypertarget{your-app-sharing}{%
\section{Your App}\label{your-app-sharing}}

How will users need to access your app? Will they be R users who can download it and run it on their own computers? Or will you need to find a host online? Choose and implement a sharing method for your custom app. Send a friend (or your instructor) directions to access and run it.

\hypertarget{reports}{%
\chapter{Customized reports}\label{reports}}

While the best part of Shiny apps is their interactivity, sometimes your users need to download data, images, or a static report. This section will show you how.

\hypertarget{download-data}{%
\section{Download Data}\label{download-data}}

First, we need to add the appropriate UI to our questionnaire app. Create a new tab called {"report\_tab"} with two {downloadButton}()s, one for the pets data and one for the food data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{report\_tab }\OtherTok{\textless{}{-}} \FunctionTok{tabItem}\NormalTok{(}
  \AttributeTok{tabName =} \StringTok{"report\_tab"}\NormalTok{,}
  \FunctionTok{box}\NormalTok{(}
    \AttributeTok{id =} \StringTok{"download\_box"}\NormalTok{,}
    \AttributeTok{title =} \StringTok{"Downloads"}\NormalTok{,}
    \AttributeTok{solidHeader =} \ConstantTok{TRUE}\NormalTok{,}
    \FunctionTok{downloadButton}\NormalTok{(}\StringTok{"pet\_data\_dl"}\NormalTok{, }\StringTok{"Pets Data"}\NormalTok{),}
    \FunctionTok{downloadButton}\NormalTok{(}\StringTok{"food\_data\_dl"}\NormalTok{, }\StringTok{"Food Data"}\NormalTok{)}
\NormalTok{  )}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Remember to add this to {tabItems}() in {dashboardBody}() and also add a corresponding {menuItem}() in {sidebarMenu}(). Run the app to make sure the UI looks like you expect before you proceed.

Now we need to add code to {server}() to handle the downloads. {downloadButton}() is a special type of output that is handled by {downloadHandler}(). This function takes two arguments, a function to create the {filename} and a function to create the {content}.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\# pet\_data\_dl {-}{-}{-}{-}}
\NormalTok{output}\SpecialCharTok{$}\NormalTok{pet\_data\_dl }\OtherTok{\textless{}{-}} \FunctionTok{downloadHandler}\NormalTok{(}
  \AttributeTok{filename =} \ControlFlowTok{function}\NormalTok{() \{}
    \FunctionTok{debug\_msg}\NormalTok{(}\StringTok{"pet\_data\_dl"}\NormalTok{)}
    \FunctionTok{paste0}\NormalTok{(}\StringTok{"pet{-}data\_"}\NormalTok{, }\FunctionTok{Sys.Date}\NormalTok{(), }\StringTok{".csv"}\NormalTok{)}
\NormalTok{  \},}
  \AttributeTok{content =} \ControlFlowTok{function}\NormalTok{(file) \{}
    \FunctionTok{gs4\_write\_csv}\NormalTok{(v}\SpecialCharTok{$}\NormalTok{pet\_summary\_data, file)}
\NormalTok{  \}}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Instead of {write.csv}() or {readr::write\_csv}(), here we're using {gs4\_write\_csv}() (defined in scripts/gs4.R) because googlesheets can return list columns that cause errors when \protect\hyperlink{gs4_save}{saving to CSV} without some preprocessing.

\hypertarget{download-images}{%
\section{Download Images}\label{download-images}}

Now that we need to use the summary plot in more than one place, it doesn't make sense to build it twice. Move all of the code from the {renderPlot}() for \texttt{output\$pet\_summary} into a {reactive}() called \texttt{pet\_summary\_plot}. Then we can build the plot whenever the inputs change and refer to it anywhere as {pet\_summary\_plot}().

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\# pet\_summary\_plot {-}{-}{-}{-}}
\NormalTok{pet\_summary\_plot }\OtherTok{\textless{}{-}} \FunctionTok{reactive}\NormalTok{(\{ }\FunctionTok{debug\_msg}\NormalTok{(}\StringTok{"pet\_summary\_plot"}\NormalTok{)}
  \CommentTok{\# code from output$pet\_summary ...}
\NormalTok{\})}

\DocumentationTok{\#\#\# pet\_summary {-}{-}{-}{-}}
\NormalTok{output}\SpecialCharTok{$}\NormalTok{pet\_summary }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{ }\FunctionTok{debug\_msg}\NormalTok{(}\StringTok{"pet\_summary"}\NormalTok{)}
    \FunctionTok{pet\_summary\_plot}\NormalTok{()}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

The {downloadHandler}() works the same as for downloading a CSV file. You can use {ggsave}() to write the plot.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# pet\_plot\_dl {-}{-}{-}{-}}
\NormalTok{output}\SpecialCharTok{$}\NormalTok{pet\_plot\_dl }\OtherTok{\textless{}{-}} \FunctionTok{downloadHandler}\NormalTok{(}
  \AttributeTok{filename =} \ControlFlowTok{function}\NormalTok{() \{}
    \FunctionTok{paste0}\NormalTok{(}\StringTok{"pet{-}plot\_"}\NormalTok{, }\FunctionTok{Sys.Date}\NormalTok{(), }\StringTok{".png"}\NormalTok{)}
\NormalTok{  \},}
  \AttributeTok{content =} \ControlFlowTok{function}\NormalTok{(file) \{}
    \FunctionTok{ggsave}\NormalTok{(file,}
           \FunctionTok{pet\_summary\_plot}\NormalTok{(),}
           \AttributeTok{width =} \DecValTok{7}\NormalTok{,}
           \AttributeTok{height =} \DecValTok{5}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Add numeric inputs to the UI to let the user specify the downloaded plot {width} and {height}.

Solution

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# add to report\_tab ui}
\FunctionTok{numericInput}\NormalTok{(}\StringTok{"plot\_width"}\NormalTok{, }\StringTok{"Plot Width (inches)"}\NormalTok{, }\DecValTok{7}\NormalTok{, }\AttributeTok{min =} \DecValTok{1}\NormalTok{, }\AttributeTok{max =} \DecValTok{10}\NormalTok{)}
\FunctionTok{numericInput}\NormalTok{(}\StringTok{"plot\_height"}\NormalTok{, }\StringTok{"Plot Height (inches)"}\NormalTok{, }\DecValTok{5}\NormalTok{, }\AttributeTok{min =} \DecValTok{1}\NormalTok{, }\AttributeTok{max =} \DecValTok{10}\NormalTok{)}

\DocumentationTok{\#\#\# pet\_plot\_dl {-}{-}{-}{-}}
\NormalTok{output}\SpecialCharTok{$}\NormalTok{pet\_plot\_dl }\OtherTok{\textless{}{-}} \FunctionTok{downloadHandler}\NormalTok{(}
  \AttributeTok{filename =} \ControlFlowTok{function}\NormalTok{() \{}
    \FunctionTok{debug\_msg}\NormalTok{(}\StringTok{"pet\_plot\_dl"}\NormalTok{)}
    \FunctionTok{paste0}\NormalTok{(}\StringTok{"pet{-}plot\_"}\NormalTok{, }\FunctionTok{Sys.Date}\NormalTok{(), }\StringTok{".png"}\NormalTok{)}
\NormalTok{  \},}
  \AttributeTok{content =} \ControlFlowTok{function}\NormalTok{(file) \{}
    \FunctionTok{ggsave}\NormalTok{(}
\NormalTok{      file,}
      \FunctionTok{pet\_summary\_plot}\NormalTok{(),}
      \AttributeTok{width =}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{plot\_width,}
      \AttributeTok{height =}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{plot\_height}
\NormalTok{    )}
\NormalTok{  \}}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{r-markdown}{%
\section{R Markdown}\label{r-markdown}}

You can render an R Markdown report for users to download.

First, you need to save an R Markdown file (save the one below as reports/report.Rmd). You need to set up \texttt{params} for any info that you want to pass from the Shiny app in th YAML header. Here, we will dynamically update the title, data, and plot. You can set the values to \texttt{NULL} or another default value.

\begin{Shaded}
\begin{Highlighting}[]
\PreprocessorTok{{-}{-}{-}}
\FunctionTok{title}\KeywordTok{:}\AttributeTok{ }\StringTok{"\textasciigrave{}r params$title\textasciigrave{}"}
\FunctionTok{date}\KeywordTok{:}\AttributeTok{ }\StringTok{"\textasciigrave{}r format(Sys.time(), \textquotesingle{}\%d \%B, \%Y\textquotesingle{})\textasciigrave{}"}\AttributeTok{ }
\FunctionTok{output}\KeywordTok{:}\AttributeTok{ html\_document}
\FunctionTok{params}\KeywordTok{:}
\AttributeTok{  }\FunctionTok{title}\KeywordTok{:}\AttributeTok{ Report}
\AttributeTok{  }\FunctionTok{data}\KeywordTok{:}\AttributeTok{ }\CharTok{NULL}
\AttributeTok{  }\FunctionTok{plot}\KeywordTok{:}\AttributeTok{ }\CharTok{NULL}
\PreprocessorTok{{-}{-}{-}}
\end{Highlighting}
\end{Shaded}

Then you can refer to these params in the R Markdown file as \texttt{params\$name}. If you knit the report, these will take on the default values.

\begin{verbatim}


```r
n_responses <- nrow(params$data)

n_sessions <- params$data$session_id %>%
  unique() %>%
  length()
```

We asked people to rate how much they like pets. We have obtained `r n_responses` responses from `r n_sessions` unique sessions.

## Summary Plot


```r
params$plot
```
\end{verbatim}

The \texttt{content} function uses {rmarkdown::render}() to create the output file from Rmd. We are using \texttt{html\_document} as the output type, but you can also render as a PDF or Word document if you have pandoc or latex installed. Include the {title}, {data} and {plot} as a named list to the {params} argument.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\# pet\_report\_dl {-}{-}{-}{-}}
\NormalTok{output}\SpecialCharTok{$}\NormalTok{pet\_report\_dl }\OtherTok{\textless{}{-}} \FunctionTok{downloadHandler}\NormalTok{(}
  \AttributeTok{filename =} \ControlFlowTok{function}\NormalTok{() \{}
    \FunctionTok{debug\_msg}\NormalTok{(}\StringTok{"pet\_report\_dl"}\NormalTok{)}
    \FunctionTok{paste0}\NormalTok{(}\StringTok{"pet{-}report\_"}\NormalTok{, }\FunctionTok{Sys.Date}\NormalTok{(), }\StringTok{".html"}\NormalTok{)}
\NormalTok{  \},}
  \AttributeTok{content =} \ControlFlowTok{function}\NormalTok{(file) \{}
\NormalTok{    rmarkdown}\SpecialCharTok{::}\FunctionTok{render}\NormalTok{(}\StringTok{"reports/report.Rmd"}\NormalTok{,}
                      \AttributeTok{output\_file =}\NormalTok{ file, }
                      \AttributeTok{params =} \FunctionTok{list}\NormalTok{(}
                        \AttributeTok{title =} \StringTok{"Pet Report"}\NormalTok{, }
                        \AttributeTok{data =}\NormalTok{ v}\SpecialCharTok{$}\NormalTok{pet\_summary\_data,}
                        \AttributeTok{plot =} \FunctionTok{pet\_summary\_plot}\NormalTok{()}
\NormalTok{                      ),}
                      \AttributeTok{envir =} \FunctionTok{new.env}\NormalTok{(),}
                      \AttributeTok{intermediates\_dir =} \FunctionTok{tempdir}\NormalTok{())}
\NormalTok{  \}}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Setting the {envir} argument to {new.env}() makes sure that settings in your Shiny app, such as a default ggplot theme, can't affect the rendered file, but also makes it so that the R Markdown code will not have access to any objects from your app, such as \texttt{input} or \texttt{v\$summary\_data}, unless you pass them as parameters.

On your own computer, you don't need to set \texttt{intermediates\_dir\ =\ tempdir()}, but you will need to do this if you want to deploy your app on a shiny server. When rmarkdown renders an Rmd file, it creates several intermediate files in the working directory and then deletes them. you have permission to write to the app's working directory on your own computer, but might not on a shiny server. {tempdir}() is almost always a safe place to write temporary files to.

\hypertarget{exercises-reports}{%
\section{Exercises}\label{exercises-reports}}

\hypertarget{food-data}{%
\subsection{Food Data}\label{food-data}}

Create a button that downloads the food data.

Solution

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# add to report\_tab ui {-}{-}{-}{-}}
\FunctionTok{downloadButton}\NormalTok{(}\StringTok{"food\_data\_dl"}\NormalTok{, }\StringTok{"Food Data"}\NormalTok{)}

\DocumentationTok{\#\#\# food\_data\_dl {-}{-}{-}{-}}
\NormalTok{output}\SpecialCharTok{$}\NormalTok{food\_data\_dl }\OtherTok{\textless{}{-}} \FunctionTok{downloadHandler}\NormalTok{(}
  \AttributeTok{filename =} \ControlFlowTok{function}\NormalTok{() \{}
    \FunctionTok{debug\_msg}\NormalTok{(}\StringTok{"food\_data\_dl"}\NormalTok{)}
    \FunctionTok{paste0}\NormalTok{(}\StringTok{"food{-}data\_"}\NormalTok{, }\FunctionTok{Sys.Date}\NormalTok{(), }\StringTok{".csv"}\NormalTok{)}
\NormalTok{  \},}
  \AttributeTok{content =} \ControlFlowTok{function}\NormalTok{(file) \{}
    \FunctionTok{gs4\_write\_csv}\NormalTok{(v}\SpecialCharTok{$}\NormalTok{food\_summary\_data, file)}
\NormalTok{  \}}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{food-image}{%
\subsection{Food Image}\label{food-image}}

Create a button that downloads the food summary plot

Solution

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# add to report\_tab ui {-}{-}{-}{-}}
\FunctionTok{downloadButton}\NormalTok{(}\StringTok{"food\_plot\_dl"}\NormalTok{, }\StringTok{"Food Plot"}\NormalTok{)}

\DocumentationTok{\#\#\# food\_summary\_plot {-}{-}{-}{-}}
\NormalTok{food\_summary\_plot }\OtherTok{\textless{}{-}} \FunctionTok{reactive}\NormalTok{(\{ }\FunctionTok{debug\_msg}\NormalTok{(}\StringTok{"food\_summary\_plot"}\NormalTok{)}
  \CommentTok{\# code from output$food\_summary ...}
\NormalTok{\})}

\DocumentationTok{\#\#\# food\_summary {-}{-}{-}{-}}
\NormalTok{output}\SpecialCharTok{$}\NormalTok{food\_summary }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{ }\FunctionTok{debug\_msg}\NormalTok{(}\StringTok{"food\_summary"}\NormalTok{)}
  \FunctionTok{food\_summary\_plot}\NormalTok{()}
\NormalTok{\})}

\DocumentationTok{\#\#\# food\_plot\_dl {-}{-}{-}{-}}
\NormalTok{output}\SpecialCharTok{$}\NormalTok{food\_plot\_dl }\OtherTok{\textless{}{-}} \FunctionTok{downloadHandler}\NormalTok{(}
  \AttributeTok{filename =} \ControlFlowTok{function}\NormalTok{() \{}
    \FunctionTok{debug\_msg}\NormalTok{(}\StringTok{"food\_plot\_dl"}\NormalTok{)}
    \FunctionTok{paste0}\NormalTok{(}\StringTok{"food{-}plot\_"}\NormalTok{, }\FunctionTok{Sys.Date}\NormalTok{(), }\StringTok{".png"}\NormalTok{)}
\NormalTok{  \},}
  \AttributeTok{content =} \ControlFlowTok{function}\NormalTok{(file) \{}
    \FunctionTok{ggsave}\NormalTok{(}
\NormalTok{      file,}
      \FunctionTok{food\_summary\_plot}\NormalTok{(),}
      \AttributeTok{width =}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{plot\_width,}
      \AttributeTok{height =}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{plot\_height}
\NormalTok{    )}
\NormalTok{  \}}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{food-report}{%
\subsection{Food Report}\label{food-report}}

Create a downloadable report for the food data.

Solution

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# add to report\_tab ui {-}{-}{-}{-}}
\FunctionTok{downloadButton}\NormalTok{(}\StringTok{"food\_report\_dl"}\NormalTok{, }\StringTok{"Food Report"}\NormalTok{)}

\DocumentationTok{\#\#\# food\_report\_dl {-}{-}{-}{-}}
\NormalTok{output}\SpecialCharTok{$}\NormalTok{food\_report\_dl }\OtherTok{\textless{}{-}} \FunctionTok{downloadHandler}\NormalTok{(}
  \AttributeTok{filename =} \ControlFlowTok{function}\NormalTok{() \{}
    \FunctionTok{debug\_msg}\NormalTok{(}\StringTok{"food\_report\_dl"}\NormalTok{)}
    \FunctionTok{paste0}\NormalTok{(}\StringTok{"food{-}report\_"}\NormalTok{, }\FunctionTok{Sys.Date}\NormalTok{(), }\StringTok{".html"}\NormalTok{)}
\NormalTok{  \},}
  \AttributeTok{content =} \ControlFlowTok{function}\NormalTok{(file) \{}
\NormalTok{    rmarkdown}\SpecialCharTok{::}\FunctionTok{render}\NormalTok{(}\StringTok{"reports/report.Rmd"}\NormalTok{,}
                      \AttributeTok{output\_file =}\NormalTok{ file, }
                      \AttributeTok{params =} \FunctionTok{list}\NormalTok{(}
                        \AttributeTok{title =} \StringTok{"Food Report"}\NormalTok{, }
                        \AttributeTok{data =}\NormalTok{ v}\SpecialCharTok{$}\NormalTok{food\_summary\_data,}
                        \AttributeTok{plot =} \FunctionTok{food\_summary\_plot}\NormalTok{()}
\NormalTok{                      ),}
                      \AttributeTok{envir =} \FunctionTok{new.env}\NormalTok{(),}
                      \AttributeTok{intermediates\_dir =} \FunctionTok{tempdir}\NormalTok{())}
\NormalTok{  \}}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{your-app-reports}{%
\section{Your app}\label{your-app-reports}}

What might users want to download from your app? Include data, image, or report download if that is applicable to your app.

\hypertarget{modules}{%
\chapter{Shiny modules for repeated structures}\label{modules}}

If you find yourself making nearly identical UIs or server functions over and over in the same app, you might benefit from modules. This is a way to define a pattern to use repeatedly.

\hypertarget{modularizing-the-ui}{%
\section{Modularizing the UI}\label{modularizing-the-ui}}

The two tabPanels below follow nearly identical patterns. You can often identify a place where modules might be useful when you use a naming convention like "\{base\}\_\{type\}" for the {id}s.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris\_tab }\OtherTok{\textless{}{-}} \FunctionTok{tabPanel}\NormalTok{(}
  \StringTok{"iris"}\NormalTok{,}
  \FunctionTok{selectInput}\NormalTok{(}\StringTok{"iris\_dv"}\NormalTok{, }\StringTok{"DV"}\NormalTok{, }\AttributeTok{choices =} \FunctionTok{names}\NormalTok{(iris)[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{]),}
  \FunctionTok{plotOutput}\NormalTok{(}\StringTok{"iris\_plot"}\NormalTok{),}
\NormalTok{  DT}\SpecialCharTok{::}\FunctionTok{dataTableOutput}\NormalTok{(}\StringTok{"iris\_table"}\NormalTok{)}
\NormalTok{)}

\NormalTok{mtcars\_tab }\OtherTok{\textless{}{-}} \FunctionTok{tabPanel}\NormalTok{(}
  \StringTok{"mtcars"}\NormalTok{,}
  \FunctionTok{selectInput}\NormalTok{(}\StringTok{"mtcars\_dv"}\NormalTok{, }\StringTok{"DV"}\NormalTok{, }\AttributeTok{choices =} \FunctionTok{c}\NormalTok{(}\StringTok{"mpg"}\NormalTok{, }\StringTok{"disp"}\NormalTok{, }\StringTok{"hp"}\NormalTok{, }\StringTok{"drat"}\NormalTok{)),}
  \FunctionTok{plotOutput}\NormalTok{(}\StringTok{"mtcars\_plot"}\NormalTok{),}
\NormalTok{  DT}\SpecialCharTok{::}\FunctionTok{dataTableOutput}\NormalTok{(}\StringTok{"mtcars\_table"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The first step in modularising your code is to make a function that creates the UIs above from the base ID and any other changing aspects. In the example above, the choices are different for each {selectInput}(), so we'll make a function that has the arguments {id} and {choices}.

The first line of a UI module function is always \texttt{ns\ \textless{}-\ NS(id)}, which creates a shorthand way to add the base id to the id type. So instead of the {selectInput}()'s name being {"iris\_dv"} or {"mtcars\_dv"}, we set it as {ns}(dv). All ids need to use {ns}() to add the namespace to their ID.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tabPanelUI }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(id, choices) \{}
\NormalTok{    ns }\OtherTok{\textless{}{-}} \FunctionTok{NS}\NormalTok{(id)}
    
    \FunctionTok{tabPanel}\NormalTok{(}
\NormalTok{        id,}
        \FunctionTok{selectInput}\NormalTok{(}\FunctionTok{ns}\NormalTok{(}\StringTok{"dv"}\NormalTok{), }\StringTok{"DV"}\NormalTok{, }\AttributeTok{choices =}\NormalTok{ choices),}
        \FunctionTok{plotOutput}\NormalTok{(}\FunctionTok{ns}\NormalTok{(}\StringTok{"plot"}\NormalTok{)),}
\NormalTok{        DT}\SpecialCharTok{::}\FunctionTok{dataTableOutput}\NormalTok{(}\FunctionTok{ns}\NormalTok{(}\StringTok{"table"}\NormalTok{))}
\NormalTok{    )}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Now, you can replace two tabPanel definitions with just the following code.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{iris\_tab }\OtherTok{\textless{}{-}} \FunctionTok{tabPanelUI}\NormalTok{(}\StringTok{"iris"}\NormalTok{, }\FunctionTok{names}\NormalTok{(iris)[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{])}
\NormalTok{mtcars\_tab }\OtherTok{\textless{}{-}} \FunctionTok{tabPanelUI}\NormalTok{(}\StringTok{"mtcars"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"mpg"}\NormalTok{, }\StringTok{"disp"}\NormalTok{, }\StringTok{"hp"}\NormalTok{, }\StringTok{"drat"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{modularizing-server-functions}{%
\section{Modularizing server functions}\label{modularizing-server-functions}}

In our original code, we have four functions that create the two output tables and two output plots, but these are also largely redundant.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{output}\SpecialCharTok{$}\NormalTok{iris\_table }\OtherTok{\textless{}{-}}\NormalTok{ DT}\SpecialCharTok{::}\FunctionTok{renderDataTable}\NormalTok{(\{}
\NormalTok{    iris}
\NormalTok{\})}

\NormalTok{output}\SpecialCharTok{$}\NormalTok{iris\_plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
    \FunctionTok{ggplot}\NormalTok{(iris, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ Species, }
                     \AttributeTok{y =}\NormalTok{ .data[[input}\SpecialCharTok{$}\NormalTok{iris\_dv]],}
                     \AttributeTok{fill =}\NormalTok{ Species)) }\SpecialCharTok{+}
        \FunctionTok{geom\_violin}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
        \FunctionTok{scale\_fill\_viridis\_d}\NormalTok{()}
\NormalTok{\})}

\NormalTok{output}\SpecialCharTok{$}\NormalTok{mtcars\_table }\OtherTok{\textless{}{-}}\NormalTok{ DT}\SpecialCharTok{::}\FunctionTok{renderDataTable}\NormalTok{(\{}
\NormalTok{    mtcars}
\NormalTok{\})}

\NormalTok{output}\SpecialCharTok{$}\NormalTok{mtcars\_plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
    \CommentTok{\# handle non{-}string grouping}
\NormalTok{    mtcars}\SpecialCharTok{$}\NormalTok{vs }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(mtcars}\SpecialCharTok{$}\NormalTok{vs)}
    \FunctionTok{ggplot}\NormalTok{(mtcars, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ vs, }
                     \AttributeTok{y =}\NormalTok{ .data[[input}\SpecialCharTok{$}\NormalTok{mtcars\_dv]],}
                     \AttributeTok{fill =}\NormalTok{ vs)) }\SpecialCharTok{+}
        \FunctionTok{geom\_violin}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
        \FunctionTok{scale\_fill\_viridis\_d}\NormalTok{()}
\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

The second step to modularising code is creating a server function. You can put all the functions the relate to the inputs and outputs in the UI function here, so we will include one to make the output table and one to make the output plot.

The server function takes the base id as the first argument, and then any arguments you need to specify things that change between base implementations. Above, the tables show different data and the plots use different groupings for the x axis and fill, so we'll add arguments for {data} and {group\_by}.

A server function \textbf{always} contains \texttt{moduleServer()} set up like below.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tabPanelServer }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(id, data, group\_by) \{}
    \FunctionTok{moduleServer}\NormalTok{(id, }\ControlFlowTok{function}\NormalTok{(input, output, session) \{}
      \CommentTok{\# code ...}
\NormalTok{    \})}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

No you can copy in one set of server functions above, remove the base name (e.g., ``iris\_'' or ``mtcars\_'') from and inputs or outputs, and replace specific instances of the data or grouping columns with \texttt{data} and \texttt{group\_by}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tabPanelServer }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(id, data, group\_by) \{}
    \FunctionTok{moduleServer}\NormalTok{(id, }\ControlFlowTok{function}\NormalTok{(input, output, session) \{}
\NormalTok{        output}\SpecialCharTok{$}\NormalTok{table }\OtherTok{\textless{}{-}}\NormalTok{ DT}\SpecialCharTok{::}\FunctionTok{renderDataTable}\NormalTok{(\{}
\NormalTok{            data}
\NormalTok{        \})}
        
\NormalTok{        output}\SpecialCharTok{$}\NormalTok{plot }\OtherTok{\textless{}{-}} \FunctionTok{renderPlot}\NormalTok{(\{}
            \CommentTok{\# handle non{-}string groupings}
\NormalTok{            data[[group\_by]] }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(data[[group\_by]])}
            \FunctionTok{ggplot}\NormalTok{(data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ .data[[group\_by]], }
                             \AttributeTok{y =}\NormalTok{ .data[[input}\SpecialCharTok{$}\NormalTok{dv]],}
                             \AttributeTok{fill =}\NormalTok{ .data[[group\_by]])) }\SpecialCharTok{+}
                \FunctionTok{geom\_violin}\NormalTok{(}\AttributeTok{alpha =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
                \FunctionTok{scale\_fill\_viridis\_d}\NormalTok{()}
\NormalTok{        \})}
\NormalTok{    \})}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

In the original code, the grouping variables were unquoted, but it's tricky to pass unquoted variable names to custom functions, and we already know how to refer to columns by a character object using \texttt{.data{[}{[}char\_obj{]}{]}}.

The grouping column \texttt{Species} in \texttt{iris} is already a factor, but recasting it as a factor won't hurt, and is required for the \texttt{mtcars} grouping column \texttt{vs}.

Now, you can replace the four functions inside the server function with these two lines of code.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tabPanelServer}\NormalTok{(}\StringTok{"iris"}\NormalTok{, }\AttributeTok{data =}\NormalTok{ iris, }\AttributeTok{group\_by =} \StringTok{"Species"}\NormalTok{)}
\FunctionTok{tabPanelServer}\NormalTok{(}\StringTok{"mtcars"}\NormalTok{, }\AttributeTok{data =}\NormalTok{ mtcars, }\AttributeTok{group\_by =} \StringTok{"vs"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Our example only reduced our code by 4 lines, but it can save a lot of time, effort, and debugging on projects with many similar modules. For example, if you want to change the plots in your app to use a different geom, now you only have to change one function instead of two.

\hypertarget{exercises-modules}{%
\section{Exercises}\label{exercises-modules}}

\hypertarget{repeat-example}{%
\subsection{Repeat Example}\label{repeat-example}}

Try to implement the code above on your own.

\begin{itemize}
\tightlist
\item
  Clone ``no\_modules\_demo'' \texttt{shinyintro::clone("no\_modules\_demo")}
\item
  Run the app and see how it works
\item
  Create the UI module function and use it to replace \texttt{iris\_tab} and \texttt{mtcars\_tab}
\item
  Create the server function and use it to replace the server functions
\end{itemize}

\hypertarget{new-instance}{%
\subsection{New Instance}\label{new-instance}}

Add a new tab called ``diamonds'' that visualises the \texttt{diamonds} dataset. Choose the columns you want as choices in the {selectInput}() and the grouping column.

UI Solution

You can choose any of the numeric columns for the choices.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{diamonds\_tab }\OtherTok{\textless{}{-}} \FunctionTok{tabPanelUI}\NormalTok{(}\StringTok{"diamonds"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\StringTok{"carat"}\NormalTok{, }\StringTok{"depth"}\NormalTok{, }\StringTok{"table"}\NormalTok{, }\StringTok{"price"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Server Solution

You can group by any of the categorical columns: cut, color, or clarity.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tabPanelServer}\NormalTok{(}\StringTok{"diamonds"}\NormalTok{, }\AttributeTok{data =}\NormalTok{ diamonds, }\AttributeTok{group\_by =} \StringTok{"cut"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{altering-modules}{%
\subsection{Altering modules}\label{altering-modules}}

\begin{itemize}
\tightlist
\item
  Add another {selectInput}() to the UI that allows the user to select the grouping variable. (\texttt{iris} only has one possibility, but \texttt{mtcars} and \texttt{diamonds} should have several)
\end{itemize}

UI Solution

You need to add a new {selectInput}() to the {tabPanel}(). Remember to use {ns}() for the id. The choices for this select will also differ by data set, so you need to add {group\_choices} to the arguments of this function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tabPanelUI }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(id, choices, group\_choices) \{}
\NormalTok{   ns }\OtherTok{\textless{}{-}} \FunctionTok{NS}\NormalTok{(id)}
   
   \FunctionTok{tabPanel}\NormalTok{(}
\NormalTok{       id,}
       \FunctionTok{selectInput}\NormalTok{(}\FunctionTok{ns}\NormalTok{(}\StringTok{"dv"}\NormalTok{), }\StringTok{"DV"}\NormalTok{, }\AttributeTok{choices =}\NormalTok{ choices),}
       \FunctionTok{selectInput}\NormalTok{(}\FunctionTok{ns}\NormalTok{(}\StringTok{"group\_by"}\NormalTok{), }\StringTok{"Group By"}\NormalTok{, }\AttributeTok{choices =}\NormalTok{ group\_choices),}
       \FunctionTok{plotOutput}\NormalTok{(}\FunctionTok{ns}\NormalTok{(}\StringTok{"plot"}\NormalTok{)),}
\NormalTok{       DT}\SpecialCharTok{::}\FunctionTok{dataTableOutput}\NormalTok{(}\FunctionTok{ns}\NormalTok{(}\StringTok{"table"}\NormalTok{))}
\NormalTok{   )}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Update the plot function to use the value of this new input instead of ``Species'', ``vs'', and whatever you chose for \texttt{diamonds}.
\end{itemize}

Server Solution

You no longer need \texttt{group\_by} in the arguments for this function because you are getting that info from an input.

Instead of changing {group\_by} to \texttt{input\$group\_by} in three places in the code below, I just added the line \texttt{group\_by\ \textless{}-\ input\$group\_by} at the top of {moduleServer}().

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tabPanelServer }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(id, data) \{}
    \FunctionTok{moduleServer}\NormalTok{(id, }\ControlFlowTok{function}\NormalTok{(input, output, session) \{}
\NormalTok{        group\_by }\OtherTok{\textless{}{-}}\NormalTok{ input}\SpecialCharTok{$}\NormalTok{group\_by}
      
        \CommentTok{\# rest of the code is the same ...}
\NormalTok{    \})}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{new-module}{%
\subsection{New module}\label{new-module}}

There is a {fluidRow}() before the {tabsetPanel}() in the ui that contains three {infoBoxOutput}() and three {renderInfoBoxOutput}() functions in the server function.

Modularise the info boxes and their associated server functions.

UI Function

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{infoBoxUI }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(id, }\AttributeTok{width =} \DecValTok{4}\NormalTok{) \{}
\NormalTok{    ns }\OtherTok{\textless{}{-}} \FunctionTok{NS}\NormalTok{(id)}

    \FunctionTok{infoBoxOutput}\NormalTok{(}\FunctionTok{ns}\NormalTok{(}\StringTok{"box"}\NormalTok{), width)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Server Function

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{infoBoxServer }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(id, title, fmt, icon, }\AttributeTok{color =} \StringTok{"purple"}\NormalTok{) \{}
    \FunctionTok{moduleServer}\NormalTok{(id, }\ControlFlowTok{function}\NormalTok{(input, output, session) \{}
\NormalTok{        output}\SpecialCharTok{$}\NormalTok{box }\OtherTok{\textless{}{-}} \FunctionTok{renderInfoBox}\NormalTok{(\{}
            \FunctionTok{infoBox}\NormalTok{(}\AttributeTok{title =}\NormalTok{ title,}
                    \AttributeTok{value =} \FunctionTok{format}\NormalTok{(}\FunctionTok{Sys.Date}\NormalTok{(), fmt),}
                    \AttributeTok{icon =} \FunctionTok{icon}\NormalTok{(icon),}
                    \AttributeTok{color =}\NormalTok{ color)}
\NormalTok{        \})}
\NormalTok{    \})}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

UI Code

In the \texttt{ui}, replace the {fluidRow}() with this:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{fluidRow}\NormalTok{(}
    \FunctionTok{infoBoxUI}\NormalTok{(}\StringTok{"day"}\NormalTok{),}
    \FunctionTok{infoBoxUI}\NormalTok{(}\StringTok{"month"}\NormalTok{),}
    \FunctionTok{infoBoxUI}\NormalTok{(}\StringTok{"year"}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Server Code

In {server}(), replace {renderInfoBox}() with this:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{infoBoxServer}\NormalTok{(}\StringTok{"year"}\NormalTok{, }\StringTok{"Year"}\NormalTok{, }\StringTok{"\%Y"}\NormalTok{, }\StringTok{"calendar"}\NormalTok{),}
\FunctionTok{infoBoxServer}\NormalTok{(}\StringTok{"month"}\NormalTok{, }\StringTok{"Month"}\NormalTok{, }\StringTok{"\%m"}\NormalTok{, }\StringTok{"calendar{-}alt"}\NormalTok{),}
\FunctionTok{infoBoxServer}\NormalTok{(}\StringTok{"day"}\NormalTok{, }\StringTok{"Day"}\NormalTok{, }\StringTok{"\%d"}\NormalTok{, }\StringTok{"calendar{-}day"}\NormalTok{)}\ErrorTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{your-app-modules}{%
\section{Your app}\label{your-app-modules}}

What you could modularise in your custom app?

\hypertarget{appendix-appendices}{%
\appendix}


\hypertarget{installing-r}{%
\chapter{\texorpdfstring{Installing \texttt{R}}{Installing R}}\label{installing-r}}

Installing R and RStudio is usually straightforward. The sections below explain how and \href{https://www.youtube.com/watch?v=lVKMsaWju8w}{there is a helpful YouTube video here}.

\hypertarget{installing-base-r}{%
\section{Installing Base R}\label{installing-base-r}}

Install base R from \url{https://cran.rstudio.com/}. Choose the download link for your operating system (Linux, Mac OS X, or Windows).

If you have a Mac, install the latest release from the newest \texttt{R-x.x.x.pkg} link (or a legacy version if you have an older operating system). After you install R, you should also install \href{http://xquartz.macosforge.org/}{XQuartz} to be able to use some visualisation packages.

If you are installing the Windows version, choose the ``\href{https://cran.rstudio.com/bin/windows/base/}{base}'' subdirectory and click on the download link at the top of the page. After you install R, you should also install \href{https://cran.rstudio.com/bin/windows/Rtools/}{RTools}; use the ``recommended'' version highlighted near the top of the list.

If you are using Linux, choose your specific operating system and follow the installation instructions.

\hypertarget{installing-rstudio}{%
\section{Installing RStudio}\label{installing-rstudio}}

Go to \href{https://www.rstudio.com/products/rstudio/download/\#download}{rstudio.com} and download the RStudio Desktop (Open Source License) version for your operating system under the list titled \textbf{Installers for Supported Platforms}.

\hypertarget{rstudio-settings}{%
\subsection{RStudio Settings}\label{rstudio-settings}}

There are a few settings you should fix immediately after updating RStudio. Go to \textbf{\texttt{Global\ Options...}} under the \textbf{\texttt{Tools}} menu (âŒ˜,), and in the General tab, uncheck the box that says \textbf{\texttt{Restore\ .RData\ into\ workspace\ at\ startup}}. If you keep things around in your workspace, things will get messy, and unexpected things will happen. You should always start with a clear workspace. This also means that you never want to save your workspace when you exit, so set this to \textbf{\texttt{Never}}. The only thing you want to save are your scripts.

You may also want to change the appearance of your code. Different fonts and themes can sometimes help with visual difficulties or {[}dyslexia{]}((\url{https://datacarpentry.org/blog/2017/09/coding-and-dyslexia})\{target="\_blank"\}. I prefer a dark background and the FiraCode font for my own coding, but I will use the default theme for screenshots in this book.

\begin{figure}

{\centering \includegraphics[width=0.45\linewidth]{images/rstudio_settings_general} \includegraphics[width=0.45\linewidth]{images/rstudio_settings_appearance} 

}

\caption{My RStudio General and Appearance settings}\label{fig:settings-general}
\end{figure}

You may also want to change the settings in the Code tab. I prefer two spaces instead of tabs for my code and I like to be able to see the whitespace characters. But these are all a matter of personal preference.

\begin{figure}

{\centering \includegraphics[width=0.45\linewidth]{images/rstudio_settings_code_editing} \includegraphics[width=0.45\linewidth]{images/rstudio_settings_code_display} 

}

\caption{My RStudio Code settings}\label{fig:settings-code}
\end{figure}

\hypertarget{installing-shinyintro-1}{%
\subsection{Installing shinyintro}\label{installing-shinyintro-1}}

To install the class package, which will provide you with a copy of all of the shiny apps we'll use for demos and the basic template, paste the following code into the console in RStudio.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# you may have to install devtools first with }
\CommentTok{\# install.packages("devtools")}

\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"debruine/shinyintro"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{installing-latex}{%
\section{Installing LaTeX}\label{installing-latex}}

You can install the LaTeX typesetting system to produce PDF reports from RStudio. Without this additional installation, you will be able to produce reports in HTML but not PDF. This course will not require you to make PDFs. To generate PDF reports, you will additionally need:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \href{http://pandoc.org/installing.html}{pandoc}, and
\item
  LaTeX, a typesetting language, available for

  \begin{itemize}
  \tightlist
  \item
    WINDOWS: \href{http://miktex.org/}{MikTeX}
  \item
    Mac OS: \href{https://tug.org/mactex/downloading.html}{MacTex} (3.2GB download) or \href{http://ww.tug.org/mactex/morepackages.html}{BasicTeX} (78MB download, but should work fine)
  \item
    Linux: \href{https://www.tug.org/texlive/}{TeX Live}
  \end{itemize}
\end{enumerate}

\hypertarget{symbols}{%
\chapter{Symbols}\label{symbols}}

\begin{longtable}[]{@{}cll@{}}
\toprule
Symbol & Book Term & Also Known As \\
\midrule
\endhead
() & (round) brackets & parentheses \\
{[}{]} & square brackets & brackets \\
\{\} & curly brackets & squiggly brackets \\
\textless\textgreater{} & chevrons & angled brackets / guillemets \\
\textless{} & less than & \\
\textgreater{} & greater than & \\
\& & ampersand & ``and'' symbol \\
\# & hash & pound / octothorpe \\
/ & slash & forward slash \\
\textbackslash{} & backslash & \\
- & dash & hyphen / minus \\
\_ & underscore & \\
* & asterisk & star \\
\^{} & caret & power symbol \\
\textasciitilde{} & tilde & twiddle / squiggle \\
= & equal sign & \\
== & double equal sign & \\
. & full stop & period / point \\
! & exclamation mark & bang / not \\
? & question mark & \\
' & single quote & quote / apostrophe \\
" & double quote & quote \\
\%\textgreater\% & pipe & magrittr pipe \\
\textbar{} & vertical bar & pipe \\
, & comma & \\
; & semi-colon & \\
: & colon & \\
@ & ``at'' symbol & \href{https://www.theguardian.com/notesandqueries/query/0,5753,-1773,00.html}{various hilarious regional terms} \\
\bottomrule
\end{longtable}

\hypertarget{glossary}{%
\chapter{Glossary}\label{glossary}}

See the \href{https://psyteachr.github.io/glossary/}{psyTeachR Glossary} for more definitions of R jargon.

\begin{tabular}{l|l}
\hline
term & definition\\
\hline
argument & A variable that provides input to a function.\\
\hline
attribute-html & Extra information about an HTML element\\
\hline
base-r & The set of R functions that come with a basic installation of R, before you add external packages\\
\hline
cache-web & In a web browser, external files like CSS, JavaScript, and images are usually cached so that they donâ€™t have to be repeatedly downloaded.\\
\hline
character & A data type representing strings of text.\\
\hline
commit & The action of storing a new snapshot of a projectâ€™s state in the git history.\\
\hline
console & The pane in RStudio where you can type in commands and view output messages.\\
\hline
css & Cascading Style Sheet: A system for controlling the visual presentation of HTML in web pages.\\
\hline
data-type & The kind of data represented by an object.\\
\hline
data-wrangling & The process of preparing data for visualisation and statistical analysis.\\
\hline
directory & A collection or â€œfolderâ€ of files on a computer.\\
\hline
double & A data type representing a real decimal number\\
\hline
dynamic & Something that can change in response to user actions\\
\hline
element-html & A unit of HTML, such as a header, paragraph, or image.\\
\hline
function & A named section of code that can be reused.\\
\hline
github & A cloud-based service for storing and sharing your version controlled files.\\
\hline
html & Hyper-Text Markup Language: A system for semantically tagging structure and information on web pages.\\
\hline
integer & A data type representing whole numbers.\\
\hline
javascript & An object-oriented computer programming language commonly used to create interactive effects in web browsers.\\
\hline
jquery & A library that makes it easier to write JavaScript.\\
\hline
latex & A typesetting program needed to create PDF files from R Markdown documents.\\
\hline
list & A container data type that allows items with different data types to be grouped together.\\
\hline
logical & A data type representing TRUE or FALSE values.\\
\hline
numeric & A data type representing a real decimal number or integer.\\
\hline
object & A word that identifies and stores the value of some data for later use.\\
\hline
package & A group of R functions.\\
\hline
pandoc & A universal document convertor, used by R to make PDF or Word documents from R Markdown\\
\hline
panes & RStudio is arranged with four window â€œpanes.â€\\
\hline
project & A way to organise related files in RStudio\\
\hline
push & Updating the remote git project from the local project.\\
\hline
r-markdown & The R-specific version of markdown: a way to specify formatting, such as headers, paragraphs, lists, bolding, and links, as well as code blocks and inline code.\\
\hline
rstudio & An integrated development environment (IDE) that helps you process R code.\\
\hline
server & This is the part of a Shiny app that works with logic.\\
\hline
shiny & An R package that builds interactive web apps\\
\hline
static & Something that does not change in response to user actions\\
\hline
string & A piece of text inside of quotes.\\
\hline
tag & A way to mark the start and end of HTML elements.\\
\hline
tidyverse & A set of R packages that help you create and work with tidy data\\
\hline
ui & The User Interface. This usually refers to a Shiny App as the user will see it.\\
\hline
vector & A type of data structure that is basically a list of things like T/F values, numbers, or strings.\\
\hline
version-control & A way to save a record of changes to your files.\\
\hline
whitespace & Spaces, tabs and line breaks\\
\hline
widget & A interactive web element, like a dropdown menu or a slider.\\
\hline
working-directory & The filepath where R is currently reading and writing files.\\
\hline
yaml & A structured format for information\\
\hline
\end{tabular}

  \bibliography{book.bib,packages.bib}

\end{document}
